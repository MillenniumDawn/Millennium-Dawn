
#### Overall function ###

recalculate_party = {
	party_pop_refresh = yes
	set_variable = { found_num_parties = 0 } #always have this
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #1
	}	
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #2
	}	
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #3
	}
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #4
	}
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #5
	}
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #6
	}
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #7
	}
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #8
	}
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #9
	}
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #10
	}
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #11
	}
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #12
	}
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #13
	}
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #14
	}
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #15
	}
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #16
	}
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #17
	}
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #18
	}
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #19
	}
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #20
	}
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #21
	}
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #22
	}
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #23
	}
	if = { limit = { NOT = { check_variable = { found_num_parties = total_parties } } }
		add_to_variable = { found_num_parties = 1 }
		find_largest_party = yes #24
	}
	clear_variable = found_num_parties
	check_party_cleanup = yes
}


#### Refresh ####
#Rule: Takes set popularity and transforms it so that it conforms with ingame outlook popularities. 

party_pop_refresh = {
	
	#Totals needed for later
	set_variable = { democratic_pop_total = 0 }
	set_variable = { communism_pop_total = 0 }
	set_variable = { fascism_pop_total = 0 }
	set_variable = { neutrality_pop_total = 0 }
	set_variable = { nationalist_pop_total = 0 }
	set_variable = { total_parties = 0 }

	#Western add-up
	if = { limit = { has_variable = conservatism_pop }
		add_to_variable = { democratic_pop_total = conservatism_pop }
	}
	if = { limit = { has_variable = liberalism_pop }
		add_to_variable = { democratic_pop_total = liberalism_pop }
	}
	if = { limit = { has_variable = socialism_pop }
		add_to_variable = { democratic_pop_total = socialism_pop }
	}
	if = { limit = { has_variable = Western_Autocracy_pop }
		add_to_variable = { democratic_pop_total = Western_Autocracy_pop }
	}
	#Multiply out
	if = { 
		limit = { 
			has_variable = conservatism_pop 
			check_variable = { conservatism_pop > 0.005 }
		}
		divide_variable = { conservatism_pop = democratic_pop_total }
		multiply_variable = { conservatism_pop = party_popularity@democratic }
		add_to_variable = { total_parties = 1 }
	}
	if = { 
		limit = { 
			has_variable = liberalism_pop 
			check_variable = { liberalism_pop > 0.005 } 
		}
		divide_variable = { liberalism_pop = democratic_pop_total }
		multiply_variable = { liberalism_pop = party_popularity@democratic }
		add_to_variable = { total_parties = 1 }
	}
	if = { 
		limit = { 
			has_variable = socialism_pop 
			check_variable = { socialism_pop > 0.005 } 
		}
		divide_variable = { socialism_pop = democratic_pop_total }
		multiply_variable = { socialism_pop = party_popularity@democratic }
		add_to_variable = { total_parties = 1 }
	}
	if = { 
		limit = { 
			has_variable = Western_Autocracy_pop 
			check_variable = { Western_Autocracy_pop > 0.005 } 
		}
		divide_variable = { Western_Autocracy_pop = democratic_pop_total }
		multiply_variable = { Western_Autocracy_pop = party_popularity@democratic }
		add_to_variable = { total_parties = 1 }
	}
	
	#Emerging add-up
	if = { limit = { has_variable = Communist-State_pop }
		add_to_variable = { communism_pop_total = Communist-State_pop }
	}
	if = { limit = { has_variable = Conservative_pop }
		add_to_variable = { communism_pop_total = Conservative_pop }
	}
	if = { limit = { has_variable = Autocracy_pop }
		add_to_variable = { communism_pop_total = Autocracy_pop }
	}
	if = { limit = { has_variable = Vilayat_e_Faqih_pop }
		add_to_variable = { communism_pop_total = Vilayat_e_Faqih_pop }
	}
	if = { limit = { has_variable = Mod_Vilayat_e_Faqih_pop }
		add_to_variable = { communism_pop_total = Mod_Vilayat_e_Faqih_pop }
	}
	if = { limit = { has_variable = anarchist_communism_pop }
		add_to_variable = { communism_pop_total = anarchist_communism_pop }
	}
	
	#Multiply out
	if = { 
		limit = { 
			has_variable = Communist-State_pop 
			check_variable = { Communist-State_pop > 0.005 }
		}
		divide_variable = { Communist-State_pop = communism_pop_total }
		multiply_variable = { Communist-State_pop = party_popularity@communism }
		add_to_variable = { total_parties = 1 }
	}
	if = { 
		limit = { 
			has_variable = Conservative_pop 
			check_variable = { Conservative_pop > 0.005 }
		}
		divide_variable = { Conservative_pop = communism_pop_total }
		multiply_variable = { Conservative_pop = party_popularity@communism }
		add_to_variable = { total_parties = 1 }
	}
	if = { 
		limit = { 
			has_variable = Autocracy_pop 
			check_variable = { Autocracy_pop > 0.005 }
		}
		divide_variable = { Autocracy_pop = communism_pop_total }
		multiply_variable = { Autocracy_pop = party_popularity@communism }
		add_to_variable = { total_parties = 1 }
	}
	if = { 
		limit = { 
			has_variable = Vilayat_e_Faqih_pop 
			check_variable = { Vilayat_e_Faqih_pop > 0.005 }
		}
		divide_variable = { Vilayat_e_Faqih_pop = communism_pop_total }
		multiply_variable = { Vilayat_e_Faqih_pop = party_popularity@communism }
		add_to_variable = { total_parties = 1 }
	}
	if = { 
		limit = { 
			has_variable = Mod_Vilayat_e_Faqih_pop 
			check_variable = { Mod_Vilayat_e_Faqih_pop > 0.005 }
		}
		divide_variable = { Mod_Vilayat_e_Faqih_pop = communism_pop_total }
		multiply_variable = { Mod_Vilayat_e_Faqih_pop = party_popularity@communism }
		add_to_variable = { total_parties = 1 }
	}
	if = { 
		limit = { 
			has_variable = anarchist_communism_pop 
			check_variable = { anarchist_communism_pop > 0.005 }
		}
		divide_variable = { anarchist_communism_pop = communism_pop_total }
		multiply_variable = { anarchist_communism_pop = party_popularity@communism }
		add_to_variable = { total_parties = 1 }
	}
	
	#Salafist Add-up
	if = { limit = { has_variable = Kingdom_pop }
		add_to_variable = { fascism_pop_total = Kingdom_pop }
	}
	if = { limit = { has_variable = Kingdom_pop }
		add_to_variable = { fascism_pop_total = Kingdom_pop }
	}
	
	#Multiply out
	if = { 
		limit = { 
			has_variable = Kingdom_pop 
			check_variable = { Kingdom_pop > 0.005 }
		}
		divide_variable = { Kingdom_pop = fascism_pop_total }
		multiply_variable = { Kingdom_pop = party_popularity@fascism }
		add_to_variable = { total_parties = 1 }
	}
	if = { 
		limit = { 
			has_variable = Caliphate_pop 
			check_variable = { Caliphate_pop > 0.005 }
		}
		divide_variable = { Caliphate_pop = fascism_pop_total }
		multiply_variable = { Caliphate_pop = party_popularity@fascism }
		add_to_variable = { total_parties = 1 }
	}
	
	#Neutrality Add-upp
	if = { limit = { has_variable = Neutral_conservatism_pop }
		add_to_variable = { neutrality_pop_total = Neutral_conservatism_pop }
	}
	if = { limit = { has_variable = oligarchism_pop }
		add_to_variable = { neutrality_pop_total = oligarchism_pop }
	}
	if = { limit = { has_variable = neutral_Social_pop }
		add_to_variable = { neutrality_pop_total = neutral_Social_pop }
	}
	if = { limit = { has_variable = Neutral_Libertarian_pop }
		add_to_variable = { neutrality_pop_total = Neutral_Libertarian_pop }
	}
	if = { limit = { has_variable = Neutral_Autocracy_pop }
		add_to_variable = { neutrality_pop_total = Neutral_Autocracy_pop }
	}
	if = { limit = { has_variable = Neutral_Communism_pop }
		add_to_variable = { neutrality_pop_total = Neutral_Communism_pop }
	}
	if = { limit = { has_variable = Neutral_Green_pop }
		add_to_variable = { neutrality_pop_total = Neutral_Green_pop }
	}
	if = { limit = { has_variable = Neutral_Muslim_Brotherhood_pop }
		add_to_variable = { neutrality_pop_total = Neutral_Muslim_Brotherhood_pop }
	}
	
	#Multiply out
	if = { 
		limit = { 
			has_variable = Neutral_conservatism_pop 
			check_variable = { Neutral_conservatism_pop > 0.005 }
		}
		divide_variable = { Neutral_conservatism_pop = neutrality_pop_total }
		multiply_variable = { Neutral_conservatism_pop = party_popularity@neutrality }
		add_to_variable = { total_parties = 1 }
	}
	if = { 
		limit = { 
			has_variable = oligarchism_pop 
			check_variable = { oligarchism_pop > 0.005 }
		}
		divide_variable = { oligarchism_pop = neutrality_pop_total }
		multiply_variable = { oligarchism_pop = party_popularity@neutrality }
		add_to_variable = { total_parties = 1 }
	}
	if = { 
		limit = { 
			has_variable = neutral_Social_pop 
			check_variable = { neutral_Social_pop > 0.005 }
		}
		divide_variable = { neutral_Social_pop = neutrality_pop_total }
		multiply_variable = { neutral_Social_pop = party_popularity@neutrality }
		add_to_variable = { total_parties = 1 }
	}
	if = { 
		limit = { 
			has_variable = Neutral_Libertarian_pop 
			check_variable = { Neutral_Libertarian_pop > 0.005 }
		}
		divide_variable = { Neutral_Libertarian_pop = neutrality_pop_total }
		multiply_variable = { Neutral_Libertarian_pop = party_popularity@neutrality }
		add_to_variable = { total_parties = 1 }
	}
	if = { 
		limit = { 
			has_variable = Neutral_Autocracy_pop 
			check_variable = { Neutral_Autocracy_pop > 0.005 }
		}
		divide_variable = { Neutral_Autocracy_pop = neutrality_pop_total }
		multiply_variable = { Neutral_Autocracy_pop = party_popularity@neutrality }
		add_to_variable = { total_parties = 1 }
	}
	if = { 
		limit = { 
			has_variable = Neutral_Communism_pop 
			check_variable = { Neutral_Communism_pop > 0.005 }
		}
		divide_variable = { Neutral_Communism_pop = neutrality_pop_total }
		multiply_variable = { Neutral_Communism_pop = party_popularity@neutrality }
		add_to_variable = { total_parties = 1 }
	}
	if = { 
		limit = { 
			has_variable = Neutral_Green_pop 
			check_variable = { Neutral_Green_pop > 0.005 }
		}
		divide_variable = { Neutral_Green_pop = neutrality_pop_total }
		multiply_variable = { Neutral_Green_pop = party_popularity@neutrality }
		add_to_variable = { total_parties = 1 }
	}
	if = { 
		limit = { 
			has_variable = Neutral_Muslim_Brotherhood_pop 
			check_variable = { Neutral_Muslim_Brotherhood_pop > 0.005 }
		}
		divide_variable = { Neutral_Muslim_Brotherhood_pop = neutrality_pop_total }
		multiply_variable = { Neutral_Muslim_Brotherhood_pop = party_popularity@neutrality }
		add_to_variable = { total_parties = 1 }
	}
	
	#nationalist Add-upp
	if = { limit = { has_variable = Nat_Autocracy_pop }
		add_to_variable = { nationalist_pop_total = Nat_Autocracy_pop }
	}
	if = { limit = { has_variable = Nat_Fascism_pop }
		add_to_variable = { nationalist_pop_total = Nat_Fascism_pop }
	}
	if = { limit = { has_variable = Nat_Populism_pop }
		add_to_variable = { nationalist_pop_total = Nat_Populism_pop }
	}
	if = { limit = { has_variable = Monarchist_pop }
		add_to_variable = { nationalist_pop_total = Monarchist_pop }
	}
	
	#Multiply out
	if = { 
		limit = { 
			has_variable = Nat_Autocracy_pop 
			check_variable = { Nat_Autocracy_pop > 0.005 }
		}
		divide_variable = { Nat_Autocracy_pop = nationalist_pop_total }
		multiply_variable = { Nat_Autocracy_pop = party_popularity@nationalist }
		add_to_variable = { total_parties = 1 }
	}
	if = { 
		limit = { 
			has_variable = Nat_Fascism_pop 
			check_variable = { Nat_Fascism_pop > 0.005 }
		}
		divide_variable = { Nat_Fascism_pop = nationalist_pop_total }
		multiply_variable = { Nat_Fascism_pop = party_popularity@nationalist }
		add_to_variable = { total_parties = 1 }
	}
	if = { 
		limit = { 
			has_variable = Nat_Populism_pop 
			check_variable = { Nat_Populism_pop > 0.005 }
		}
		divide_variable = { Nat_Populism_pop = nationalist_pop_total }
		multiply_variable = { Nat_Populism_pop = party_popularity@nationalist }
		add_to_variable = { total_parties = 1 }
	}
	if = { 
		limit = { 
			has_variable = Monarchist_pop 
			check_variable = { Monarchist_pop > 0.005 }
		}
		divide_variable = { Monarchist_pop = nationalist_pop_total }
		multiply_variable = { Monarchist_pop = party_popularity@nationalist }
		add_to_variable = { total_parties = 1 }
	}
	clear_variable = democratic_pop_total
	clear_variable = communism_pop_total
	clear_variable = fascism_pop_total
	clear_variable = neutrality_pop_total
	clear_variable = nationalist_pop_total
}

#### Sorting Algorithm ####

find_largest_party = {
	set_variable = { prevmax = 0 }
	if = {
		limit = {
			NOT = { has_country_flag = found_1 }
			has_variable = conservatism_pop 
			check_variable = { conservatism_pop > 0.005 }
			check_variable = { conservatism_pop > prevmax }
		}
		set_variable = { prevmax = conservatism_pop }
		set_variable = { var_ID = 1 }
	}
	if = {
		limit = {
			NOT = { has_country_flag = found_2 }
			has_variable = liberalism_pop 
			check_variable = { liberalism_pop > 0.005 }
			check_variable = { liberalism_pop > prevmax }
		}
		set_variable = { prevmax = liberalism_pop }
		set_variable = { var_ID = 2 }
	}
	if = {
		limit = {
			NOT = { has_country_flag = found_3 }
			has_variable = socialism_pop 
			check_variable = { socialism_pop > 0.005 }
			check_variable = { socialism_pop > prevmax }
		}
		set_variable = { prevmax = socialism_pop }
		set_variable = { var_ID = 3 }
	}
	if = {
		limit = {
			NOT = { has_country_flag = found_4 }
			has_variable = Western_Autocracy_pop 
			check_variable = { Western_Autocracy_pop > 0.005 }
			check_variable = { Western_Autocracy_pop > prevmax }
		}
		set_variable = { prevmax = Western_Autocracy_pop }
		set_variable = { var_ID = 4 }
	}
	if = {
		limit = {
			NOT = { has_country_flag = found_5 }
			has_variable = Communist-State_pop 
			check_variable = { Communist-State_pop > 0.005 }
			check_variable = { Communist-State_pop > prevmax }
		}
		set_variable = { prevmax = Communist-State_pop }
		set_variable = { var_ID = 5 }
	}
	if = {
		limit = {
			NOT = { has_country_flag = found_6 }
			has_variable = Conservative_pop 
			check_variable = { Conservative_pop > 0.005 }
			check_variable = { Conservative_pop > prevmax }
		}
		set_variable = { prevmax = Conservative_pop }
		set_variable = { var_ID = 6 }
	}
	if = {
		limit = {
			NOT = { has_country_flag = found_7 }
			has_variable = Autocracy_pop 
			check_variable = { Autocracy_pop > 0.005 }
			check_variable = { Autocracy_pop > prevmax }
		}
		set_variable = { prevmax = Autocracy_pop }
		set_variable = { var_ID = 7 }
	}
	if = {
		limit = {
			has_variable = Vilayat_e_Faqih_pop 
			NOT = { has_country_flag = found_8 }
			check_variable = { Vilayat_e_Faqih_pop > 0.005 }
			check_variable = { Vilayat_e_Faqih_pop > prevmax }
		}
		set_variable = { prevmax = Vilayat_e_Faqih_pop }
		set_variable = { var_ID = 8 }
	}
	if = {
		limit = {
			has_variable = Mod_Vilayat_e_Faqih_pop 
			NOT = { has_country_flag = found_9 }
			check_variable = { Mod_Vilayat_e_Faqih_pop > 0.005 }
			check_variable = { Mod_Vilayat_e_Faqih_pop > prevmax }
		}
		set_variable = { prevmax = Mod_Vilayat_e_Faqih_pop }
		set_variable = { var_ID = 9 }
	}
	if = {
		limit = { 
			NOT = { has_country_flag = found_10 }
			has_variable = anarchist_communism_pop 
			check_variable = { anarchist_communism_pop > 0.005 }
			check_variable = { anarchist_communism_pop > prevmax }
		}
		set_variable = { prevmax = anarchist_communism_pop }
		set_variable = { var_ID = 10 }
	}
	if = {
		limit = {
			has_variable = Kingdom_pop 
			check_variable = { Kingdom_pop > 0.005 }
			NOT = { has_country_flag = found_11 }
			check_variable = { Kingdom_pop > prevmax }
		}
		set_variable = { prevmax = Kingdom_pop }
		set_variable = { var_ID = 11 }
	}
	if = {
		limit = {
			has_variable = Caliphate_pop 
			check_variable = { Caliphate_pop > 0.005 }
			NOT = { has_country_flag = found_12 }
			check_variable = { Caliphate_pop > prevmax }
		}
		set_variable = { prevmax = Caliphate_pop }
		set_variable = { var_ID = 12 }
	}
	if = {
		limit = { 
			NOT = { has_country_flag = found_13 }
			has_variable = Neutral_conservatism_pop 
			check_variable = { Neutral_conservatism_pop > 0.005 }
			check_variable = { Neutral_conservatism_pop > prevmax }
		}
		set_variable = { prevmax = Neutral_conservatism_pop }
		set_variable = { var_ID = 13 }
	}
	if = {
		limit = { 
			NOT = { has_country_flag = found_14 }
			has_variable = oligarchism_pop 
			check_variable = { oligarchism_pop > 0.005 }
			check_variable = { oligarchism_pop > prevmax }
		}
		set_variable = { prevmax = oligarchism_pop }
		set_variable = { var_ID = 14 }
	}
	if = {
		limit = { 
			NOT = { has_country_flag = found_15 }
			has_variable = neutral_Social_pop 
			check_variable = { neutral_Social_pop > 0.005 }
			check_variable = { neutral_Social_pop > prevmax }
		}
		set_variable = { prevmax = neutral_Social_pop }
		set_variable = { var_ID = 15 }
	}
	if = {
		limit = {
			has_variable = Neutral_Libertarian_pop 
			check_variable = { Neutral_Libertarian_pop > 0.005 }
			NOT = { has_country_flag = found_16 }
			check_variable = { Neutral_Libertarian_pop > prevmax }
		}
		set_variable = { prevmax = Neutral_Libertarian_pop }
		set_variable = { var_ID = 16 }
	}
	if = {
		limit = {
			has_variable = Neutral_Autocracy_pop 
			check_variable = { Neutral_Autocracy_pop > 0.005 }
			NOT = { has_country_flag = found_17 }
			check_variable = { Neutral_Autocracy_pop > prevmax }
		}
		set_variable = { prevmax = Neutral_Autocracy_pop }
		set_variable = { var_ID = 17 }
	}
	if = {
		limit = {
			has_variable = Neutral_Communism_pop 
			check_variable = { Neutral_Communism_pop > 0.005 }
			NOT = { has_country_flag = found_18 }
			check_variable = { Neutral_Communism_pop > prevmax }
		}
		set_variable = { prevmax = Neutral_Communism_pop }
		set_variable = { var_ID = 18 }
	}
	if = {
		limit = {
			has_variable = Neutral_Green_pop 
			check_variable = { Neutral_Green_pop > 0.005 }
			NOT = { has_country_flag = found_19 }
			check_variable = { Neutral_Green_pop > prevmax }
		}
		set_variable = { prevmax = Neutral_Green_pop }
		set_variable = { var_ID = 19 }
	}
	if = {
		limit = {
			has_variable = Neutral_Muslim_Brotherhood_pop 
			check_variable = { Neutral_Muslim_Brotherhood_pop > 0.005 }
			NOT = { has_country_flag = found_20 }
			check_variable = { Neutral_Muslim_Brotherhood_pop > prevmax }
		}
		set_variable = { prevmax = Neutral_Muslim_Brotherhood_pop }
		set_variable = { var_ID = 20 }
	}
	if = {
		limit = {
			has_variable = Nat_Autocracy_pop 
			check_variable = { Nat_Autocracy_pop > 0.005 }
			NOT = { has_country_flag = found_21 }
			check_variable = { Nat_Autocracy_pop > prevmax }
		}
		set_variable = { prevmax = Nat_Autocracy_pop }
		set_variable = { var_ID = 21 }
	}
	if = {
		limit = {
			has_variable = Nat_Fascism_pop 
			check_variable = { Nat_Fascism_pop > 0.005 }
			NOT = { has_country_flag = found_22 }
			check_variable = { Nat_Fascism_pop > prevmax }
		}
		set_variable = { prevmax = Nat_Fascism_pop }
		set_variable = { var_ID = 22 }
	}
	if = {
		limit = {
			NOT = { has_country_flag = found_23 }
			has_variable = Nat_Populism_pop 
			check_variable = { Nat_Populism_pop > 0.005 }
			check_variable = { Nat_Populism_pop > prevmax }
		}
		set_variable = { prevmax = Nat_Populism_pop }
		set_variable = { var_ID = 23 }
	}
	if = {
		limit = {
			has_variable = Monarchist_pop 
			check_variable = { Monarchist_pop > 0.005 }
			NOT = { has_country_flag = found_24 }
			check_variable = { Monarchist_pop > prevmax }
		}
		set_variable = { prevmax = Monarchist_pop }
		set_variable = { var_ID = 24 }
	}
	#Largest Found, now setting position
			
	if = { limit = { check_variable = { var_ID = 1 } } 
		set_country_flag = found_1
		set_variable = { conservatism_position = found_num_parties }
		
		else = { if = { limit = { check_variable = { var_ID = 2 } }
			set_country_flag = found_2
			set_variable = { liberalism_position = found_num_parties }
	
			else = { if = { limit = { check_variable = { var_ID = 3 } } 
				set_country_flag = found_3
				set_variable = { socialism_position = found_num_parties }

				else = { if = { limit = { check_variable = { var_ID = 4 } }
					set_country_flag = found_4
					set_variable = { Western_Autocracy_position = found_num_parties }
					
					else = { if = { limit = { check_variable = { var_ID = 5 } }
						set_country_flag = found_5
						set_variable = { Communist-State_position = found_num_parties }
						
						else = { if = { limit = { check_variable = { var_ID = 6 } }
							set_country_flag = found_6
							set_variable = { Conservative_position = found_num_parties }
							
							else = { if = { limit = { check_variable = { var_ID = 7 } }
								set_country_flag = found_7
								set_variable = { Autocracy_position = found_num_parties }
								
								else = { if = { limit = { check_variable = { var_ID = 8 } }
									set_country_flag = found_8
									set_variable = { Vilayat_e_Faqih_position = found_num_parties }
								
									else = { if = { limit = { check_variable = { var_ID = 9 } }
										set_country_flag = found_9
										set_variable = { Mod_Vilayat_e_Faqih_position = found_num_parties }
									
										else = { if = { limit = { check_variable = { var_ID = 10 } }
											set_country_flag = found_10
											set_variable = { anarchist_communism_position = found_num_parties }
										
											else = { if = { limit = { check_variable = { var_ID = 11 } }
												set_country_flag = found_11
												set_variable = { Kingdom_position = found_num_parties }
											
												else = { if = { limit = { check_variable = { var_ID = 12 } }
													set_country_flag = found_12
													set_variable = { Caliphate_position = found_num_parties }
													
													else = { if = { limit = { check_variable = { var_ID = 13 } }
														set_country_flag = found_13
														set_variable = { Neutral_conservatism_position = found_num_parties }
														
														else = { if = { limit = { check_variable = { var_ID = 14 } }
															set_country_flag = found_14
															set_variable = { oligarchism_position = found_num_parties }
														
														else = { if = { limit = { check_variable = { var_ID = 15 } }
															set_country_flag = found_15
															set_variable = { neutral_Social_position = found_num_parties }
														
														else = { if = { limit = { check_variable = { var_ID = 16 } }
															set_country_flag = found_16
															set_variable = { Neutral_Libertarian_position = found_num_parties }
														
														else = { if = { limit = { check_variable = { var_ID = 17 } }
															set_country_flag = found_17
															set_variable = { Neutral_Autocracy_position = found_num_parties }
														
														else = { if = { limit = { check_variable = { var_ID = 18 } }
															set_country_flag = found_18
															set_variable = { Neutral_Communism_position = found_num_parties }
														
														else = { if = { limit = { check_variable = { var_ID = 19 } }
															set_country_flag = found_19
															set_variable = { Neutral_Green_position = found_num_parties }
														
														else = { if = { limit = { check_variable = { var_ID = 20 } }
															set_country_flag = found_20
															set_variable = { Neutral_Muslim_Brotherhood_position = found_num_parties }
														
														else = { if = { limit = { check_variable = { var_ID = 21 } }
															set_country_flag = found_21
															set_variable = { Nat_Autocracy_position = found_num_parties }
														
														else = { if = { limit = { check_variable = { var_ID = 22 } }
															set_country_flag = found_22
															set_variable = { Nat_Fascism_position = found_num_parties }
														
														else = { if = { limit = { check_variable = { var_ID = 23 } }
															set_country_flag = found_23
															set_variable = { Nat_Populism_position = found_num_parties }
														
														else = { if = { limit = { check_variable = { var_ID = 24 } }
															set_country_flag = found_24
															set_variable = { Monarchist_position = found_num_parties }
														}
													}
												}
											}
										}
									}
								}
							}
						}
					} } } }
				} } } } } } }
			} } } } } } } } } } }
		} } } } } } } } } } } } } } }
	}
	clear_variable = var_ID
	clear_variable = prevmax
}

check_party_cleanup = {

	if = { limit = { has_country_flag = found_1 } 
		clr_country_flag = found_1
	}
	if = { limit = { has_country_flag = found_2 } 
		clr_country_flag = found_2
	}
	if = { limit = { has_country_flag = found_3 } 
		clr_country_flag = found_3
	}
	if = { limit = { has_country_flag = found_4 } 
		clr_country_flag = found_4
	}
	if = { limit = { has_country_flag = found_5 } 
		clr_country_flag = found_5
	}
	if = { limit = { has_country_flag = found_6 } 
		clr_country_flag = found_6
	}
	if = { limit = { has_country_flag = found_7 } 
		clr_country_flag = found_7
	}
	if = { limit = { has_country_flag = found_8 } 
		clr_country_flag = found_8
	}
	if = { limit = { has_country_flag = found_9 } 
		clr_country_flag = found_9
	}
	if = { limit = { has_country_flag = found_10 } 
		clr_country_flag = found_10
	}
	if = { limit = { has_country_flag = found_11 } 
		clr_country_flag = found_11
	}
	if = { limit = { has_country_flag = found_12 } 
		clr_country_flag = found_12
	}
	if = { limit = { has_country_flag = found_13 } 
		clr_country_flag = found_13
	}
	if = { limit = { has_country_flag = found_14 } 
		clr_country_flag = found_14
	}
	if = { limit = { has_country_flag = found_15 } 
		clr_country_flag = found_15
	}
	if = { limit = { has_country_flag = found_16 } 
		clr_country_flag = found_16
	}
	if = { limit = { has_country_flag = found_17 } 
		clr_country_flag = found_17
	}
	if = { limit = { has_country_flag = found_18 } 
		clr_country_flag = found_18
	}
	if = { limit = { has_country_flag = found_19 } 
		clr_country_flag = found_19
	}
	if = { limit = { has_country_flag = found_20 } 
		clr_country_flag = found_20
	}
	if = { limit = { has_country_flag = found_21 } 
		clr_country_flag = found_21
	}
	if = { limit = { has_country_flag = found_22 } 
		clr_country_flag = found_22
	}
	if = { limit = { has_country_flag = found_23 } 
		clr_country_flag = found_23
	}
	if = { limit = { has_country_flag = found_24 } 
		clr_country_flag = found_24
	}
}	