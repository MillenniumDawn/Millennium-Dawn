add_namespace = arab_spring

# Protestors Have Taken to the Streets
country_event = {
	id = arab_spring.0
	title = arab_spring.0.t
	desc = arab_spring.0.d
	picture = GFX_politics_protest
	is_triggered_only = yes

	option = {
		name = arab_spring.0.a
		log = "[GetDateText]: [This.GetName]: arab_spring.0.a executed"
		activate_mission_tooltip = arab_spring_protests_1
		if = { limit = { NOT = { has_country_flag = arab_spring_active } }
			set_country_flag = arab_spring_active
		}

		if = {
			limit = { is_subject = yes }
			OVERLORD = { country_event = { id = arab_spring.3 days = 1 } }
		}
		else_if = {
			limit = { NOT = { check_variable = { influence_array^0 = 0 } } }
			var:influence_array^0 = {
				country_event = { id = arab_spring.3 days = 1 }
			}
		}

		news_event = { id = arab_spring.1 days = 3 }
	}
}

# Protests Erupt Demanding [FROM.GetLeader]'s Resignation
news_event = {
	id = arab_spring.1
	title = arab_spring.1.t
	desc = {
		trigger = {
			FROM = {
				NOT = { var:influence_array^0 = { has_government = democratic } }
			}
		}
		text = arab_spring.1.d
	}
	desc = {
		trigger = {
			FROM = {
				var:influence_array^0 = { has_government = democratic }
			}
		}
		text = arab_spring.1.d_western
	}
	picture = GFX_news_arab_riot_police
	is_triggered_only = yes
	major = yes

	# We Must Mitigate This Crisis!
	option = {
		trigger = { tag = FROM }
		name = arab_spring.1.a
		log = "[GetDateText]: [This.GetName]: arab_spring.1.a executed"
	}

	# The Winds of Change are Blowing in the Middle East...
	option = {
		trigger = { NOT = { tag = FROM } }
		name = arab_spring.1.b
		log = "[GetDateText]: [This.GetName]: arab_spring.1.b executed"
	}
}

# An Ally under Threat
country_event = {
	id = arab_spring.3
	title = arab_spring.3.t
	desc = arab_spring.3.d

	picture = GFX_politics_protest

	is_triggered_only = yes

	# We stand by our allies!
	option = {
		name = arab_spring.3.a
		log = "[GetDateText]: [This.GetName]: arab_spring.3.a executed"
		FROM = { country_event = { id = arab_spring.4 days = 1 } }

		ai_chance = {
			base = 1
			modifier = {
				add = 10
				FROM = { is_subject_of = PREV }
			}
			# Commit if high influence and not democratic
			modifier = {
				factor = 1.25
				FROM = {
					OR = {
						AND = {
							check_variable = { influence_array^0 = PREV }
							check_variable = { influence_array_val^0 > 39.99 }
						}
						AND = {
							check_variable = { influence_array^1 = PREV }
							check_variable = { influence_array_val^1 > 39.99 }
						}
					}
				}
			}
			# Intervene if more interventionist
			modifier = {
				factor = 1.5
				OR = {
					has_idea = intervention_regional_interventionism
					has_idea = intervention_global_interventionism
					has_idea = intervention_neo_imperialism
				}
			}
			# Less Chance to intervene if FROM is a player and difficulty is high
			modifier = {
				factor = 0.75
				difficulty > 2
			}
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}
	}

	# We refuse to stand in the way of democratic reform!
	option = {
		name = arab_spring.3.b
		FROM = { country_event = { id = arab_spring.5 days = 1 } }
		log = "[GetDateText]: [This.GetName]: arab_spring.3.b executed"

		ai_chance = {
			base = 5
			modifier = {
				add = 15
				has_idea = intervention_local_security
				FROM = { PREV_is_on_same_continent = no }
			}
		}
	}
}

# Our Ally Supports us!
country_event = {
	id = arab_spring.4
	title = arab_spring.4.t
	desc = arab_spring.4.d
	picture = GFX_politics_talks
	is_triggered_only = yes

	# Their Support is Welcome.
	option = {
		name = arab_spring.4.a
		log = "[GetDateText]: [This.GetName]: arab_spring.4.a executed"
		add_political_power = 150
	}
}

# Our Ally has Abandoned us...
country_event = {
	id = arab_spring.5
	title = arab_spring.5.t
	desc = arab_spring.5.d
	picture = GFX_politics_talks
	is_triggered_only = yes

	# Betrayed in Our Time of Need...
	option = {
		name = arab_spring.5.a
		log = "[GetDateText]: [This.GetName]: arab_spring.5.a executed"
	}
}

# Regime Supporters Stage Rally
country_event = {
	id = arab_spring.6
	title = arab_spring.6.t
	desc = {
		text = arab_spring.6.d1
		trigger = { NOT = { has_country_flag = arab_spring_civilian_clashes } }
	}
	desc = {
		text = arab_spring.6.d2
		trigger = { has_country_flag = arab_spring_civilian_clashes }
	}
	picture = GFX_politics_protest
	is_triggered_only = yes

	# The People Love [ROOT.GetLeader]!
	option = {
		name = arab_spring.6.a
		log = "[GetDateText]: [This.GetName]: arab_spring.6.a executed"
		trigger = { NOT = { has_country_flag = arab_spring_civilian_clashes } }
	}

	# Tensions Mount...
	option = {
		name = arab_spring.6.b
		log = "[GetDateText]: [This.GetName]: arab_spring.6.b executed"
		trigger = { has_country_flag = arab_spring_civilian_clashes }

		clr_country_flag = arab_spring_civilian_clashes

		set_temp_variable = { temp_strength = 10 }
		change_arab_spring_strength = yes
		add_manpower = -20
	}
}

# Units of the Army Mutiny, Side with the Opposition
country_event = {
	id = arab_spring.7
	title = arab_spring.7.t
	desc = arab_spring.7.d
	picture = GFX_arab_spring_defection
	is_triggered_only = yes

	trigger = {
		has_country_flag = arab_spring_military_deployed
		has_country_flag = arab_spring_active
		check_variable = { the_military_opinion < 51 }
	}

	# Our authority grows weaker...
	option = {
		name = arab_spring.7.a
		log = "[GetDateText]: [This.GetName]: arab_spring.7.a executed"
		set_temp_variable = { temp_strength = 10 }
		change_arab_spring_strength = yes
		add_to_variable = { arab_spring_mutiny = 1 }
		add_manpower = -500
	}
}

# Deaths Following Clashes between Troops and Protesters
country_event = {
	id = arab_spring.8
	title = arab_spring.8.t
	desc = arab_spring.8.d
	picture = GFX_egyptian_christian_massacre
	is_triggered_only = yes
	trigger = {
		has_country_flag = arab_spring_military_deployed
		has_country_flag = arab_spring_active
	}

	# This does not reflect well on us...
	option = {
		name = arab_spring.8.a
		log = "[GetDateText]: [This.GetName]: arab_spring.8.a executed"
		set_temp_variable = { temp_strength = 20 }
		change_arab_spring_strength = yes
		add_manpower = -50
	}
}

# Concessions Placate the Masses
country_event = {
	id = arab_spring.9
	title = arab_spring.9.t
	desc = arab_spring.9.d
	picture = GFX_politics_protest
	is_triggered_only = yes

	# Will It Be Enough?
	option = {
		name = arab_spring.9.a
		log = "[GetDateText]: [This.GetName]: arab_spring.9.a executed"
	}
}

# Concession Leads to Demands for Further Reform
country_event = {
	id = arab_spring.10
	title = arab_spring.10.t
	desc = arab_spring.10.d
	picture = GFX_politics_protest
	is_triggered_only = yes

	# The Mob Will Never Be Satisfied...
	option = {
		name = arab_spring.10.a
		log = "[GetDateText]: [This.GetName]: arab_spring.10.a executed"
		set_temp_variable = { temp_strength = 10 }
		change_arab_spring_strength = yes
	}
}

# Protests Reach Boiling Point
country_event = {
	id = arab_spring.11
	title = arab_spring.11.t
	desc = arab_spring.11.d
	picture = GFX_politics_speak
	is_triggered_only = yes

	# We Must Accept Defeat...
	option = {
		name = arab_spring.11.a
		log = "[GetDateText]: [This.GetName]: arab_spring.11.a executed"
		news_event = { id = arab_spring.12 }
		hidden_effect = {
			set_ruling_leader = yes
			set_leader = yes
			set_variable = { party_pop_array^0 = 0 }
			set_variable = { party_pop_array^7 = 0 }
		}
		enable_elections_with_no_leader_change = yes

		add_popularity = { ideology = neutrality popularity = 0.10 }
		recalculate_party = yes

		if = { limit = { has_idea = hybrid_regime_western }
			remove_ideas = hybrid_regime_western
		}
		if = { limit = { has_idea = hybrid_regime_emerging }
			remove_ideas = hybrid_regime_emerging
		}
		country_event = { id = MD4_election_campaign.0 days = 7 }

		if = {
			limit = { original_tag = EGY }
			set_country_flag = AS_arab_spring_completed
		}

		ai_chance = {
			base = 1
			modifier = {
				factor = 0
				is_historical_focus_on = yes
				original_tag = SYR
			}
			modifier = {
				factor = 1.25
				has_government = democratic
				has_elections = yes
			}
		}
	}

	# We will never give up power!
	option = {
		name = arab_spring.11.b
		log = "[GetDateText]: [This.GetName]: arab_spring.11.b executed"
		news_event = { id = arab_spring.14 }

		if = { limit = { check_variable = { arab_spring_mutiny = 0 } }
			set_temp_variable = { arab_spring_mutiny_size = 0.1 }
		}
		else_if = {
			limit = { check_variable = { arab_spring_mutiny = 1 } }
			set_temp_variable = { arab_spring_mutiny_size = 0.2 }
		}
		else_if = {
			limit = { check_variable = { arab_spring_mutiny = 2 } }
			set_temp_variable = { arab_spring_mutiny_size = 0.3 }
		}
		else_if = {
			limit = { check_variable = { arab_spring_mutiny > 2 } }
			set_temp_variable = { arab_spring_mutiny_size = 0.4 }
		}

		if = {
			limit = { tag = SYR }
			start_civil_war = {
				ideology = neutrality
				size = arab_spring_mutiny_size
				states = { 184 185 571 }
			}

			hidden_effect = {
				#Recognition
				add_to_array = { global.rival_governments = THIS }
				set_country_flag = rival_government_FSA
				random_country_with_original_tag = {
					original_tag_to_check = SYR
					limit = { has_government = neutrality }
					FSA = {
						ingame_startup_nations_effect = yes
						annex_country = {
							target = PREV
							transfer_troops = yes
						}
						every_state = {
							limit = { is_core_of = ROOT }
							add_core_of = FSA
						}
						if = { limit = { has_dlc = "No Step Back" }

							load_oob = FSA_2000_nsb
							else = {
								load_oob = FSA_2000_nonnsb
							}
						}

						#Recognition
						add_to_array = { global.rival_governments = THIS }
						set_country_flag = rival_government_SYR
					}
				}
				hidden_effect = {
					190 = { add_core_of = NUS }
					release = NUS
					190 = { add_core_of = ROOT }
					every_state = {
						limit = { is_core_of = ROOT }
						add_core_of = NUS
					}
					NUS = {
						set_cosmetic_tag = NUSRA
						ingame_startup_nations_effect = yes
						if = { limit = { has_dlc = "No Step Back" }

							load_oob = NUS_2000_nsb
						}
						else = {
							load_oob = NUS_2000_nonnsb
						}
					}
					declare_war_on = {
						target = FSA
						type = annex_everything
					}
					declare_war_on = {
						target = NUS
						type = annex_everything
					}
				}
				add_named_threat = {
					threat = 5
					name = Syrian_Civil_War.threat
				}
			}
		}
		else = {
			start_civil_war = {
				ideology = neutrality
				size = arab_spring_mutiny_size
			}
		}

		ai_chance = {
			base = 1
			modifier = {
				factor = 1.25
				original_tag = SYR
				has_government = communism
				# This is very important to the player as it unlocks ISIS as a follow-on.
			}
			modifier = {
				factor = 10
				OR = {
					SYR = { has_country_flag = GAME_RULE_guarantee_syrian_historical_as_civil_war }
					SYR = { has_country_flag = GAME_RULE_guarantee_islamic_state_spawn }
				}
			}
			modifier = {
				factor = 0
				is_historical_focus_on = yes
				NOT = { original_tag = SYR }
			}
		}
	}
}

# Revolution Sweeps Regime from Power in [FROM.GetNameDef]
news_event = {
	id = arab_spring.12
	title = arab_spring.12.t
	desc = {
		text = arab_spring.12.d1
		trigger = { FROM = { NOT = { original_tag = TUN } } }
	}
	desc = {
		text = arab_spring.12.d2
		trigger = { FROM = { original_tag = TUN } }
	}
	picture = GFX_news_arab_spring2
	is_triggered_only = yes
	major = yes

	# Viva la Revolution!
	option = {
		trigger = { tag = FROM }
		name = arab_spring.12.a
		log = "[GetDateText]: [This.GetName]: arab_spring.12.a executed"
		if = { limit = { NOT = { has_global_flag = global_arab_spring_started } }
			set_global_flag = global_arab_spring_started

			hidden_effect = {
				if = { limit = { FROM = { NOT = { original_tag = TUN } } } TUN = { country_event = { id = arab_spring.17 days = 1 } } }
				if = { limit = { FROM = { NOT = { original_tag = ALG } } } ALG = { country_event = { id = arab_spring.17 days = 1 } } }
				if = { limit = { FROM = { NOT = { original_tag = JOR } } } JOR = { country_event = { id = arab_spring.17 days = 1 } } }
				if = { limit = { FROM = { NOT = { original_tag = OMA } } } OMA = { country_event = { id = arab_spring.17 days = 4 } } }
				if = { limit = { FROM = { NOT = { original_tag = EGY } } } EGY = { country_event = { id = arab_spring.17 days = 12 } } }
				if = { limit = { FROM = { NOT = { original_tag = SYR } } } SYR = { country_event = { id = arab_spring.17 days = 13 } } }
				if = { limit = { FROM = { NOT = { original_tag = YEM } } } YEM = { country_event = { id = arab_spring.17 days = 14 } } }
				if = { limit = { FROM = { NOT = { original_tag = SUD } } } SUD = { country_event = { id = arab_spring.17 days = 17 } } }
				if = { limit = { FROM = { NOT = { original_tag = PAL } } } PAL = { country_event = { id = arab_spring.17 days = 28 } } }
				if = { limit = { FROM = { NOT = { original_tag = IRQ } } } IRQ = { country_event = { id = arab_spring.17 days = 30 } } }
				if = { limit = { FROM = { NOT = { original_tag = BHR } } } BHR = { country_event = { id = arab_spring.17 days = 32 } } }
				if = { limit = { FROM = { NOT = { original_tag = KUW } } } KUW = { country_event = { id = arab_spring.17 days = 37 } } }
				if = { limit = { FROM = { NOT = { original_tag = MOR } } } MOR = { country_event = { id = arab_spring.17 days = 38 } } }
				if = { limit = { FROM = { NOT = { original_tag = MAU } } } MAU = { country_event = { id = arab_spring.17 days = 43 } } }
				if = { limit = { FROM = { NOT = { original_tag = LEB } } } LEB = { country_event = { id = arab_spring.17 days = 45 } } }
				if = { limit = { FROM = { NOT = { original_tag = SAU } } } SAU = { country_event = { id = arab_spring.17 days = 57 } } }
			}
			news_event = { id = arab_spring.13 days = 5 }
		}
	}

	# A Worrying Development...
	option = {
		trigger = { NOT = { tag = FROM } is_arabic_nation = yes }
		name = arab_spring.12.b
		log = "[GetDateText]: [This.GetName]: arab_spring.12.b executed"
	}

	# Democracy Advances...
	option = {
		trigger = { NOT = { tag = FROM is_arabic_nation = yes } }
		name = arab_spring.12.c
		log = "[GetDateText]: [This.GetName]: arab_spring.12.c executed"
	}
}

# Protests Spread Across Arab World
news_event = {
	id = arab_spring.13
	title = arab_spring.13.t
	desc = arab_spring.13.d
	picture = GFX_news_arab_spring
	is_triggered_only = yes
	major = yes

	# The Winds of Change are Blowing in the Middle East...
	option = {
		name = arab_spring.13.a
		log = "[GetDateText]: [This.GetName]: arab_spring.13.a executed"
	}
}

# Civil War Erupts in [FROM.GetNameDef] as Regime Crushes Protests
news_event = {
	id = arab_spring.14
	title = arab_spring.14.t
	desc = arab_spring.14.d
	picture = GFX_news_saleh_killed
	is_triggered_only = yes
	major = yes

	# The Future of [FROM.GetNameDef] hangs in the Balance...
	option = {
		name = arab_spring.14.a
		log = "[GetDateText]: [This.GetName]: arab_spring.14.a executed"
	}
}

# ISIL Rises to Prominence
news_event = {
	id = arab_spring.15
	title = arab_spring.15.t
	desc = arab_spring.15.d
	picture = GFX_isis
	is_triggered_only = yes

	trigger = {
		NOT = { has_global_flag = ISIL_declared }
		has_global_flag = success_of_operation_iraqi_freedom
		SYR = {
			OR = {
				has_war_with = FSA
				has_war_with = NUS
			}
		}
		IRQ = { is_subject = no }
	}
	major = yes

	immediate = {
		set_global_flag = ISIL_declared
	}

	# Yet Another Threat to Our Rule...
	option = {
		trigger = { original_tag = SYR }
		name = arab_spring.15.a
		log = "[GetDateText]: [This.GetName]: arab_spring.15.a executed"
		AS_spawn_isis_into_game = yes
	}

	# World Peace is Under Threat...
	option = {
		trigger = { NOT = { original_tag = SYR } no_jihadist_government = yes }
		name = arab_spring.15.b
		log = "[GetDateText]: [This.GetName]: arab_spring.15.b executed"
	}

	# These upstarts are Doomed to Failure...
	option = {
		trigger = { NOT = { original_tag = SYR } jihadist_government = yes }
		name = arab_spring.15.c
		log = "[GetDateText]: [This.GetName]: arab_spring.15.c executed"
	}

	# By Allah, We Rise!
	option = {
		name = arab_spring.15.e
		log = "[GetDateText]: [This.GetName]: arab_spring.15.e executed"
		trigger = {
			original_tag = SYR
			is_ai = no
		}
		AS_spawn_isis_into_game = yes
		ISI = { change_tag_from = PREV }
	}
}

# The Arab Spring Reaches [FROM.GetNameDef]
country_event = {
	id = arab_spring.17
	title = arab_spring.17.t
	desc = arab_spring.17.d
	picture = GFX_politics_protest
	is_triggered_only = yes

	# We Must Mitigate This Crisis!
	option = {
		name = arab_spring.17.a
		set_country_flag = arab_spring_active
		activate_mission_tooltip = arab_spring_protests_1
		if = {
			limit = { check_variable = { influence_array^0 = FRA } }
			FRA = { country_event = { id = arab_spring.3 days = 1 } }
		}
		if = {
			limit = { check_variable = { influence_array^0 = USA } }
			USA = { country_event = { id = arab_spring.3 days = 1 } }
		}
		log = "[GetDateText]: [This.GetName]: arab_spring.17.a executed"
	}
}

# Protests Subside
country_event = {
	id = arab_spring.18
	title = arab_spring.18.t
	desc = {
		text = arab_spring.18.d
		trigger = { check_variable = { arab_spring > 0 } }
	}
	desc = {
		text = arab_spring.18.d1
		trigger = { check_variable = { arab_spring < 1 } }
	}
	picture = GFX_politics_protest
	is_triggered_only = yes

	# Our Government is Still Standing
	option = {
		name = arab_spring.18.a
		log = "[GetDateText]: [This.GetName]: arab_spring.18.a executed"
	}
}

#[FROM.GetLeader] Requests Peninsula Shield Intervention
country_event = {
	id = arab_spring.19
	title = arab_spring.19.t
	desc = arab_spring.19.d

	picture = GFX_politics_talks

	is_triggered_only = yes

	# We Must Help Our Ally!
	option = {
		name = arab_spring.19.a
		log = "[GetDateText]: [This.GetName]: arab_spring.19.a executed"
		FROM = { country_event = arab_spring.20 }

		ai_chance = {
			base = 1
		}
	}

	# Let Them Fall...
	option = {
		name = arab_spring.19.b
		log = "[GetDateText]: [This.GetName]: arab_spring.19.b executed"
		FROM = { country_event = arab_spring.21 }

		ai_chance = {
			base = 0
		}
	}
}

# Our Request Has Been Accepted!
country_event = {
	id = arab_spring.20
	title = arab_spring.20.t
	desc = arab_spring.20.d
	picture = GFX_politics_talks
	is_triggered_only = yes

	option = {
		name = arab_spring.20.a
		log = "[GetDateText]: [This.GetName]: arab_spring.20.a executed"
		set_temp_variable = { percent_change = 5 }
		set_temp_variable = { tag_index = FROM.id }
		set_temp_variable = { influence_target = THIS.id }
		change_influence_percentage = yes

		set_temp_variable = { temp_strength = -100 }
		change_arab_spring_strength = yes

		news_event = { id = arab_spring.22 days = 1 }
	}
}

# Our Request Has Been Rejected...
country_event = {
	id = arab_spring.21
	title = arab_spring.21.t
	desc = arab_spring.21.d
	picture = GFX_treaty_rejected
	is_triggered_only = yes

	option = {
		name = arab_spring.21.a
		log = "[GetDateText]: [This.GetName]: arab_spring.21.a executed"
	}
}

# Peninsula Shield Troops Deployed to Quell Protests in [FROM.GetNameDef]
news_event = {
	id = arab_spring.22
	title = arab_spring.22.t
	desc = arab_spring.22.d
	picture = GFX_news_peninsula_shield_intervention
	is_triggered_only = yes
	major = yes

	option = {
		name = arab_spring.22.a
		log = "[GetDateText]: [This.GetName]: arab_spring.22.a executed"
	}
}
