# monthly on_action by Yard1
on_actions = {
	on_startup = { # on_daily is executed before on_startup
		effect = {
			add_to_variable = { global.next_month = 1 }
		}
	}
	on_daily = {
		effect = {
			if = {
				# don't touch!
				limit = {
					NOT = {
						has_global_flag = on_monthly_done
					}
					meta_trigger = {
						text = {
							date > [YEAR].[MONTH].1
						}
						YEAR = "[?global.year]"
						MONTH = "[?global.next_month]"
					}
				}
				add_to_variable = { global.month = 1 }
				add_to_variable = { global.next_month = 1 }
				set_global_flag = { flag = on_monthly_done value = 1 days = 27 }
				if = {
					limit = { check_variable = { global.month > 12 } }
					set_variable = { global.month = 1 }
				}
				if = {
					limit = { check_variable = { global.next_month > 12 } }
					set_variable = { global.next_month = 1 }
					set_global_flag = { flag = on_monthly_done value = 1 days = 31 }
				}
				# this is done only ONCE per month, even though on_daily fires for every country
				# will also be done on startup

				# your code here
				set_power_ranking_ideas_for_every_country = yes
				country_event = { id = low_stability.1 }

				#killrabbit stuff
				every_country = {
					ingame_calculate_size_modifier = yes #updates economics if new factories has been added
					recalculate_party = yes

					#player only updates
					if = { limit = { is_ai = no }

						update_military_rate = yes
						2017_state_init_setup = yes		#updates all player states if population has grown enough

						if = { limit = { can_upgrade_gdp = yes NOT = { has_country_flag = Max_GDPC } has_global_flag = do_not_do_on_day_one }
							Update_GDPC = yes
							news_event = { id = GDPC_Update.1 } #informs that you didn't do it :P
						}
						set_global_flag = do_not_do_on_day_one
					}
				}
			}
			if = {
				limit = { NOT = { has_country_flag = has_done_intro_startup } }
				update_state_variables = yes
				startup_extra_setup = yes
				set_country_flag = has_done_intro_startup
			}
		}
	}

	on_weekly = {
		effect = {
			ingame_calculate_size_modifier = yes #updates economics if new factories has been added
			update_state_variables = yes
			#Monthly income tick
			add_to_variable = { treasury = treasury_rate }
			#Automated taking debt
			automated_debt_taker = yes
		}
	}

	on_monthly = {
		effect = {
			#Generic Economic Events
			if = {
				limit = {
					NOT = { has_country_flag = recently_had_economic_event }
					OR = {
						check_variable = { global.month = 1 } #January
						check_variable = { global.month = 4 } #April
						check_variable = { global.month = 7 } #July
						check_variable = { global.month = 9 } #September
					}
				}
				#Random Economic Events. Reconfiguring from MTTH for better optimization
				#Fires on January/April/July/September
				random_list = {
					#Empty Pulse - Should be more likely
					10 = {
						modifier = {
							factor = 10
							has_idea = depression
						}
						modifier = {
							factor = 1.5
							has_idea = recession
						}
						modifier = {
							factor = 1.25
							has_idea = stagnation
						}
						modifier = {
							factor = 0.80
							has_war = yes
						}
						modifier = {
							factor = 0.60
							is_subject = yes
						}
						#nothing
					}
					#Warns of Possible Housing Bubble
					10 = {
						modifier = {
							factor = 0.6
							has_idea = economic_boom
						}
						modifier = {
							factor = 0.8
							has_idea = fast_growth
						}
						modifier = {
							factor = 0
							OR = {
								has_idea = depression
								has_idea = recession
								has_idea = stagnation
								has_country_flag = possible_housing_bubble
								has_country_flag = housing_crash
							}
						}
						set_country_flag = { flag = recently_had_economic_event days = 125 value = 1 }
						country_event = { id = econvent.1 days = 5 random_days = 5 }
					}
					#Collapsing Housing Prices
					10 = {
						modifier = {
							factor = 0.6
							has_idea = economic_boom
						}
						modifier = {
							factor = 0.8
							has_idea = fast_growth
						}
						modifier = {
							factor = 0.5
							has_country_flag = consumption_slowdown
						}
						modifier = {
							factor = 2.0
							has_country_flag = possible_housing_bubble
						}
						modifier = {
							factor = 0
							OR = {
								has_idea = depression
								has_idea = recession
								has_idea = stagnation
							}
						}
						set_country_flag = { flag = recently_had_economic_event days = 125 value = 1 }
						country_event = { id = econvent.2 days = 5 random_days = 5 }
					}
					#Stock Market Crash
					10 = {
						modifier = {
							factor = 0.4
							has_idea = economic_boom
						}
						modifier = {
							factor = 0.8
							has_idea = fast_growth
						}
						modifier = {
							factor = 0.7
							OR = {
								has_country_flag = consumption_slowdown
								has_country_flag = stock_market_boom
								has_country_flag = voodoo_economics
							}
						}
						modifier = {
							factor = 0.5
							has_country_flag = stock_market_boom_accelerate
						}
						modifier = {
							factor = 0
							OR = {
								has_idea = recession
								has_idea = depression
							}
						}
						modifier = {
							factor = 0
							NOT = {
								has_country_flag = housing_crash
								has_country_flag = stock_market_boom_accelerate
								has_country_flag = stock_market_boom
							}
						}
						set_country_flag = { flag = recently_had_economic_event days = 125 value = 1 }
						country_event = { id = econvent.3 days = 5 random_days = 5 }
					}
					#Bank Crisis
					5 = {
						modifier = {
							factor = 0.3
							has_idea = economic_boom
						}
						modifier = {
							factor = 0.6
							has_idea = fast_growth
						}
						modifier = {
							factor = 0.5
							has_country_flag = voodoo_economics
						}
						modifier = {
							factor = 0.5
							has_country_flag = consumption_slowdown
						}
						modifier = {
							factor = 0
							OR = {
								NOT = {
									has_country_flag = hosing_crash
									has_country_flag = stock_market_crash
								}
								has_idea = recession
								has_idea = depression
							}
						}
					}
					#Slowdown Consumption
					5 = {
						modifier = {
							factor = 0.3
							has_idea = economic_boom
						}
						modifier = {
							factor = 0.6
							has_idea = fast_growth
						}
						modifier = {
							factor = 1.3
							has_idea = recession
						}
						modifier = {
							factor = 0.5
							has_country_flag = voodoo_economics
						}
						modifier = {
							factor = 0.5
							has_country_flag = stock_market_crash
						}
						modifier = {
							factor = 0.5
							has_country_flag = housing_crash
						}
						modifier = {
							factor = 0
							has_war = yes
						}
						modifier = {
							factor = 0
							has_idea = depression
						}
						set_country_flag = { flag = recently_had_economic_event days = 125 value = 1 }
						country_event = { id = econvent.5 days = 5 random_days = 5 }
					}
					#Lower Demand for our Goods in International Markets
					10 = {
						modifier = {
							factor = 0.6
							has_idea = economic_boom
						}
						modifier = {
							factor = 0.8
							has_idea = fast_growth
						}
						modifier = {
							factor = 2.5
							has_idea = recession
						}
						modifier = {
							factor = 0
							has_idea = depression
						}
						modifier = {
							factor = 0
							has_war = yes
						}
						set_country_flag = { flag = recently_had_economic_event days = 125 value = 1 }
						country_event = { id = econvent.6 days = 5 random_days = 5 }
					}
					#Unique Arid Nation Content
					#Drought
					5 = {
						modifier = {
							factor = 1.4
							is_african_nation = yes
						}
						modifier = {
							factor = 1.2
							has_idea = gdp_1
						}
						modifier = {
							factor = 1.10
							has_idea = gdp_2
						}
						modifier = {
							factor = 0.8
							has_idea = gdp_3
						}
						modifier = {
							factor = 0
							OR = {
								has_country_flag = drought
								has_idea = depression
								NOT = { is_arid_nation = yes }
								NOT = {
									has_idea = gdp_1
									has_idea = gdp_2
									has_idea = gdp_3
								}
							}
						}
						set_country_flag = { flag = recently_had_economic_event days = 125 value = 1 }
						country_event = { id = econvent.7 days = 5 random_days = 5 }
					}
					#Famine!
					5 = {
						modifier = {
							factor = 1.3
							has_idea = gdp_1
						}
						modifier = {
							factor = 1.10
							has_idea = gdp_2
						}
						modifier = {
							factor = 0.8
							has_idea = gdp_3
						}
						modifier = {
							factor = 0
							OR = {
								NOT = { has_country_flag = drought }
								has_idea = depression
							}
						}
						set_country_flag = { flag = recently_had_economic_event days = 125 value = 1 }
						country_event = { id = econvent.8 days = 5 random_days = 5 }
					}
					##Positive Events
					20 = {
						modifier = {
							factor = 0.5
							has_idea = fast_growth
						}
						modifier = {
							factor = 0.75
							has_idea = stable_growth
						}
						modifier = {
							factor = 1.10
							has_idea = stagnation
						}
						modifier = {
							factor = 1.5
							has_idea = recession
						}
						modifier = {
							factor = 2
							has_idea = depression
						}
						modifier = {
							factor = 0
							OR = {
								has_country_flag = increased_consumer_confidence
								has_idea = economic_boom
								has_idea = bankrupcy
							}
						}
						set_country_flag = { flag = recently_had_economic_event days = 125 value = 1 }
						country_event = { id = econvent.9 days = 5 random_days = 5 }
					}
					10 = {
						modifier = {
							factor = 2
							has_idea = depression
						}
						modifier = {
							factor = 1.25
							has_idea = recession
						}
						modifier = {
							factor = 1.10
							has_idea = stagnation
						}
						modifier = {
							factor = 0.75
							has_idea = stable_growth
						}
						modifier = {
							factor = 0.5
							has_idea = fast_growth
						}
						modifier = {
							factor = 0
							OR = {
								has_idea = economic_boom
								has_idea = bankrupcy
								has_country_flag = stock_market_boom_accelerate
								has_country_flag = stock_market_boom_slowed
								has_country_flag = stock_market_boom
							}
						}
						set_country_flag = { flag = recently_had_economic_event days = 125 value = 1 }
						country_event = { id = econvent.10 days = 5 random_days = 5 }
					}
				}
			}
			#Bankruptcy Events
			if = {
				limit = {
					check_variable = { debt_rate > half_way_bankrupt }
					OR = {
						check_variable = { global.month = 3 } #March
						check_variable = { global.month = 6 } #June
						check_variable = { global.month = 9 } #Sept
						check_variable = { global.month = 12 } #Dec
					}
				}
				random_list = {
					10 = { #Commit to Reducing Debt
						modifier = { #Killswitch
							factor = 0
							has_country_flag = BANK_committed_reducing_debt
						}
						country_event = { id = bankruptcy.200 days = 1 }
					}
					10 = { #Government Agency Goes Bankrupt
						modifier = { #Killswitch
							factor = 0
							has_country_flag = government_agency_bankruptcy
						}
						country_event = { id = bankruptcy.202 days = 1 }
					}
					10 = { #Military Squandering Funds
						modifier = {
							factor = 0
							has_idea = no_military
						}
						country_event = { id = bankruptcy.203 days = 1 }
					}
					70 = {
						#Nothing Happens
					}
				}
			}
		}
	}
}