#Written by hiddengearz, edited and improved by Angriest Bird
add_namespace = anti_bully
add_namespace = civil_war_debuff
add_namespace = god_of_war_event
add_namespace = world_war

################### WAR 1 ############################
#Used just to trigger event 2, event 1 does not seem to work immediately via on action
country_event = {
	id = anti_bully.1
	title = anti_bully.1.t
	desc = anti_bully.1.d
	hidden = yes
	is_triggered_only = yes
	immediate = {
		country_event = { id = anti_bully.2 days = 1 }
	}
}

#Triggers the Public War Weariness System
country_event = {
	id = anti_bully.2
	title = anti_bully.2.t
	desc = anti_bully.2.d
	is_triggered_only = yes
	trigger = {
		THIS = {
			has_offensive_war_with = event_target:AB_DEFF
		}
	}
	immediate = {
		hidden_effect = {
			if = { limit = { check_variable = { anti_bully_wars = 0 } } #Has 0 AB wars
				event_target:AB_ATT = {
					add_to_variable = { anti_bully_wars = 1 }
					AB_war_main = yes
				}
				else = {
					event_target:AB_ATT = {
						add_to_variable = { anti_bully_wars = 1 }
					}
				}
			}
			event_target:AB_ATT = {
				AB_war_second = yes
			}
		}
	}
	option = {
		name = anti_bully.2.a
		log = "[GetDateText]: [This.GetName]: anti_bully.2.a executed"
	}
}

country_event = {
	id = anti_bully.3
	title = anti_bully.3.t
	desc = anti_bully.3.d
	hidden = yes
	is_triggered_only = yes
	immediate = {
		AB_war_main = yes
	}
	option = {
		name = anti_bully.3.a
		log = "[GetDateText]: [This.GetName]: anti_bully.3.a executed" # War Support is Dwindling
	}
}

#Attacker offers white peace
country_event = {
	id = anti_bully.4
	title = anti_bully.4.t
	desc = anti_bully.4.d
	hidden = yes
	is_triggered_only = yes
	immediate = {
		AB_war_second = yes
	}
	option = { #attacker offers white peace
		name = anti_bully.4.a
		log = "[GetDateText]: [This.GetName]: anti_bully.4.a executed"
	}
}

# Defender accepts/declines white peace
# FROM == the person you are ceasefiring
country_event = {
	id = anti_bully.5
	title = anti_bully.5.t
	desc = anti_bully.5.d
	picture = GFX_politics_talks
	is_triggered_only = yes

	# Accept & war ends
	option = {
		name = anti_bully.5.a
		log = "[GetDateText]: [This.GetName]: anti_bully.5.a executed"
		every_state = {
			limit = {
				is_owned_by = ROOT
				is_controlled_by = FROM
			}
			FROM = { transfer_state = PREV }
		}
		FROM = { country_event = { id = anti_bully.6 } }
		white_peace = FROM
		if = {
			limit = { #If you're in a faction, not a major and not the leader
				event_target:AB_event_target = {
					is_in_faction = yes
					is_faction_leader = no
				}
				any_country = { #Faction leader must have capitulated for me to see this decision
					is_in_faction_with = event_target:AB_event_target
					has_war_together_with = event_target:AB_event_target
					is_faction_leader = yes
					has_capitulated = no
				}
			}
			event_target:AB_event_target = { leave_faction = yes }
			if = {
				limit = { event_target:AB_event_target = { has_idea = NATO_member } }
				event_target:AB_event_target = { NATO_leave = yes }
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 2
				ROOT = { surrender_progress > 0.20 }
			}
			modifier = {
				add = 2
				ROOT = { surrender_progress > 0.30 }
			}
			modifier = {
				add = 2
				ROOT = { surrender_progress > 0.40 }
			}
			modifier = {
				add = 2
				ROOT = { surrender_progress > 0.50 }
			}
			modifier = {
				add = 2
				ROOT = { surrender_progress > 0.60 }
			}
			modifier = {
				add = 2
				ROOT = { surrender_progress > 0.70 }
			}
			modifier = {
				add = 2
				ROOT = { surrender_progress > 0.80 }
			}
			modifier = {
				add = 2
				ROOT = { surrender_progress > 0.90 }
			}
			modifier = {
				add = 3
				ROOT = { NOT = { has_idea = three_months_of_war } }
			}
			modifier = {
				add = 3
				ROOT = { NOT = { has_idea = six_months_of_war } }
			}
			modifier = {
				add = 3
				ROOT = { NOT = { has_idea = nine_months_of_war } }
			}
			modifier = {
				add = 3
				ROOT = { NOT = { has_idea = twelve_months_of_war } }
			}
			modifier = {
				add = 5
				ROOT = { has_active_mission = bankruptcy_incoming_collapse }
			}
			# Alliance members keep fighting
			modifier = {
				add = -5
				is_in_faction = yes
			}
			modifier = {
				add = -10
				is_in_faction = yes
				is_faction_leader = yes
				any_allied_country = {
					has_capitulated = no
				}
			}
			modifier = {
				factor = 5
				OR = {
					strength_ratio = { tag = FROM ratio > 1.5 }
					has_stability > 0.35
					has_war_support < 0.30
				}
			}
		}
	}

	option = {
		name = anti_bully.5.b
		log = "[GetDateText]: [This.GetName]: anti_bully.5.b executed" #Decline the Ceasefire!
		FROM = { country_event = { id = anti_bully.7 days = 1 } }
		ai_chance = {
			factor = 1
			modifier = {
				add = 2
				surrender_progress < 0.20
			}
			modifier = {
				add = 2
				FROM = { surrender_progress > 0.20 }
			}
			modifier = {
				add = 4
				FROM = { surrender_progress > 0.40 }
			}
			modifier = {
				add = 4
				FROM = { surrender_progress > 0.60 }
			}
			modifier = {
				add = 4
				FROM = { surrender_progress > 0.80 }
			}
			modifier = {
				add = -5
				check_variable = { interest_rate < 4 }
			}
			modifier = {
				add = 5
				is_in_faction = yes
			}
			modifier = {
				add = 10
				is_in_faction = yes
				is_faction_leader = yes
				any_allied_country = {
					has_capitulated = no
				}
			}
			modifier = {
				factor = 5
				NOT = {
					has_stability > 0.35
					has_war_support < 0.30
					strength_ratio = { tag = FROM ratio > 1.5 }
				}
			}
		}
	}
}

country_event = { #Accepts Ceasefire
	id = anti_bully.6
	title = anti_bully.6.t
	desc = anti_bully.6.d
	picture = GFX_politics_talks
	is_triggered_only = yes

	option = {
		name = anti_bully.6.a
		log = "[GetDateText]: [This.GetName]: anti_bully.7.a executed"
		custom_effect_tooltip = accepted_ceasefire_tt
	}
}

country_event = { #Decline Ceasefire
	id = anti_bully.7
	title = anti_bully.7.t
	desc = anti_bully.7.d
	picture = GFX_treaty_rejected
	is_triggered_only = yes

	option = {
		name = anti_bully.7.a
		log = "[GetDateText]: [This.GetName]: anti_bully.7.a executed"
		FROM = { add_timed_idea = { idea = recent_ceasefire_attempt days = 30 } }
		add_timed_idea = { idea = recent_ceasefire_attempt days = 30 }
	}
}

#Civil war debuff improvements
country_event = {
	id = civil_war_debuff.1
	title = civil_war_debuff.1.t
	desc = civil_war_debuff.1.d
	picture = GFX_treaty_rejected

	trigger = {
		NOT = { has_country_flag = manual_civil_war_debuff_removal }
	}
	is_triggered_only = yes

	option = {
		name = civil_war_debuff.1.a
		log = "[GetDateText]: [This.GetName]: civil_war_debuff.1.a"
		add_timed_idea = {
			idea = civil_war_disorganised_military_2_military
			days = 150
		}
	}
	option = {
		name = civil_war_debuff.1.b
		log = "[GetDateText]: [This.GetName]: civil_war_debuff.1.b"
		add_timed_idea = {
			idea = civil_war_disorganised_military_2_production
			days = 150
		}
	}
	option = {
		name = civil_war_debuff.1.c
		log = "[GetDateText]: [This.GetName]: civil_war_debuff.1.c"
		add_timed_idea = {
			idea = civil_war_disorganised_military_2_experience
			days = 150
		}
	}
}
country_event = {
	id = civil_war_debuff.2
	title = civil_war_debuff.2.t
	desc = civil_war_debuff.2.d
	picture = GFX_treaty_rejected

	trigger = {
		NOT = { has_country_flag = manual_civil_war_debuff_removal }
	}
	is_triggered_only = yes

	option = {
		name = civil_war_debuff.2.a
		log = "[GetDateText]: [This.GetName]: civil_war_debuff.2.a"
		add_timed_idea = {
			idea = civil_war_disorganised_military_3_military
			days = 150
		}
	}
	option = {
		name = civil_war_debuff.2.b
		log = "[GetDateText]: [This.GetName]: civil_war_debuff.2.b"
		add_timed_idea = {
			idea = civil_war_disorganised_military_3_production
			days = 150
		}
	}
	option = {
		name = civil_war_debuff.2.c
		log = "[GetDateText]: [This.GetName]: civil_war_debuff.2.c"
		add_timed_idea = {
			idea = civil_war_disorganised_military_3_experience
			days = 150
		}
	}
}
country_event = {
	id = civil_war_debuff.3
	title = civil_war_debuff.3.t
	desc = civil_war_debuff.3.d
	picture = GFX_treaty_rejected

	trigger = {
		NOT = { has_country_flag = manual_civil_war_debuff_removal }
	}
	is_triggered_only = yes

	option = {
		name = civil_war_debuff.3.a
		log = "[GetDateText]: [This.GetName]: civil_war_debuff.3.a"
		add_timed_idea = {
			idea = civil_war_disorganised_military_4_military
			days = 150
		}
	}
	option = {
		name = civil_war_debuff.3.b
		log = "[GetDateText]: [This.GetName]: civil_war_debuff.3.b"
		add_timed_idea = {
			idea = civil_war_disorganised_military_4_production
			days = 150
		}
	}
	option = {
		name = civil_war_debuff.3.c
		log = "[GetDateText]: [This.GetName]: civil_war_debuff.3.c"
		add_timed_idea = {
			idea = civil_war_disorganised_military_4_experience
			days = 150
		}
	}
}
country_event = {
	id = civil_war_debuff.4
	title = civil_war_debuff.4.t
	desc = civil_war_debuff.4.d
	picture = GFX_treaty_rejected

	trigger = {
		NOT = { has_country_flag = manual_civil_war_debuff_removal }
	}
	is_triggered_only = yes

	option = {
		name = civil_war_debuff.4.a
		log = "[GetDateText]: [This.GetName]: civil_war_debuff.4.a"
		add_timed_idea = {
			idea = civil_war_disorganised_military_5_military
			days = 150
		}
	}
	option = {
		name = civil_war_debuff.4.b
		log = "[GetDateText]: [This.GetName]: civil_war_debuff.4.b"
		add_timed_idea = {
			idea = civil_war_disorganised_military_5_production
			days = 150
		}
	}
	option = {
		name = civil_war_debuff.4.c
		log = "[GetDateText]: [This.GetName]: civil_war_debuff.4.c"
		add_timed_idea = {
			idea = civil_war_disorganised_military_5_experience
			days = 150
		}
	}
}
country_event = {
	id = civil_war_debuff.5
	title = civil_war_debuff.5.t
	desc = civil_war_debuff.5.d
	picture = GFX_Military_Reform

	trigger = {
		NOT = { has_country_flag = manual_civil_war_debuff_removal }
	}
	is_triggered_only = yes

	option = {
		name = civil_war_debuff.5.a
		log = "[GetDateText]: [This.GetName]: civil_war_debuff.5.a"
	}
}

country_event = {
	id = god_of_war_event.1
	title = god_of_war_event.1.t
	desc = god_of_war_event.1.d

	is_triggered_only = yes

	option = {
		name = god_of_war_event.1.a
		log = "[GetDateText]: [This.GetName]: god_of_war_event.1.a"
	}

	option = {
		name = god_of_war_event.1.b
		log = "[GetDateText]: [This.GetName]: god_of_war_event.1.b"
		hidden_effect = {
			every_other_country = {
				limit = { is_ai = yes }
				add_ai_strategy = {
					type = contain
					id = ROOT
					value = 100
				}
				add_ai_strategy = {
					type = antagonize
					id = ROOT
					value = 100
				}
				add_ai_strategy = {
					type = conquer
					id = ROOT
					value = 100
				}
			}
		}
	}
}

# World War Game Rule

country_event = {
	id = world_war.1
	title = world_war.1.t
	desc = world_war.1.d

	is_triggered_only = yes

	option = {
		name = world_war.1.a
		log = "[GetDateText]: [This.GetName]: world_war.1.a executed"
		if = {
			limit = {
				CHI = {
					is_ai = yes
				}
			}
			set_global_flag = world_war_china
			# Will move to annex Taiwan, the United States will intervene.
			# China will call in North Korea to attack South Korea to distract the U.S. and a pacific war implodes
			# Russia will move to take Ukraine & Belarus due to the chaos
			# War in Europe explodes because of this
			# India sends volunteers to Korea, China gets mad and asks Pakistan to attack Kashmir
			# Iran (IR) moves to attack Israel & gets attacked by the U.S., if not IR attack Gulf States
		}
		else_if = {
			limit = {
				SOV = {
					is_ai = yes
				}
			}
			set_global_flag = world_war_russia
			# An event is given to the United States (if it exists, if not, to France) to expand NATO
			# NATO expansions pisses Russia off, and they attack Ukraine & Belarus
			# But the plot thickens, Ukraine was guaranteed with Russia
			# War in Europe
			# China goes to war with Taiwan because world is on fire
			# USA acts on guarantee with Taiwan (if it exists)
		}
	}
}

# Event Chain 1 - War in Asia

country_event = {
	id = world_war.2
	title = world_war.2.t
	desc = world_war.2.d

	is_triggered_only = yes

	trigger = {
		has_game_rule = {
			rule = allow_enable_world_war
			option = yes
		}
	}

	option = {
		name = world_war.2.a
		log = "[GetDateText]: [This.GetName]: world_war.2.a executed"
		USA = {
			declare_war_on = {
				target = CHI
				type = liberate_wargoal
			}
		}
		give_guarantee = KOR
		give_guarantee = JAP
		give_guarantee = PHI
		hidden_effect = {
			news_event = world_war.3
			if = {
				limit = {
					country_exists = KOR
					KOR = {
						is_subject = no
					}
					NKO = {
						OR = {
							is_subject = no
							is_subject_of = CHI
						}
					}
				}
				NKO = {
					country_event = {
						id = world_war.4
						days = 10
					}
				}
				SOV = {
					country_event = {
						id = world_war.9
						days = 35
					}
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}

	option = {
		name = world_war.2.b
		log = "[GetDateText]: [This.GetName]: world_war.2.b executed"
		ai_chance = {
			base = 0
		}
	}
}

country_event = {
	id = world_war.4
	title = world_war.4.t
	desc = world_war.4.d

	is_triggered_only = yes

	trigger = {
		has_game_rule = {
			rule = allow_enable_world_war
			option = yes
		}
	}

	option = {
		name = world_war.4.a
		log = "[GetDateText]: [This.GetName]: world_war.4.a executed"
		declare_war_on = {
			target = KOR
			type = annex_everything
		}
		hidden_effect = {
			JAP = {
				country_event = world_war.6
			}
		}
		ai_chance = {
			base = 1
		}
	}

	option = {
		name = world_war.4.b
		log = "[GetDateText]: [This.GetName]: world_war.4.b executed"
		ai_chance = {
			base = 0
		}
	}
}


country_event = {
	id = world_war.6
	title = world_war.6.t
	desc = world_war.6.d

	is_triggered_only = yes

	trigger = {
		has_game_rule = {
			rule = allow_enable_world_war
			option = yes
		}
	}

	option = {
		name = world_war.6.a
		log = "[GetDateText]: [This.GetName]: world_war.6.a executed"
		declare_war_on = {
			target = NKO
			type = topple_government
		}
		declare_war_on = {
			target = CHI
			type = topple_government
		}
		hidden_effect = {
			news_event = world_war.5
		}
		ai_chance = {
			base = 1
		}
	}

	option = {
		name = world_war.6.b
		log = "[GetDateText]: [This.GetName]: world_war.6.b executed"
		ai_chance = {
			base = 0
		}
	}
}

country_event = {
	id = world_war.7
	title = world_war.7.t
	desc = world_war.7.d

	is_triggered_only = yes

	trigger = {
		has_game_rule = {
			rule = allow_enable_world_war
			option = yes
		}
	}

	option = {
		name = world_war.7.a
		log = "[GetDateText]: [This.GetName]: world_war.7.a executed"
		declare_war_on = {
			target = SOV
			type = topple_government
		}
		hidden_effect = {
			news_event = world_war.8
		}
		ai_chance = {
			base = 1
		}
	}

	option = {
		name = world_war.7.b
		log = "[GetDateText]: [This.GetName]: world_war.7.b executed"
		ai_chance = {
			base = 0
		}
	}
}

country_event = {
	id = world_war.9
	title = world_war.9.t
	desc = world_war.9.d

	is_triggered_only = yes

	trigger = {
		has_game_rule = {
			rule = allow_enable_world_war
			option = yes
		}
	}

	option = {
		name = world_war.9.a
		log = "[GetDateText]: [This.GetName]: world_war.9.a executed"
		declare_war_on = {
			target = UKR
			type = topple_government
		}
		ai_chance = {
			base = 1
		}
	}

	option = {
		name = world_war.9.b
		log = "[GetDateText]: [This.GetName]: world_war.9.b executed"
		ai_chance = {
			base = 0
		}
	}
}

# World Events

news_event = {
	id = world_war.3
	title = world_war.3.t
	desc = world_war.3.d
	major = yes
	is_triggered_only = yes
	picture = GFX_united_states_army
	option = {
		name = world_war.3.a
		log = "[GetDateText]: [This.GetName]: world_war.3.a executed"
	}
}

news_event = {
	id = world_war.5
	title = world_war.5.t
	desc = world_war.5.d
	major = yes
	is_triggered_only = yes
	picture = GFX_CHI_chinese_soldiers_news
	option = {
		name = world_war.5.a
		log = "[GetDateText]: [This.GetName]: world_war.5.a executed"
	}
}

news_event = {
	id = world_war.8
	title = world_war.8.t
	desc = world_war.8.d
	major = yes
	is_triggered_only = yes
	picture = GFX_sov_nationalist_news14
	option = {
		name = world_war.8.a
		log = "[GetDateText]: [This.GetName]: world_war.8.a executed"
	}
}

#civil_war_world