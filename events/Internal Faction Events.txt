add_namespace = small_medium_business_owners_request_events
add_namespace = small_medium_business_owners_bonus_events

######################################
### Small & Medium Business Owners ###
######################################

### Requests ###

#S&M Business Owners Demand a Tax Cut
country_event = {
	id = small_medium_business_owners_request_events.0
	title = small_medium_business_owners_request_events.0.t
	desc = small_medium_business_owners_request_events.0.d
	immediate = { log = "[Get.DateText]: [This.GetName]: small_medium_business_owners_request_events.0" }
	picture = GFX_internal_faction_tax_cut
	
	is_triggered_only = yes
	trigger = {
		has_idea = small_medium_business_owners
		NOT = { has_country_flag = enthusiastic_small_medium_business_owners }
		check_variable = { tax_rate > 10 }
	}
	
	mean_time_to_happen = {
		days = 1
		#More likely if high tax rate
		modifier = {
			factor = 0.5
			check_variable = { tax_rate > 30 }
		}
		#Less likely if low tax rate
		modifier = {
			factor = 1.5
			check_variable = { tax_rate < 20 }
		}
		#More likely if low economic cycle
		modifier = {
			factor = 1.5
			OR = {
				has_idea = depression
				has_idea = recession
				has_idea = stagnation
			}
		}
	}
	
	option = {
		name = small_medium_business_owners_request_events.0.o1
		log = "[GetDateText]: [This.GetName]: small_medium_business_owners_request_events.0.o1 executed"	#Decrease taxes
		ai_chance = { factor = 1 }
		reduce_tax_rate_3 = yes
		increase_small_medium_business_owners_opinion = yes		
		add_timed_idea = {
			idea = internal_faction_tax_cuts
			days = 360
		}
		if = {
			limit = {
				OR = {
					has_socialist_government = yes
					has_communist_government = yes
				}
			}
			decrease_popularity_5 = yes
			set_party_index_to_ruling_party = yes
			set_temp_variable = { party_popularity_increase = -0.05 }
			add_relative_party_popularity = yes
			steal_popularity_from_fiscal_liberals = yes
		}
	}
	option = {
		name = small_medium_business_owners_request_events.0.o2
		log = "[GetDateText]: [This.GetName]: small_medium_business_owners_request_events.0.o2 executed"	#Do nothing
		ai_chance = { factor = 1 }
		decrease_small_medium_business_owners_opinion = yes	
	}
	option = {
		name = small_medium_business_owners_request_events.0.o3
		log = "[GetDateText]: [This.GetName]: small_medium_business_owners_request_events.0.o3 executed"	#Increase taxes
		ai_chance = { factor = 1 }
		increase_tax_rate_3 = yes
		if = {
			limit = { has_idea = industrial_conglomerates }
			decrease_industrial_conglomerates_opinion = yes	
		}
		if = {
			limit = { has_idea = oligarchs }
			decrease_oligarchs_opinion = yes	
		}
		if = {
			limit = { has_idea = fossil_fuel_industry }
			decrease_fossil_fuel_industry_opinion = yes	
		}
		decrease_small_medium_business_owners_opinion = yes	
		if = {
			limit = {
				has_economically_liberal_government = yes
			}
			decrease_popularity_5 = yes
			set_party_index_to_ruling_party = yes
			set_temp_variable = { party_popularity_increase = -0.05 }
			add_relative_party_popularity = yes
			steal_popularity_from_socialists = yes
		}					
	}
	option = {
		name = small_medium_business_owners_request_events.0.o4
		log = "[GetDateText]: [This.GetName]: small_medium_business_owners_request_events.0.o4 executed"	#Use labour unions
		ai_chance = { factor = 1 }
		trigger = {
			has_idea = labour_unions
			OR = {
				has_country_flag = enthusiastic_labour_unions
				has_country_flag = positive_labour_unions
			}
		}
		decrease_labour_unions_opinion = yes						
	}
}

#A large foreign company buys domestic small business
country_event = {
	id = small_medium_business_owners_request_events.1
	title = small_medium_business_owners_request_events.1.t
	desc = small_medium_business_owners_request_events.1.d
	immediate = { log = "[Get.DateText]: [This.GetName]: small_medium_business_owners_request_events.1" }
	picture = GFX_internal_faction_business_purchase
	
	is_triggered_only = yes
	trigger = {
		has_idea = small_medium_business_owners
	}
	
	mean_time_to_happen = {
		days = 1
		#Less likely if Emerging, Salafist or Nationalist
		modifier = {
			factor = 0.5
			OR = {
				has_government = communism
				has_government = fascism
				has_government = nationalist
			}
		}
		#More likely if international bankers or industrial conglomerates
		modifier = {
			factor = 1.5
			OR = {
				has_idea = international_bankers
				has_idea = industrial_conglomerates
			}
		}
	}
	
	option = {
		name = small_medium_business_owners_request_events.1.o1
		log = "[GetDateText]: [This.GetName]: small_medium_business_owners_request_events.1.o1 executed"	#Allow it
		ai_chance = { factor = 1 }
		random_other_country = {
			limit = { has_idea = industrial_conglomerates }
			custom_effect_tooltip = TT_country_gains_10_influence
			ROOT = {
				hidden_effect = {
					set_temp_variable = { influence_gain = 10 }
					for_loop_effect = {
						end = influence_array^num
						value = v
						if = {
							limit = {
								check_variable = { influence_array^v = PREV }
							}
							add_to_variable = { influence_array_val^v = influence_gain }
							set_country_flag = found
						}
					}
					if = {
						limit = { NOT = { has_country_flag = found } }
							add_to_array = { influence_array = PREV.id }
							add_to_array = { influence_array_val = influence_gain }
					}
					clr_country_flag = found
					recalculate_influence = yes
				}
			}
		}
		if = {
			limit = {
				OR = {
					has_socialist_government = yes
					has_reactionary_government = yes
				}
			}
			decrease_popularity_5 = yes
			set_party_index_to_ruling_party = yes
			set_temp_variable = { party_popularity_increase = -0.05 }
			add_relative_party_popularity = yes
			steal_popularity_from_fiscal_liberals = yes
		}
	}
	option = {
		name = small_medium_business_owners_request_events.1.o2
		log = "[GetDateText]: [This.GetName]: small_medium_business_owners_request_events.1.o2 executed"	#Prevent it
		ai_chance = { factor = 1 }
		lose_pp_for_month = yes
		decrease_small_medium_business_owners_opinion = yes
		if = {
			limit = { has_idea = international_bankers }
			decrease_international_bankers_opinion = yes
		}
		if = {
			limit = {
				has_economically_liberal_government = yes
			}
			decrease_popularity_5 = yes
			set_party_index_to_ruling_party = yes
			set_temp_variable = { party_popularity_increase = -0.05 }
			add_relative_party_popularity = yes
			steal_popularity_from_patriots = yes
		}	
	}
	option = {
		name = small_medium_business_owners_request_events.1.o3
		log = "[GetDateText]: [This.GetName]: small_medium_business_owners_request_events.1.o3 executed"	#State buys it
		ai_chance = { factor = 1 }
		SE_remove_5_treasury = yes
		if = {
			limit = { has_idea = international_bankers }
			decrease_international_bankers_opinion = yes
		}
		if = {
			limit = {
				has_economically_liberal_government = yes
			}
			decrease_popularity_5 = yes
			set_party_index_to_ruling_party = yes
			set_temp_variable = { party_popularity_increase = -0.05 }
			add_relative_party_popularity = yes
			steal_popularity_from_socialists = yes
		}	
	}
	option = {
		name = small_medium_business_owners_request_events.1.o4
		log = "[GetDateText]: [This.GetName]: small_medium_business_owners_request_events.1.o3 executed"	#Merge with a domestic company
		trigger = {
			has_idea = industrial_conglomerates
			has_communist_government = yes
		}
		ai_chance = { factor = 1 }
		decrease_small_medium_business_owners_opinion = yes
		increase_industrial_conglomerates_opinion = yes
	}
}

#Small startups strangled by bureaucracy
country_event = {
	id = small_medium_business_owners_request_events.2
	title = small_medium_business_owners_request_events.2.t
	desc = small_medium_business_owners_request_events.2.d
	immediate = { log = "[Get.DateText]: [This.GetName]: small_medium_business_owners_request_events.2" }
	picture = GFX_internal_faction_too_much_bureaucracy
	
	is_triggered_only = yes
	trigger = {
		has_idea = small_medium_business_owners
		OR = {
			has_idea = bureau_04
			has_idea = bureau_05
		}
	}
	
	mean_time_to_happen = {
		days = 1
		#More likely if really high bureaucracy
		modifier = {
			factor = 1.5
			has_idea = bureau_05
		}
		#More likely if high corruption
		modifier = {
			factor = 1.5
			OR = {
				has_idea = paralyzing_corruption      
				has_idea = crippling_corruption     
				has_idea = rampant_corruption    
				has_idea = unrestrained_corruption   
				has_idea = systematic_corruption  
				has_idea = widespread_corruption 
			}
		}
	}
	
	option = {
		name = small_medium_business_owners_request_events.2.o1
		log = "[GetDateText]: [This.GetName]: small_medium_business_owners_request_events.2.o1 executed"	#Lower bureaucracy
		ai_chance = { factor = 1 }
		decrease_centralization = yes
		increase_small_medium_business_owners_opinion = yes		
		add_timed_idea = {
			idea = internal_faction_locked_bureau_spending
			days = 360
		}		
	}
	option = {
		name = small_medium_business_owners_request_events.2.o2
		log = "[GetDateText]: [This.GetName]: small_medium_business_owners_request_events.2.o2 executed"	#Don't lower bureaucracy
		ai_chance = { factor = 1 }
		decrease_small_medium_business_owners_opinion = yes	
	}
	option = {
		name = small_medium_business_owners_request_events.2.o3
		log = "[GetDateText]: [This.GetName]: small_medium_business_owners_request_events.2.o3 executed"	#Give advantages to some
		ai_chance = { factor = 1 }
		increase_corruption = yes
		increase_small_medium_business_owners_opinion = yes
		add_2_popularity = yes
		set_party_index_to_ruling_party = yes
		set_temp_variable = { party_popularity_increase = 0.02 }
		add_relative_party_popularity = yes
	}
}