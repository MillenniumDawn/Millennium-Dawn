scripted_gui = {
	companies_slot = {
		window_name = "companies_slot"
        context_type = player_context
		parent_window_token = politics_tab

		effects = {
            companies_slot_btn_click = {
				if = {
					limit = {
						has_country_flag = CAC_companies_list
					}

					clr_country_flag = CAC_companies_list
					set_variable = { opened_company_details = -1 }
				}
				else = {
					set_country_flag = CAC_companies_list
				}
            }
		}
	}

    companies_list_window = {
		window_name = "companies_list_window"
        context_type = player_context
		parent_window_token = politics_tab

        visible = {
			ROOT = {
				AND = {
					is_ai = no
					has_country_flag = CAC_companies_list
				}
			}
		}
		
		triggers = {
			sort_value_click_enabled = {
			}
		}

		effects = {
			companies_details_button_click = {
				set_variable = { opened_company_details = CAC_companies^v }
			}

			sort_size_click = {
				clear_array = CAC_sorted_companies

				for_loop_effect = {
					start = 0
					end = CAC_companies^num
					value = i

					set_temp_variable = { added = 0 }

					for_each_loop = {
						array = CAC_sorted_companies
						index = j
						value = v
						break = added

						set_temp_variable = { index = CAC_sorted_companies^j }

						if = {
							limit = {
								AND = {
									check_variable = { CAC_companies_size^v < CAC_companies_size^i }
								}
							}

							add_to_array = {
								array = CAC_sorted_companies
								value = CAC_companies^i
								index = j
							}

							set_temp_variable = { added = 1 }
						}
					}

					if = {
						limit = { check_variable = { added = 0 } }

						add_to_array = {
							array = CAC_sorted_companies
							value = CAC_companies^i
							index = CAC_sorted_companies^num
						}
					}
				}
			}

			sort_money_click = {
				clear_array = CAC_sorted_companies

				for_loop_effect = {
					start = 0
					end = CAC_companies^num
					value = i

					set_temp_variable = { added = 0 }

					for_each_loop = {
						array = CAC_sorted_companies
						index = j
						value = v
						break = added

						set_temp_variable = { index = CAC_sorted_companies^j }

						if = {
							limit = {
								AND = {
									check_variable = { CAC_companies_money^v < CAC_companies_money^i }
								}
							}

							add_to_array = {
								array = CAC_sorted_companies
								value = CAC_companies^i
								index = j
							}

							set_temp_variable = { added = 1 }
						}
					}

					if = {
						limit = { check_variable = { added = 0 } }

						add_to_array = {
							array = CAC_sorted_companies
							value = CAC_companies^i
							index = CAC_sorted_companies^num
						}
					}
				}
			}

			sort_value_click = {
				clear_array = CAC_sorted_companies

				for_loop_effect = {
					start = 0
					end = CAC_companies^num
					value = i

					set_temp_variable = { added = 0 }

					for_each_loop = {
						array = CAC_sorted_companies
						index = j
						value = v
						break = added

						set_temp_variable = { index = CAC_sorted_companies^j }

						if = {
							limit = {
								AND = {
									check_variable = { CAC_companies_value^v < CAC_companies_value^i }
								}
							}

							add_to_array = {
								array = CAC_sorted_companies
								value = CAC_companies^i
								index = j
							}

							set_temp_variable = { added = 1 }
						}
					}

					if = {
						limit = { check_variable = { added = 0 } }

						add_to_array = {
							array = CAC_sorted_companies
							value = CAC_companies^i
							index = CAC_sorted_companies^num
						}
					}
				}
			}

			sort_revenue_click = {
				clear_array = CAC_sorted_companies

				for_loop_effect = {
					start = 0
					end = CAC_companies^num
					value = i

					set_temp_variable = { added = 0 }

					for_each_loop = {
						array = CAC_sorted_companies
						index = j
						value = v
						break = added

						set_temp_variable = { index = CAC_sorted_companies^j }

						if = {
							limit = {
								AND = {
									check_variable = { CAC_companies_revenue^v < CAC_companies_revenue^i }
								}
							}

							add_to_array = {
								array = CAC_sorted_companies
								value = CAC_companies^i
								index = j
							}

							set_temp_variable = { added = 1 }
						}
					}

					if = {
						limit = { check_variable = { added = 0 } }

						add_to_array = {
							array = CAC_sorted_companies
							value = CAC_companies^i
							index = CAC_sorted_companies^num
						}
					}
				}
			}

			sort_factories_click = {
				clear_array = CAC_sorted_companies

				for_loop_effect = {
					start = 0
					end = CAC_companies^num
					value = i

					set_temp_variable = { added = 0 }

					for_each_loop = {
						array = CAC_sorted_companies
						index = j
						value = v
						break = added

						set_temp_variable = { index = CAC_sorted_companies^j }

						if = {
							limit = {
								AND = {
									check_variable = { CAC_companies_factories^v < CAC_companies_factories^i }
								}
							}

							add_to_array = {
								array = CAC_sorted_companies
								value = CAC_companies^i
								index = j
							}

							set_temp_variable = { added = 1 }
						}
					}

					if = {
						limit = { check_variable = { added = 0 } }

						add_to_array = {
							array = CAC_sorted_companies
							value = CAC_companies^i
							index = CAC_sorted_companies^num
						}
					}
				}
			}

			close_click = {
				clr_country_flag = CAC_companies_list
				set_variable = { opened_company_details = -1 }
            }
		}

		properties = {
			avaible_companies_grid_item_icon = {
				image = "[CAC_icon_of_company]"
			}
		}

        dynamic_lists = {
            avaible_companies_grid = {
                array = CAC_sorted_companies #companies_sorted_temp
                entry_container = "avaible_companies_grid_list_item"
            }
        }
	}

    company_detail_window = {
		window_name = "company_detail_window"
        context_type = player_context

        visible = {
			ROOT = {
				AND = {
					is_ai = no
					check_variable = { opened_company_details > -1 }
					has_country_flag = CAC_companies_list
				}
			}
		}

		properties = {
			company_detail_icon = {
				image = "[CAC_icon_of_company_detail]"
			}
			company_history_tab = {
				frame = companies_history_tab
			}
			company_upgrades_tab = {
				frame = companies_upgrades_tab
			}
		}

		triggers = {			
			country_action_1_visible = {
				has_country_flag = country_actions_ui
			}

			country_action_2_visible = {
				has_country_flag = country_actions_ui
			}

			country_action_3_visible = {
				has_country_flag = country_actions_ui
			}

			country_action_4_visible = {
				has_country_flag = country_actions_ui
			}

			company_action_1_visible = {
				NOT = {
					has_country_flag = country_actions_ui
				}	
			}

			company_action_2_visible = {
				NOT = {
					has_country_flag = country_actions_ui
				}	
			}

			company_action_3_visible = {
				NOT = {
					has_country_flag = country_actions_ui
				}	
			}
			company_action_4_visible = {
				NOT = {
					has_country_flag = country_actions_ui
				}	
			}

			company_action_1_click_enabled = {
				AND = {
					check_variable = { CAC_companies_expenses_per_factory^opened_company_details > 0.1 }
					check_variable = { CAC_companies_money^opened_company_details > 0.999 }
					NOT = { has_country_flag = company_action_1_timeout }
				}
			}

			company_action_2_click_enabled = {
				AND = {
					check_variable = { CAC_companies_money^opened_company_details > 2.599 }
					NOT = { has_country_flag = company_action_2_timeout }
				}
			}

			company_action_3_click_enabled = {
				AND = {
					check_variable = { CAC_companies_money^opened_company_details > 4.999 }
					NOT = { has_country_flag = company_action_3_timeout }
				}
			}

			company_action_4_click_enabled = {
				AND = {
					check_variable = { CAC_companies_money^opened_company_details > 9.999 }
				}
			}

			country_action_1_click_enabled = {
				AND = {
					check_variable = { political_power > 99 }
					NOT = { has_country_flag = country_action_1_timeout }
				}
			}

			country_action_2_click_enabled = {
				AND = {
					NOT = { has_country_flag = country_action_2_timeout }
				}
			}

			country_action_3_click_enabled = {
				AND = {
					NOT = { has_country_flag = country_action_3_timeout }
				}
			}

			country_action_4_click_enabled = {
				AND = {
					NOT = { has_country_flag = country_action_4_timeout }
				}
			}
		}

		effects = {
			company_action_switch_page_company_click = {
				clr_country_flag = country_actions_ui
			}

			company_action_switch_page_country_click = {
				set_country_flag = country_actions_ui
			}
			
			company_action_1_click = {
				set_country_flag = {
					flag = company_action_1_timeout
					days = 30
					value = 1
				}

                set_temp_variable = { cac_money_change = -1.0 }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_money_effect = yes

				set_temp_variable = { cac_expenses_per_factory_change = -0.015 }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_change_expenses_per_factory_effect = yes

				CAC_update_variables = yes
			}

			company_action_2_click = {
				set_country_flag = {
					flag = company_action_2_timeout
					days = 30
					value = 1
				}

                set_temp_variable = { cac_money_change = -2.5 }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_money_effect = yes
				
				set_temp_variable = { cac_income_per_factory_change = 0.02 }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_change_income_per_factory_effect = yes

				CAC_update_variables = yes
			}

			company_action_3_click = {
				set_country_flag = {
					flag = company_action_3_timeout
					days = 30
					value = 1
				}

                set_temp_variable = { cac_money_change = -5 }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_money_effect = yes

				set_temp_variable = { cac_additional_income_change = 0.05 }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_additional_income_effect = yes

				set_temp_variable = { cac_value_change = 4 }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_value_effect = yes

				CAC_update_variables = yes
			}

			company_action_4_click = {
                set_temp_variable = { cac_money_change = -10 }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_money_effect = yes

				set_temp_variable = { cac_factories_change = 1 }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_factories_effect = yes

				CAC_update_variables = yes
			}

			country_action_1_click = {
				set_country_flag = {
					flag = country_action_1_timeout
					days = 30
					value = 1
				}

       			ROOT = { add_political_power = -100 }

				CAC_add_government_contract_idea = yes # DODO
			}

			country_action_2_click = {
				set_country_flag = {
					flag = country_action_2_timeout
					days = 30
					value = 1
				}

				set_temp_variable = { treasury_change = -1.0 }
				modify_treasury_effect = yes

				set_temp_variable = { cac_money_change = 1 }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_money_effect = yes

				CAC_update_variables = yes
			}

			country_action_3_click = {
				set_country_flag = {
					flag = country_action_3_timeout
					days = 30
					value = 1
				}

				set_temp_variable = { treasury_change = -2.5 }
				modify_treasury_effect = yes

				set_temp_variable = { cac_money_change = 2 }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_money_effect = yes

				CAC_update_variables = yes
			}

			country_action_4_click = {
				set_country_flag = {
					flag = country_action_4_timeout
					days = 30
					value = 1
				}

				set_temp_variable = { treasury_change = -5.0 }
				modify_treasury_effect = yes

				set_temp_variable = { cac_money_change = 4 }
				set_temp_variable = { cac_slot = opened_company_details }
				CAC_modify_money_effect = yes
				
				CAC_update_variables = yes
			}

			select_ceo_btn_click = {
				set_country_flag = ceo_window_open
			}

			company_history_tab_click = {
				set_variable = { companies_history_tab = 1 }
				set_variable = { companies_upgrades_tab = 2 }
			}

			company_upgrades_tab_click = {
				set_variable = { companies_history_tab = 2 }
				set_variable = { companies_upgrades_tab = 1 }
			}

			close_click = {
                set_variable = { opened_company_details = -1 }
            }
		}
	}

	company_history_window = {
		window_name = "company_history_window"
		context_type = player_context
		parent_window_name = "company_detail_window"

		visible = {
			ROOT = {
				AND = {
					is_ai = no
					check_variable = { opened_company_details > -1 }
					check_variable = { companies_history_tab = 1 }
				}
			}
		}

		dynamic_lists = {
            company_statistics_grid = {
                array = CAC_companies
                entry_container = "company_statistics_grid_item"
            }

			company_global_statistics_grid = {
                array = global.CAC_global_companies
                entry_container = "company_global_statistics_grid_item"
            }
        }

		properties = {
			company_statistics_grid_icon = {
				image = "[CAC_icon_of_company_detail]"
			}
			company_global_statistics_grid_icon = {
				image = "[CAC_icon_of_company]"
			}
		}
	}
	company_select_ceo_window = {
		window_name = "company_select_ceo_window"
        context_type = player_context
		parent_window_name = "company_detail_window"

		visible = {
			ROOT = {
				AND = {
					has_country_flag = ceo_window_open
				}
			}
		}

		effects = {
			close_click = {
				clr_country_flag = ceo_window_open
			}
		}
	}
}