EU_voting_category = {
	
	Test_focus_EU001 = {
	
		available = {
			NOT = { has_country_flag = focus_EU001 }
		}
		
		visible = { 
			has_idea = EU_member 
		} 
		
		complete_effect = {   						
			set_country_flag = focus_EU001
		}				
	}
	Test_focus_EU001_retry = {
	
		available = {
			has_idea = EU_member
			any_country = {
				OR = {
					has_country_flag = focus_EU001_no
					has_country_flag = focus_EU001_QMV_no
					has_country_flag = focus_EU001_maj_no			
				}
				NOT = { 	
					has_country_flag = focus_EU001_yes
				}
			}
		}
		
		visible = { 
			has_idea = EU_member
			any_country = {
				OR = {
					has_country_flag = focus_EU001_no
					has_country_flag = focus_EU001_QMV_no
					has_country_flag = focus_EU001_maj_no			
				}
				NOT = { 	
					has_country_flag = focus_EU001_yes
				}
			}
		} 
		
		complete_effect = {
			clr_global_flag = focus_EU001_voted
			every_country = {	
					clr_country_flag = focus_EU001
					clr_country_flag = focus_EU001_no
					clr_country_flag = focus_EU001_QMV_no
					clr_country_flag = focus_EU001_maj_no					
			}
			set_country_flag = focus_EU001
		}				
	}
	
	Test_focus_EU001_QMV = {
	
		available = {
			NOT = { has_country_flag = focus_EU001_QMV }
		}
		
		visible = { 
			has_idea = EU_member 
		} 
		
		complete_effect = {   						
			set_country_flag = focus_EU001_QMV
		}				
	}
	
	Test_focus_EU001_maj = {
	
		available = {
			NOT = { has_country_flag = focus_EU001_maj }
		}
		
		visible = { 
			has_idea = EU_member 
		} 
		
		complete_effect = {   						
			set_country_flag = focus_EU001_maj
		}				
	}
	
	Test_influence = {
	
		available = {
			has_idea = EU_member
		}
		
		visible = { 
			has_idea = EU_member 
		} 
		
		complete_effect = {   						
			 set_temp_variable = { 
				influence_gain = 70 
			}
			for_loop_effect = { 
				end = influence_array^num value = v 
					if = { 
						limit = { 
							check_variable = { influence_array^v = GER } 
						} 
						add_to_variable = { influence_array_val^v = influence_gain }
						set_country_flag = found 
					} 
			} 
			if = { 
				limit = { 
					NOT = { has_country_flag = found } 
				} 
				add_to_array = { influence_array = GER.id }
				add_to_array = { influence_array_val = influence_gain } 
			} 
			clr_country_flag = found
			recalculate_influence = yes
		}				
	}

	EU_voting_decision_focus01 = {
	
		icon = GFX_decision_generic_european_union
	
		available = {
			custom_trigger_tooltip = {
				tooltip = test123
				AND = {
					has_country_flag = focus_EU001
					NOT = { 
							has_global_flag = focus_EU001_voted
							has_country_flag = focus_EU001_yes
					}
					all_country = {	
						OR = {
							AND = {
								set_temp_variable = { temp_idx = -1 }
								any_of = {
									array = influence_array
									value = v
									index = i
									if = {
										limit = { var:v = { tag = ROOT } }
										set_temp_variable = { temp_idx = i }
										always = yes
									}
									else = { always = no }
								}
								check_variable = { temp_idx > -1 }
								check_variable = { influence_array_calc^temp_idx > 0.03 }						
							}	
							tag = PREV
							NOT = { has_idea = EU_member }
						}
					}					
				}	
			}
		}
		
		visible = { 
			has_country_flag = focus_EU001
			NOT = { 
				has_global_flag = focus_EU001_voted
				has_country_flag = focus_EU001_yes
			}
		}
		
		complete_effect = {
			set_global_flag = focus_EU001_voted
			set_global_flag = EU_unanimity_voting
			set_variable = {	
				var = global.var_EUvoteYes
				value = 0
			}
			set_variable = {	
				var = global.var_EUvoteNo
				value = 0
			}
			set_variable = {	
				var = global.var_EUvoteTotal
				value = 0
			}
			set_variable = {	
				var = global.var_EUpopYes
				value = 0
			}
			set_variable = {	
				var = global.var_EUpopNo
				value = 0
			}				
			every_country = {
				limit = { has_idea = EU_member }
				country_event = {
					id = EUvote.1
				}
			}
		}
	}
	
	EU_voting_decision_focus01_QMV = {
	
		icon = GFX_decision_generic_european_union
	
		available = {
			custom_trigger_tooltip = {
				tooltip = test123
				AND = {
					has_country_flag = focus_EU001_QMV
					NOT = { 
							has_global_flag = focus_EU001_QMV_voted
							has_country_flag = focus_EU001_QMV_yes
					}
					all_country = {	
						OR = {
							AND = {
								set_temp_variable = { temp_idx = -1 }
								any_of = {
									array = influence_array
									value = v
									index = i
									if = {
										limit = { var:v = { tag = ROOT } }
										set_temp_variable = { temp_idx = i }
										always = yes
									}
									else = { always = no }
								}
								check_variable = { temp_idx > -1 }
								check_variable = { influence_array_calc^temp_idx > 0.03 }						
							}	
							tag = PREV
							NOT = { has_idea = EU_member }
						}
					}					
				}	
			}
		}
		
		visible = { 
			has_country_flag = focus_EU001_QMV
			NOT = { 
				has_global_flag = focus_EU001_QMV_voted
				has_country_flag = focus_EU001_QMV_yes
			}
		}
		
		complete_effect = {
			set_global_flag = focus_EU001_QMV_voted
			set_global_flag = EU_qualified_majority_voting
			set_variable = {	
				var = global.var_EUvoteYes
				value = 0
			}
			set_variable = {	
				var = global.var_EUvoteNo
				value = 0
			}
			set_variable = {	
				var = global.var_EUvoteTotal
				value = 0
			}
			set_variable = {	
				var = global.var_EUpopYes
				value = 0
			}
			set_variable = {	
				var = global.var_EUpopNo
				value = 0
			}				
			every_country = {
				limit = { has_idea = EU_member }
				country_event = {
					id = EUvote.1
				}
			}
		}
	}

	EU_voting_decision_focus01_maj = {
	
		icon = GFX_decision_generic_european_union
	
		available = {
			custom_trigger_tooltip = {
				tooltip = test123
				AND = {
					has_country_flag = focus_EU001_maj
					NOT = { 
							has_global_flag = focus_EU001_maj_voted
							has_country_flag = focus_EU001_maj_yes
					}
					all_country = {	
						OR = {
							AND = {
								set_temp_variable = { temp_idx = -1 }
								any_of = {
									array = influence_array
									value = v
									index = i
									if = {
										limit = { var:v = { tag = ROOT } }
										set_temp_variable = { temp_idx = i }
										always = yes
									}
									else = { always = no }
								}
								check_variable = { temp_idx > -1 }
								check_variable = { influence_array_calc^temp_idx > 0.03 }						
							}	
							tag = PREV
							NOT = { has_idea = EU_member }
						}
					}					
				}	
			}
		}
		
		visible = { 
			has_country_flag = focus_EU001_maj
			NOT = { 
				has_global_flag = focus_EU001_maj_voted
				has_country_flag = focus_EU001_maj_yes
			}
		}
		
		complete_effect = {
			set_global_flag = focus_EU001_maj_voted
			set_global_flag = EU_majority_voting
			set_variable = {	
				var = global.var_EUvoteYes
				value = 0
			}
			set_variable = {	
				var = global.var_EUvoteNo
				value = 0
			}
			set_variable = {	
				var = global.var_EUvoteTotal
				value = 0
			}
			set_variable = {	
				var = global.var_EUpopYes
				value = 0
			}
			set_variable = {	
				var = global.var_EUpopNo
				value = 0
			}				
			every_country = {
				limit = { has_idea = EU_member }
				country_event = {
					id = EUvote.1
				}
			}
		}
	}

	EU_voting_decision_focus01_result = {
	
		icon = GFX_decision_generic_european_union
	
		available = {
			NOT = { has_global_flag = focus_EU001_result }
			has_global_flag = focus_EU001_voted
			check_variable = {
				var = global.var_EUvoteTotal
				value = global.var_EUmemberstatesTotal
				compare = equals
			}
		}
		visible = {
			NOT = { has_global_flag = focus_EU001_result }		
			has_global_flag = focus_EU001_voted
			check_variable = {
				var = global.var_EUvoteTotal
				value = global.var_EUmemberstatesTotal
				compare = equals
			}		
		}
		complete_effect = {
			set_global_flag = focus_EU001_result
			every_country = {
				limit = { has_country_flag = focus_EU001 }
				country_event = {
					id = EUvote.2
				}		
			}
		}
		ai_will_do = {
			factor = 100
		}
	}		

	EU_voting_decision_focus01_QMV_result = {
	
		icon = GFX_decision_generic_european_union
	
		available = {
			NOT = { has_global_flag = focus_EU001_QMV_result }
			has_global_flag = focus_EU001_QMV_voted
			check_variable = {
				var = global.var_EUvoteTotal
				value = global.var_EUmemberstatesTotal
				compare = equals
			}
		}
		visible = {
			NOT = { has_global_flag = focus_EU001_QMV_result }		
			has_global_flag = focus_EU001_QMV_voted
			check_variable = {
				var = global.var_EUvoteTotal
				value = global.var_EUmemberstatesTotal
				compare = equals
			}		
		}
		complete_effect = {
			set_global_flag = focus_EU001_QMV_result
			every_country = {
				limit = { has_country_flag = focus_EU001_QMV }
				country_event = {
					id = EUvote.2
				}		
			}
		}
		ai_will_do = {
			factor = 100
		}
	}

	EU_voting_decision_focus01_maj_result = {
	
		icon = GFX_decision_generic_european_union
	
		available = {
			NOT = { has_global_flag = focus_EU001_maj_result }
			has_global_flag = focus_EU001_maj_voted
			check_variable = {
				var = global.var_EUvoteTotal
				value = global.var_EUmemberstatesTotal
				compare = equals
			}
		}
		visible = {
			NOT = { has_global_flag = focus_EU001_maj_result }		
			has_global_flag = focus_EU001_maj_voted
			check_variable = {
				var = global.var_EUvoteTotal
				value = global.var_EUmemberstatesTotal
				compare = equals
			}		
		}
		complete_effect = {
			set_global_flag = focus_EU001_maj_result
			every_country = {
				limit = { has_country_flag = focus_EU001_maj }
				country_event = {
					id = EUvote.2
				}		
			}
		}
		ai_will_do = {
			factor = 100
		}
	}

}


EU_SOTEU_category = {
		
	State_of_the_European_Union = {

		available = {
			has_idea = EU_member
		}
		
		visible = { 
			has_country_flag = EU_potential 
		} 
			
		complete_effect = {
			country_event = {
				id = EUevent.1
			}
		}
#		ai_will_do = {
#			factor = 100
#		}
	}
}
