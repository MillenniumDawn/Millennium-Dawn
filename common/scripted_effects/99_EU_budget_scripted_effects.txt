##################################
### EU Budget scripted effects ###
##################################

set_EU_gdp = {
	### EU GDP
	set_variable = { global.EU_size_modifier = 0 }	
	every_country = {
		limit = {
			has_idea = EU_member
		}
		add_to_variable = { global.EU_size_modifier = THIS.size_modifier }
	}
	set_variable = { global.EU_gdp = global.EU_size_modifier }
	multiply_variable = { global.EU_gdp = 365 }
	### EU GDP per capita
	#set_variable = { global.EU_gdp_capita = 1000000 }
	set_variable = { global.EU_gdp_capita = global.EU_gdp }
	divide_variable = { global.EU_gdp_capita = global.var_EUpopTotal }
	### GDP per billion, Pop per k
	multiply_variable = { global.EU_gdp_capita = 1000000 }
	#set_variable = { global.EU_mff_total = global.EU_size_modifier }
}

set_EU_total_budget = {
	### EU Total Budget
	set_variable = { global.EU_total_budget = global.EU_gdp }
	multiply_variable = { global.EU_total_budget = global.EU_budget_call_rate }
	divide_variable = { global.EU_total_budget = 100 }
	set_variable = { global.EU_mff_total = global.EU_total_budget }
	multiply_variable = { global.EU_mff_total = 5 }
	### member state contribution
	every_country = {
		limit = {
			has_idea = EU_member
		}
		set_variable = { THIS.EU_budget_call_rate = global.EU_budget_call_rate }
		set_variable = { THIS.EU_budget_contribution = THIS.size_modifier }
		multiply_variable = { THIS.EU_budget_contribution = 365 }
		multiply_variable = { THIS.EU_budget_contribution = THIS.EU_budget_call_rate }
		divide_variable = { THIS.EU_budget_contribution = 100 }
		set_variable = { THIS.EU_budget_ratio = THIS.EU_budget_contribution }
		divide_variable = { THIS.EU_budget_ratio = global.EU_total_budget }
	}
	### budget of next year

}

update_EU_budget_call_rate = {
	set_variable = { THIS.EU_budget_contribution = THIS.size_modifier }
	multiply_variable = { THIS.EU_budget_contribution = 365 }
	multiply_variable = { THIS.EU_budget_contribution = THIS.EU_budget_call_rate }
	divide_variable = { THIS.EU_budget_contribution = 100 }
	set_variable = { THIS.EU_budget_ratio = THIS.EU_budget_contribution }
	divide_variable = { THIS.EU_budget_ratio = global.EU_total_budget }	
}

set_EU_expenditure = {
	set_variable = { global.EU_total_exp = global.EU_total_budget }
	set_variable = { global.EU_growth_exp_ratio = 0.44 }
	set_variable = { global.EU_natural_exp_ratio = 0.44 }
	set_variable = { global.EU_global_exp_ratio = 0.06 }
	set_variable = { global.EU_admin_exp_ratio = 0.06 }
	set_variable = { global.EU_growth_exp_total = global.EU_growth_exp_ratio }
	set_variable = { global.EU_natural_exp_total = global.EU_natural_exp_ratio }
	set_variable = { global.EU_global_exp_total = global.EU_global_exp_ratio }
	set_variable = { global.EU_admin_exp_total = global.EU_admin_exp_ratio }
	
	multiply_variable = { global.EU_growth_exp_total = global.EU_total_exp }
	multiply_variable = { global.EU_natural_exp_total = global.EU_total_exp }
	multiply_variable = { global.EU_global_exp_total = global.EU_total_exp }
	multiply_variable = { global.EU_admin_exp_total = global.EU_total_exp }	
}

update_EU_expenditure = {
	set_variable = { global.EU_growth_exp_total = global.EU_growth_exp_ratio }
	set_variable = { global.EU_natural_exp_total = global.EU_natural_exp_ratio }
	set_variable = { global.EU_global_exp_total = global.EU_global_exp_ratio }
	set_variable = { global.EU_admin_exp_total = global.EU_admin_exp_ratio }
	
	multiply_variable = { global.EU_growth_exp_total = global.EU_total_exp }
	multiply_variable = { global.EU_natural_exp_total = global.EU_total_exp }
	multiply_variable = { global.EU_global_exp_total = global.EU_total_exp }
	multiply_variable = { global.EU_admin_exp_total = global.EU_total_exp }	
}


distribute_EU_budget = {
	distribute_EU_growth_exp = yes
	distribute_EU_natural_exp = yes
	### distribute_EU_global_exp
	if = {
		limit = {
			is_leader_of_EU_foreign_policy = yes
		}
		set_variable = { EU_global_exp_subsidies = global.EU_global_exp_total }
	}
	distribute_EU_admin_exp = yes		
}

distribute_EU_growth_exp = {
	every_country = {
		limit = {
			has_idea = EU_member
		}
		if = {
			limit = {
				has_idea = economic_boom
			}
			set_variable = { EU_growth_subsidies = 1 }
			multiply_variable = { EU_growth_subsidies = max_manpower_k }
			add_to_variable = { global.EU_growth_subsidies_total = EU_growth_subsidies }
		}
		if = {
			limit = {
				has_idea = fast_growth
			}
			set_variable = { EU_growth_subsidies = 2 }
			multiply_variable = { EU_growth_subsidies = max_manpower_k }
			add_to_variable = { global.EU_growth_subsidies_total = EU_growth_subsidies }
		}
		if = {
			limit = {
				has_idea = stable_growth
			}
			set_variable = { EU_growth_subsidies = 3 }
			multiply_variable = { EU_growth_subsidies = max_manpower_k }
			add_to_variable = { global.EU_growth_subsidies_total = EU_growth_subsidies }
		}
		if = {
			limit = {
				has_idea = stagnation
			}
			set_variable = { EU_growth_subsidies = 4 }
			multiply_variable = { EU_growth_subsidies = max_manpower_k }
			add_to_variable = { global.EU_growth_subsidies_total = EU_growth_subsidies }
		}
		if = {
			limit = {
				has_idea = recession
			}
			set_variable = { EU_growth_subsidies = 5 }
			multiply_variable = { EU_growth_subsidies = max_manpower_k }
			add_to_variable = { global.EU_growth_subsidies_total = EU_growth_subsidies }
		}
		if = {
			limit = {
				has_idea = depression
			}
			set_variable = { EU_growth_subsidies = 6 }
			multiply_variable = { EU_growth_subsidies = max_manpower_k }
			add_to_variable = { global.EU_growth_subsidies_total = EU_growth_subsidies }
		}
		divide_variable = { EU_growth_subsidies = global.EU_growth_subsidies_total }
		multiply_variable = { EU_growth_subsidies = global.EU_growth_exp_total }
}

distribute_EU_natural_exp = {
	every_country = {
		limit = {
			has_idea = EU_member
		}
		if = {
			limit = {
				has_idea = gdp_12
			}
			set_variable = { EU_natural_subsidies = 1 }
			multiply_variable = { EU_natural_subsidies = max_manpower_k }
			add_to_variable = { global.EU_natural_subsidies_total = EU_natural_subsidies }
		}
		if = {
			limit = {
				has_idea = gdp_11
			}
			set_variable = { EU_natural_subsidies = 2 }
			multiply_variable = { EU_natural_subsidies = max_manpower_k }
			add_to_variable = { global.EU_natural_subsidies_total = EU_natural_subsidies }
		}
		if = {
			limit = {
				has_idea = gdp_10
			}
			set_variable = { EU_natural_subsidies = 3 }
			multiply_variable = { EU_natural_subsidies = max_manpower_k }
			add_to_variable = { global.EU_natural_subsidies_total = EU_natural_subsidies }
		}
		if = {
			limit = {
				has_idea = gdp_9
			}
			set_variable = { EU_natural_subsidies = 4 }
			multiply_variable = { EU_natural_subsidies = max_manpower_k }
			add_to_variable = { global.EU_natural_subsidies_total = EU_natural_subsidies }
		}
		if = {
			limit = {
				has_idea = gdp_8
			}
			set_variable = { EU_natural_subsidies = 5 }
			multiply_variable = { EU_natural_subsidies = max_manpower_k }
			add_to_variable = { global.EU_natural_subsidies_total = EU_natural_subsidies }
		}
		if = {
			limit = {
				has_idea = gdp_7
			}
			set_variable = { EU_natural_subsidies = 6 }
			multiply_variable = { EU_natural_subsidies = max_manpower_k }
			add_to_variable = { global.EU_natural_subsidies_total = EU_natural_subsidies }
		}
		if = {
			limit = {
				has_idea = gdp_6
			}
			set_variable = { EU_natural_subsidies = 7 }
			multiply_variable = { EU_natural_subsidies = max_manpower_k }
			add_to_variable = { global.EU_natural_subsidies_total = EU_natural_subsidies }
		}
		if = {
			limit = {
				has_idea = gdp_5
			}
			set_variable = { EU_natural_subsidies = 8 }
			multiply_variable = { EU_natural_subsidies = max_manpower_k }
			add_to_variable = { global.EU_natural_subsidies_total = EU_natural_subsidies }
		}
		if = {
			limit = {
				has_idea = gdp_4
			}
			set_variable = { EU_natural_subsidies = 9 }
			multiply_variable = { EU_natural_subsidies = max_manpower_k }
			add_to_variable = { global.EU_natural_subsidies_total = EU_natural_subsidies }
		}
		if = {
			limit = {
				has_idea = gdp_3
			}
			set_variable = { EU_natural_subsidies = 10 }
			multiply_variable = { EU_natural_subsidies = max_manpower_k }
			add_to_variable = { global.EU_natural_subsidies_total = EU_natural_subsidies }
		}
		if = {
			limit = {
				has_idea = gdp_2
			}
			set_variable = { EU_natural_subsidies = 11 }
			multiply_variable = { EU_natural_subsidies = max_manpower_k }
			add_to_variable = { global.EU_natural_subsidies_total = EU_natural_subsidies }
		}
		if = {
			limit = {
				has_idea = gdp_1
			}
			set_variable = { EU_natural_subsidies = 12 }
			multiply_variable = { EU_natural_subsidies = max_manpower_k }
			add_to_variable = { global.EU_natural_subsidies_total = EU_natural_subsidies }
		}		
		divide_variable = { EU_natural_subsidies = global.EU_natural_subsidies_total }
		multiply_variable = { EU_natural_subsidies = global.EU_natural_exp_total }
}

###WIP
distribute_EU_admin_exp = {	
	set_variable = { global.EU_admin_subsidies_total = 1 }
	set_temp_variable = { temp1 = 1 }
	every_country = {
		limit = {
			has_idea = EU_member
		}
		if = {
			limit = {
				has_idea = frontex_ExDir
			}
			set_variable = { EU_admin_subsidies = 0.2 }
			subtract_from_variable = { global.EU_admin_subsidies_total = EU_admin_subsidies }
		}
		if = {
			limit = {
				has_idea = EU_commission_president
			}
			set_variable = { EU_admin_subsidies = 0.2 }
			subtract_from_variable = { global.EU_admin_subsidies_total = EU_admin_subsidies }
		}

		if = {
			limit = {
				has_EU_external_home_border = yes
			}
			add_to_temp_variable = { temp1 = 1 }			
		}
		#divide_variable = { global.EU_natural_subsidies_total = temp1 }

			#set_variable = { EU_admin_subsidies = 0.2 }
			#subtract_from_variable = { global.EU_admin_subsidies_total = EU_admin_subsidies }
	}		
}
