add_namespace = Afghanistan
add_namespace = AfghanistanNews
add_namespace = AfghanistanBorderWars
add_namespace = AfghanistanInvestment
add_namespace = TalibanAttack
add_namespace = TalibanInsurgency

### Afghanistan civil war cleanup events ###

#Give the winner AFG cosmetic tag
country_event = {
	id = Afghanistan.0
	immediate = { log = "[GetDateText]: [Root.GetName]: event Afghanistan.0" }

	hidden = yes

	trigger = {
		OR = {
			AND = {
				tag = AFG
				NOT = {
					country_exists = TAL
				}
			}
			AND = {
				tag = TAL
				NOT = {
					country_exists = AFG
				}
			}
		}
		NOT = { has_global_flag = Afghanistan_Civil_War_Over }
	}

	mean_time_to_happen = {
		days = 2
	}

	immediate = {
		#Civil war is over
		set_global_flag = Afghanistan_Civil_War_Over
		#Clear core status
		409 = {
			remove_core_of = AFG
			remove_core_of = TAL
		}
		410 = {
			remove_core_of = AFG
			remove_core_of = TAL
		}
		411 = {
			remove_core_of = AFG
			remove_core_of = TAL
		}
		412 = {
			remove_core_of = AFG
			remove_core_of = TAL
		}
		414 = {
			remove_core_of = AFG
			remove_core_of = TAL
		}
		415 = {
			remove_core_of = AFG
			remove_core_of = TAL
		}
		#Make the winner Afghanistan
		drop_cosmetic_tag = yes
		if = {
			limit = { has_idea = Non_State_Actor }
			remove_ideas = Non_State_Actor
		}
		if = {
			limit = { has_idea = rival_government }
			remove_ideas = rival_government
		}
		if = {
			limit = {
				tag = TAL
			}
			set_cosmetic_tag = AFG
			set_country_flag = dynamic_flag
			set_country_flag = dynamic_rebel_flag
			add_ideas = intervention_neo_imperialism
		}
		add_state_core = 409
		add_state_core = 410
		add_state_core = 411
		add_state_core = 412
		add_state_core = 414
		add_state_core = 415
		set_capital = { state = 414 }
		subtract_from_variable = { threat_level = 30 }
		clamp_threat = yes

		#Start of Taliban Insurgency
		if = {
			limit = {
				original_tag = AFG
			}
			set_temp_variable = { taliban_strength_increase = 35 }
			increase_taliban_strength = yes
			country_event = {
				id = TalibanInsurgency.0
				days = 1
			}
		}

		news_event = { id = AfghanistanNews.1 hours = 6 }
	}
}

#Recreate Afghanistan in case it has been annexed
country_event = {
	id = Afghanistan.1
	immediate = { log = "[GetDateText]: [Root.GetName]: event Afghanistan.1" }

	hidden = yes

	trigger = {
		NOT = {
			country_exists = AFG
			country_exists = TAL
		}
		NOT = { 414 = { is_core_of = AFG } }
	}

	mean_time_to_happen = {
		days = 2
	}

	immediate = {
		#Clear core status
		409 = {
			remove_core_of = AFG
			remove_core_of = TAL
		}
		410 = {
			remove_core_of = AFG
			remove_core_of = TAL
		}
		411 = {
			remove_core_of = AFG
			remove_core_of = TAL
		}
		412 = {
			remove_core_of = AFG
			remove_core_of = TAL
		}
		414 = {
			remove_core_of = AFG
			remove_core_of = TAL
		}
		415 = {
			remove_core_of = AFG
			remove_core_of = TAL
		}
		AFG = {
			add_state_core = 409
			add_state_core = 410
			add_state_core = 411
			add_state_core = 412
			add_state_core = 414
			add_state_core = 415
			set_capital = { state = 414 }
		}
	}
}

#Death of Ahmad Shah Massoud  Neutral_conservatism
country_event = {

	id = Afghanistan.3
	title = Afghanistan.3.t
	desc = Afghanistan.3.d
	picture = GFX_ahmad_shah_massoud

	fire_only_once = yes

	trigger = {
		tag = AFG
		has_war_with = TAL
		USA = { NOT = { has_country_flag = Operation_enduring_freedom } }
		has_country_leader = { name = "Ahmed Shah Massoud" ruling_only = yes }
	}

	mean_time_to_happen = {
		days = 270
	}

	option = {
		name = Afghanistan.3.a
		log = "[GetDateText]: [This.GetName]: Afghanistan.3.a executed"
		ai_chance = { factor = 100 }
		random_list = {
			90 = {
				retire_character = AFG_ahmed_shah_massoud
				hidden_effect = {
					meta_effect = {
						text = {
							set_country_flag = [META_SET_RULING_PARTY]
						}
						META_SET_RULING_PARTY = "[meta_set_ruling_leader]"
					}
					set_leader = yes
					modifier = {
						has_completed_focus = AFG_loyal_guards
						factor = 50
					}
					modifier = {
						has_completed_focus = AFG_elite_guards
						factor = 10
					}
				}
				hidden_effect = { news_event = { id = AfghanistanNews.6 hours = 6 } }
				set_country_flag = Massoud_dead
			}
			10 = {
				modifier = {
					has_completed_focus = AFG_loyal_guards
					factor = 50
				}
				modifier = {
					has_completed_focus = AFG_elite_guards
					factor = 90
				}
			}
		}
	}

}

#US sets up a government
country_event = {
	id = Afghanistan.4
	title = Afghanistan.4.t
	desc = Afghanistan.4.d
	picture = GFX_bonn_agreement

	is_triggered_only = yes

	option = {
		name = Afghanistan.4.a
		log = "[GetDateText]: [This.GetName]: Afghanistan.4.a executed"
		ai_chance = { factor = 100 }
		if = {
			limit = { has_country_flag = AFG_new_administration_Karzai }
			custom_effect_tooltip = TT_KARZAI_ADMINISTRATION
			clear_array = ruling_party
			clear_array = gov_coalition_array
			add_to_array = { ruling_party = 0 } #Western autocracy
			meta_effect = {
				text = {
					set_country_flag = [META_SET_RULING_PARTY]
				}
				META_SET_RULING_PARTY = "[meta_set_ruling_leader]"
			}
			set_leader = yes
			set_politics = {
				ruling_party = democratic
				elections_allowed = yes
			}
			add_popularity = {
				ideology = democratic
				popularity = 0.25
			}
			effect_tooltip = {
				create_country_leader = {
					name = "Hamid Karzai"
					picture = "Hamid_Karzai.dds"
					ideology = conservatism
					traits = {
						western_Western_Autocracy
					}
				}
			}
			set_variable = { current_term = 1 }
			for_each_loop = {
				array = ruling_party
				value = v
				multiply_variable = { party_pop_array^v = 1.5 }
			}
			add_popularity = {
				ideology = fascism
				popularity = 0.15
			}
			add_to_variable = { var = party_pop_array^11 value = 0.15 }
			add_popularity = {
				ideology = nationalist
				popularity = 0.05
			}
			add_to_variable = { var = party_pop_array^23 value = 0.05 }
		}
		if = {
			limit = { has_country_flag = AFG_new_administration_Rabbani }
			custom_effect_tooltip = TT_RABBANI_ADMINISTRATION
			add_popularity = {
				ideology = neutrality
				popularity = 0.20
			}
			if = {
				limit = {
					NOT = { has_country_leader = { name = "Burhanuddin Rabbani" ruling_only = yes } }
				}
				effect_tooltip = {
					create_country_leader = {
						name = "Burhanuddin Rabbani"
						picture = "Burhanuddin_Rabbani.dds"
						ideology = Nat_Populism
						traits = {
							neutrality_Neutral_Muslim_Brotherhood
						}
					}
				}
				hidden_effect = {
					meta_effect = {
						text = {
							set_country_flag = [META_SET_RULING_PARTY]
						}
						META_SET_RULING_PARTY = "[meta_set_ruling_leader]"
					}
					set_leader = yes
				}
			}
			clear_array = ruling_party
			clear_array = gov_coalition_array
			add_to_array = { ruling_party = 12 } #Muslim Brotherhood
			for_each_loop = {
				array = ruling_party
				value = v
				multiply_variable = { party_pop_array^v = 1.5 }
			}
			add_popularity = {
				ideology = fascism
				popularity = 0.05
			}
			add_to_variable = { var = party_pop_array^11 value = 0.05 }
		}
		if = {
			limit = { has_country_flag = AFG_new_administration_Massoud }
			custom_effect_tooltip = TT_RABBANI_ADMINISTRATION
			add_popularity = {
				ideology = neutrality
				popularity = 0.20
			}
			effect_tooltip = {
				create_country_leader = {
					name = "Ahmed Shah Massoud"
					picture = "Ahmad_Shah_Massoud.dds"
					expire = "2001.9.9"
					ideology = Neutral_Muslim_Brotherhood
					traits = {
						neutrality_Neutral_Muslim_Brotherhood
					}
				}
			}
			set_variable = { current_term = 1 }
			clear_array = ruling_party
			clear_array = gov_coalition_array
			add_to_array = { ruling_party = 12 } #Muslim Brotherhood
			for_each_loop = {
				array = ruling_party
				value = v
				multiply_variable = { party_pop_array^v = 1.5 }
			}
		}
		if = {
			limit = { has_country_flag = AFG_new_administration_Zahir_Shah }
			custom_effect_tooltip = TT_SHAH_ADMINISTRATION
			clear_array = ruling_party
			clear_array = gov_coalition_array
			add_to_array = { ruling_party = 23 } #monarchist
			meta_effect = {
				text = {
					set_country_flag = [META_SET_RULING_PARTY]
				}
				META_SET_RULING_PARTY = "[meta_set_ruling_leader]"
			}
			set_leader = yes
			set_politics = {
				ruling_party = nationalist
				elections_allowed = no
			}
			add_popularity = {
				ideology = nationalist
				popularity = 0.15
			}
			effect_tooltip = {
				create_country_leader = {
					name = "Mohammed Zahir Shah"
					picture = "generic.dds"
					ideology = Monarchist
					traits = {
						nationalist_Monarchist
					}
				}
			}
			for_each_loop = {
				array = ruling_party
				value = v
				add_to_variable = { var = party_pop_array^v value = 0.15 }
			}
			add_popularity = {
				ideology = fascism
				popularity = 0.25
			}
			add_to_variable = { var = party_pop_array^11 value = 0.25 }
		}
	}

}

#Taliban Insurgency

#Start of Insurgency
country_event = {
	id = TalibanInsurgency.0
	title = TalibanInsurgency.0.t
	desc = TalibanInsurgency.0.d
	picture = GFX_taliban_insurgency_start

	is_triggered_only = yes

	option = {
		name = TalibanInsurgency.0.a
		log = "[GetDateText]: [This.GetName]: TalibanInsurgency.0.a executed"
		add_command_power = 10
		set_country_flag = afg_active_taliban_insurgency

		ai_chance = {
			factor = 1
		}
	}
}

#Raid Successful
news_event = {
	id = TalibanInsurgency.1
	title = TalibanInsurgency.1.t
	desc = TalibanInsurgency.1.d
	picture = GFX_afghan_commando_raid_successful

	is_triggered_only = yes

	option = {
		name = TalibanInsurgency.1.a
		log = "[GetDateText]: [This.GetName]: TalibanInsurgency.1.a executed"
		add_stability = 0.02
		add_political_power = 20
		add_command_power = 5
		army_experience = 5
		set_temp_variable = { taliban_strength_decrease = 2 }
		decrease_taliban_strength = yes

		ai_chance = {
			factor = 1
		}
	}
}

#Raid Failure
news_event = {
	id = TalibanInsurgency.2
	title = TalibanInsurgency.2.t
	desc = TalibanInsurgency.2.d
	picture = GFX_afghan_commando_raid_failure

	is_triggered_only = yes

	option = {
		name = TalibanInsurgency.2.a
		log = "[GetDateText]: [This.GetName]: TalibanInsurgency.2.a executed"
		add_manpower = -10
		add_command_power = -5
		set_temp_variable = { taliban_strength_increase = 1 }
		increase_taliban_strength = yes

		ai_chance = {
			factor = 1
		}
	}
}

#Airstrike Successful
news_event = {
	id = TalibanInsurgency.3
	title = TalibanInsurgency.3.t
	desc = TalibanInsurgency.3.d
	picture = GFX_afghan_a29_super_tucano

	is_triggered_only = yes

	option = {
		name = TalibanInsurgency.3.a
		log = "[GetDateText]: [This.GetName]: TalibanInsurgency.3.a executed"
		add_command_power = 10
		air_experience = 10
		set_temp_variable = { taliban_strength_decrease = 5 }
		decrease_taliban_strength = yes

		ai_chance = {
			factor = 1
		}
	}
}

#Airstrike Failure
news_event = {
	id = TalibanInsurgency.4
	title = TalibanInsurgency.4.t
	desc = TalibanInsurgency.4.d
	picture = GFX_afghan_airstrike_failure

	is_triggered_only = yes

	option = {
		name = TalibanInsurgency.4.a
		log = "[GetDateText]: [This.GetName]: TalibanInsurgency.4.a executed"
		random_owned_controlled_state = {
			add_manpower = -10
		}
		add_political_power = -20
		add_stability = -0.02
		add_popularity = {
			ideology = ROOT
			popularity = -0.02
		}
		set_temp_variable = { taliban_strength_increase = 5 }
		increase_taliban_strength = yes

		ai_chance = {
			factor = 1
		}
	}
}

#Aircraft Shot Down
news_event = {
	id = TalibanInsurgency.5
	title = TalibanInsurgency.5.t
	desc = TalibanInsurgency.5.d
	picture = GFX_fighter_shot_down

	is_triggered_only = yes

	option = {
		name = TalibanInsurgency.5.a
		log = "[GetDateText]: [This.GetName]: TalibanInsurgency.5.a executed"
		add_command_power = -5
		add_manpower = -1
		if = {
			limit = {
				has_equipment = {
					MR_Fighter_equipment > 0
				}
			}
			add_equipment_to_stockpile = {
				type = MR_Fighter_equipment
				amount = -1
			}
		}
		else_if = {
			limit = {
				has_equipment = {
					Strike_fighter_equipment > 0
				}
			}
			add_equipment_to_stockpile = {
				type = Strike_fighter_equipment
				amount = -1
			}
		}
		else_if = {
			limit = {
				has_equipment = {
					L_Strike_fighter_equipment > 0
				}
			}
			add_equipment_to_stockpile = {
				type = L_Strike_fighter_equipment
				amount = -1
			}
		}
		set_temp_variable = { taliban_strength_increase = 1 }
		increase_taliban_strength = yes

		ai_chance = {
			factor = 1
		}
	}
}

#Unity Propaganda Successful
news_event = {
	id = TalibanInsurgency.6
	title = TalibanInsurgency.6.t
	desc = TalibanInsurgency.6.d
	picture = GFX_afghan_peace_success

	is_triggered_only = yes

	option = {
		name = TalibanInsurgency.6.a
		log = "[GetDateText]: [This.GetName]: TalibanInsurgency.6.a executed"
		add_political_power = 20
		add_stability = 0.05
		set_temp_variable = { taliban_strength_decrease = 10 }
		decrease_taliban_strength = yes

		ai_chance = {
			factor = 1
		}
	}
}

#Unity Propaganda Failure
news_event = {
	id = TalibanInsurgency.7
	title = TalibanInsurgency.7.t
	desc = TalibanInsurgency.7.d
	picture = GFX_afghan_peace_failure

	is_triggered_only = yes

	option = {
		name = TalibanInsurgency.7.a
		log = "[GetDateText]: [This.GetName]: TalibanInsurgency.7.a executed"
		add_political_power = -10

		ai_chance = {
			factor = 1
		}
	}
}

#Taliban Insurgency Eliminated
news_event = {
	id = TalibanInsurgency.8
	title = TalibanInsurgency.8.t
	desc = TalibanInsurgency.8.d
	picture = GFX_news_taliban_defeated

	major = yes

	is_triggered_only = yes

	option = {
		name = TalibanInsurgency.8.a
		log = "[GetDateText]: [This.GetName]: TalibanInsurgency.8.a executed"

		ai_chance = {
			factor = 1
		}
	}
}

#Taliban Attacks Police
country_event = {
	id = TalibanAttack.0
	title = TalibanAttack.0.t
	desc = TalibanAttack.0.d
	picture = GFX_taliban_police_attack

	trigger = {
		original_tag = AFG
		AFG = {
			check_variable = {
				var = taliban_strength
				value = 5
				compare = greater_than_or_equals
			}
		}
	}

	mean_time_to_happen = {
		days = 365
		modifier = {
			factor = 0.5
			check_variable = {
				var = taliban_strength
				value = 20
				compare = greater_than_or_equals
			}
		}
		modifier = {
			factor = 0.5
			check_variable = {
				var = taliban_strength
				value = 30
				compare = greater_than_or_equals
			}
		}
		modifier = {
			factor = 0.5
			check_variable = {
				var = taliban_strength
				value = 50
				compare = greater_than_or_equals
			}
		}
		modifier = {
			factor = 0.5
			check_variable = {
				var = taliban_strength
				value = 75
				compare = greater_than_or_equals
			}
		}
	}

	option = {
		name = TalibanAttack.0.a
		log = "[GetDateText]: [This.GetName]: TalibanAttack.0.a executed"
		add_manpower = -25
		add_stability = -0.01
		add_equipment_to_stockpile = {
			type = Inf_equipment
    		amount = -100
		}
		add_equipment_to_stockpile = {
			type = cnc_equipment
			amount = -25
		}
		if = {
			limit = {
				original_tag = AFG
				check_variable = {
					var = taliban_strength
					value = 5
					compare = greater_than_or_equals
				}
				check_variable = {
					var = taliban_strength
					value = 25
					compare = less_than
				}
			}
			set_temp_variable = { taliban_strength_increase = 1 }
			increase_taliban_strength = yes
		}
		else_if = {
			limit = {
				original_tag = AFG
				check_variable = {
					var = taliban_strength
					value = 25
					compare = greater_than_or_equals
				}
				check_variable = {
					var = taliban_strength
					value = 50
					compare = less_than
				}
			}
			set_temp_variable = { taliban_strength_increase = 1 }
			increase_taliban_strength = yes
		}
		else_if = {
			limit = {
				original_tag = AFG
				check_variable = {
					var = taliban_strength
					value = 50
					compare = greater_than_or_equals
				}
				check_variable = {
					var = taliban_strength
					value = 75
					compare = less_than
				}
			}
			set_temp_variable = { taliban_strength_increase = 2 }
			increase_taliban_strength = yes
		}
		else_if = {
			limit = {
				original_tag = AFG
				check_variable = {
					var = taliban_strength
					value = 75
					compare = greater_than_or_equals
				}
			}
			set_temp_variable = { taliban_strength_increase = 3 }
			increase_taliban_strength = yes
		}
		hidden_effect = {
			every_other_country = {
				limit = {
					OR = {
						is_in_array = { FROM.influence_array = THIS.id }
						has_military_access_to = AFG
						is_neighbor_of = AFG
						has_guaranteed = AFG
					}
					is_full_state = yes
				}
				news_event = {
					id = TalibanAttack.1
					hours = 1
				}
			}
		}

		ai_chance = {
			factor = 1
		}
	}
}

news_event = {
	id = TalibanAttack.1
	title = TalibanAttack.1.t
	desc = TalibanAttack.1.d
	picture = GFX_afghan_news_taliban_attack_police

	is_triggered_only = yes

	option = {
		log = "[GetDateText]: [This.GetName]: TalibanAttack.1.a executed"
		name = TalibanAttack.1.a

		ai_chance = {
			factor = 1
		}
	}
}

#Taliban Attack Bus Kills Foreigners
country_event = {
	id = TalibanAttack.2
	title = TalibanAttack.2.t
	desc = TalibanAttack.2.d
	picture = GFX_taliban_bus_attack

	trigger = {
		original_tag = AFG
		AFG = {
			check_variable = {
				var = taliban_strength
				value = 25
				compare = greater_than_or_equals
			}
		}
	}

	mean_time_to_happen = {
		days = 1095
		modifier = {
			factor = 0.5
			check_variable = {
				var = taliban_strength
				value = 35
				compare = greater_than_or_equals
			}
		}
		modifier = {
			factor = 0.5
			check_variable = {
				var = taliban_strength
				value = 50
				compare = greater_than_or_equals
			}
		}
		modifier = {
			factor = 0.5
			check_variable = {
				var = taliban_strength
				value = 75
				compare = greater_than_or_equals
			}
		}
		modifier = {
			factor = 0.5
			check_variable = {
				var = taliban_strength
				value = 90
				compare = greater_than_or_equals
			}
		}
	}

	option = {
		name = TalibanAttack.2.a
		log = "[GetDateText]: [This.GetName]: TalibanAttack.2.a executed"
		add_manpower = -35
		add_political_power = -30
		add_stability = -0.02
		if = {
			limit = {
				original_tag = AFG
				check_variable = {
					var = taliban_strength
					value = 25
					compare = greater_than_or_equals
				}
				check_variable = {
					var = taliban_strength
					value = 35
					compare = less_than
				}
			}
			set_temp_variable = { taliban_strength_increase = 1 }
			increase_taliban_strength = yes
		}
		else_if = {
			limit = {
				original_tag = AFG
				check_variable = {
					var = taliban_strength
					value = 35
					compare = greater_than_or_equals
				}
				check_variable = {
					var = taliban_strength
					value = 50
					compare = less_than
				}
			}
			set_temp_variable = { taliban_strength_increase = 2 }
			increase_taliban_strength = yes
		}
		else_if = {
			limit = {
				original_tag = AFG
				check_variable = {
					var = taliban_strength
					value = 50
					compare = greater_than_or_equals
				}
				check_variable = {
					var = taliban_strength
					value = 75
					compare = less_than
				}
			}
			set_temp_variable = { taliban_strength_increase = 3 }
			increase_taliban_strength = yes
		}
		else_if = {
			limit = {
				original_tag = AFG
				check_variable = {
					var = taliban_strength
					value = 75
					compare = greater_than_or_equals
				}
			}
			set_temp_variable = { taliban_strength_increase = 5 }
			increase_taliban_strength = yes
		}
		hidden_effect = {
			every_other_country = {
				limit = {
					OR = {
						is_in_array = { FROM.influence_array = THIS.id }
						has_military_access_to = AFG
					}
					is_full_state = yes
				}
				news_event = {
					id = TalibanAttack.3
					hours = 1
				}
			}
			every_other_country = {
				limit = {
					NOT = {
						is_in_array = { FROM.influence_array = THIS.id }
						has_military_access_to = AFG
					}
					is_full_state = yes
				}
				news_event = {
					id = TalibanAttack.4
					hours = 1
				}
			}
		}

		ai_chance = {
			factor = 1
		}
	}
}

news_event = {
	id = TalibanAttack.3
	title = TalibanAttack.3.t
	desc = TalibanAttack.3.d
	picture = GFX_afghan_news_taliban_bus_attack

	is_triggered_only = yes

	option = {
		log = "[GetDateText]: [This.GetName]: TalibanAttack.3.a executed"
		name = TalibanAttack.3.a
		add_manpower = -2
		add_political_power = -20

		ai_chance = {
			factor = 1
		}
	}
}

news_event = {
	id = TalibanAttack.4
	title = TalibanAttack.4.t
	desc = TalibanAttack.4.d
	picture = GFX_afghan_news_taliban_bus_attack

	is_triggered_only = yes

	option = {
		log = "[GetDateText]: [This.GetName]: TalibanAttack.4.a executed"
		name = TalibanAttack.4.a

		ai_chance = {
			factor = 1
		}
	}
}

#Taliban Attack Fuel Tankers
country_event = {
	id = TalibanAttack.5
	title = TalibanAttack.5.t
	desc = TalibanAttack.5.d
	picture = GFX_taliban_tanker_attack

	trigger = {
		original_tag = AFG
		AFG = {
			check_variable = {
				var = taliban_strength
				value = 15
				compare = greater_than_or_equals
			}
		}
	}

	mean_time_to_happen = {
		days = 730
		modifier = {
			factor = 0.5
			check_variable = {
				var = taliban_strength
				value = 15
				compare = greater_than_or_equals
			}
		}
		modifier = {
			factor = 0.5
			check_variable = {
				var = taliban_strength
				value = 30
				compare = greater_than_or_equals
			}
		}
		modifier = {
			factor = 0.5
			check_variable = {
				var = taliban_strength
				value = 50
				compare = greater_than_or_equals
			}
		}
		modifier = {
			factor = 0.5
			check_variable = {
				var = taliban_strength
				value = 75
				compare = greater_than_or_equals
			}
		}
		modifier = {
			factor = 0.5
			check_variable = {
				var = taliban_strength
				value = 90
				compare = greater_than_or_equals
			}
		}
	}

	option = {
		name = TalibanAttack.5.a
		log = "[GetDateText]: [This.GetName]: TalibanAttack.5.a executed"
		add_command_power = -5
		add_stability = -0.01
		random_owned_controlled_state = {
			limit = {
				infrastructure > 0
			}
			damage_building = {
				type = infrastructure
				damage = 0.05
			}
		}
		if = {
			limit = {
				original_tag = AFG
				check_variable = {
					var = taliban_strength
					value = 5
					compare = greater_than_or_equals
				}
				check_variable = {
					var = taliban_strength
					value = 25
					compare = less_than
				}
			}
			set_temp_variable = { taliban_strength_increase = 1 }
			increase_taliban_strength = yes
		}
		else_if = {
			limit = {
				original_tag = AFG
				check_variable = {
					var = taliban_strength
					value = 25
					compare = greater_than_or_equals
				}
				check_variable = {
					var = taliban_strength
					value = 50
					compare = less_than
				}
			}
			set_temp_variable = { taliban_strength_increase = 2 }
			increase_taliban_strength = yes
		}
		else_if = {
			limit = {
				original_tag = AFG
				check_variable = {
					var = taliban_strength
					value = 50
					compare = greater_than_or_equals
				}
				check_variable = {
					var = taliban_strength
					value = 75
					compare = less_than
				}
			}
			set_temp_variable = { taliban_strength_increase = 3 }
			increase_taliban_strength = yes
		}
		else_if = {
			limit = {
				original_tag = AFG
				check_variable = {
					var = taliban_strength
					value = 75
					compare = greater_than_or_equals
				}
			}
			set_temp_variable = { taliban_strength_increase = 4 }
			increase_taliban_strength = yes
		}
		hidden_effect = {
			every_other_country = {
				limit = {
					OR = {
						is_in_array = { FROM.influence_array = THIS.id }
						has_military_access_to = AFG
						is_neighbor_of = AFG
						has_guaranteed = AFG
					}
					is_full_state = yes
				}
				news_event = {
					id = TalibanAttack.6
					hours = 1
				}
			}
		}

		ai_chance = {
			factor = 1
		}
	}
}

news_event = {
	id = TalibanAttack.6
	title = TalibanAttack.6.t
	desc = TalibanAttack.6.d
	picture = GFX_afghan_news_taliban_attack_road_convoys

	is_triggered_only = yes

	option = {
		log = "[GetDateText]: [This.GetName]: TalibanAttack.6.a executed"
		name = TalibanAttack.6.a

		ai_chance = {
			factor = 1
		}
	}
}

#Asks USA for Guarantee
country_event = {
	id = Afghanistan.8
	title = Afghanistan.8.t
	desc = Afghanistan.8.d
	picture = GFX_politics_negotiations

	is_triggered_only = yes

	option = {
		name = Afghanistan.8.a
		log = "[GetDateText]: [This.GetName]: Afghanistan.8.a executed"
		custom_effect_tooltip = AFG_usa_guarantee_obligation
		add_political_power = -50
		give_guarantee = AFG
		AFG = {
			generic_grant_4_percent_influence_of_USA = yes
			give_military_access = USA
			country_event = {
				id = Afghanistan.9
				days = 2
			}
		}

		ai_chance = {
			factor = 1

			modifier = {
				factor = 0
				AFG = {
					NOT = {
						has_government = democratic
						has_government = neutrality
					}
				}
			}

			modifier  = {
				factor = 0
				AFG = {
					has_offensive_war = yes
				}
			}

			modifier = {
				factor = 0
				AFG = {
					has_added_tension_amount = 10
				}
			}

			modifier = {
				factor = 0
				check_variable = {
					debt > 10000
				}
			}

			modifier = {
				factor = 2
				has_opinion = {
					target = AFG
					value > 25
				}
			}
		}
	}

	option = {
		name = Afghanistan.8.b
		log = "[GetDateText]: [This.GetName]: Afghanistan.8.b executed"
		add_political_power = 20
		add_popularity = {
			ideology = nationalist
			popularity = 0.02
		}
		AFG = {
			country_event = {
			id = Afghanistan.10
			days = 2
			}
		}

		ai_chance = {
			factor = 1

			modifier = {
				factor = 2
				has_war_support < 0.5
			}

			modifier = {
				factor = 2
				AFG = {
					OR = {
						has_civil_war = yes
						has_war_with = TAL
					}
				}
			}
		}
	}
}

#USA Agrees Guarantee
country_event = {
	id = Afghanistan.9
	title = Afghanistan.9.t
	desc = Afghanistan.9.d
	picture = GFX_negotiations

	is_triggered_only = yes

	option = {
		name = Afghanistan.9.a
		log = "[GetDateText]: [This.GetName]: Afghanistan.9.a executed"
		add_political_power = 50
		ai_chance = {
			factor = 1
		}
	}
}

#USA Refuses Guarantee
country_event = {
	id = Afghanistan.10
	title = Afghanistan.10.t
	desc = Afghanistan.10.d
	picture = GFX_treaty_rejected

	is_triggered_only = yes

	option = {
		name = Afghanistan.10.a
		log = "[GetDateText]: [This.GetName]: Afghanistan.10.a executed"
		add_political_power = -50
		add_popularity = {
			ideology = ROOT
			popularity = -0.02
		}
		ai_chance = {
			factor = 1
		}
	}
}

#Asks China for Guarantee
country_event = {
	id = Afghanistan.11
	title = Afghanistan.11.t
	desc = Afghanistan.11.d
	picture = GFX_politics_negotiations

	is_triggered_only = yes

	option = {
		name = Afghanistan.11.a
		log = "[GetDateText]: [This.GetName]: Afghanistan.11.a executed"
		custom_effect_tooltip = AFG_usa_guarantee_obligation
		add_political_power = -50
		give_guarantee = AFG
		AFG = {
			generic_grant_4_percent_influence_of_CHI = yes
			give_military_access = CHI
			country_event = {
				id = Afghanistan.12
				days = 2
			}
		}
		hidden_effect = {
			subtract_from_variable = { chinese_aggression = 1 }
		}

		ai_chance = {
			factor = 1

			modifier = {
				factor = 2
				AFG = {
					NOT = {
						has_government = democratic
						has_government = neutrality
						has_government = fascism
					}
				}
			}

			modifier = {
				factor = 2
				AFG = {
					has_government = communism
				}
			}

			modifier = {
				factor = 0
				AFG = {
					has_war = yes
				}
			}

			modifier = {
				factor = 0
				check_variable = {
					debt > 10000
				}
			}

			modifier = {
				factor = 2
				has_opinion = {
					target = AFG
					value > 25
				}
			}
		}
	}

	option = {
		name = Afghanistan.11.b
		log = "[GetDateText]: [This.GetName]: Afghanistan.11.b executed"
		AFG = {
			country_event = {
			id = Afghanistan.13
			days = 2
			}
		}

		ai_chance = {
			factor = 1

			modifier = {
				factor = 2
				check_variable = {
					uighur_threat > 80
				}
			}

			modifier = {
				factor = 2
				has_opinion = {
					target = AFG
					value < -25
				}
			}
		}
	}
}

#China Agrees Guarantee
country_event = {
	id = Afghanistan.12
	title = Afghanistan.12.t
	desc = Afghanistan.12.d
	picture = GFX_negotiations

	is_triggered_only = yes

	option = {
		name = Afghanistan.12.a
		log = "[GetDateText]: [This.GetName]: Afghanistan.12.a executed"
		add_political_power = 50
		ai_chance = {
			factor = 1
		}
	}
}

#China Refuses Guarantee
country_event = {
	id = Afghanistan.13
	title = Afghanistan.13.t
	desc = Afghanistan.13.d
	picture = GFX_treaty_rejected

	is_triggered_only = yes

	option = {
		name = Afghanistan.13.a
		log = "[GetDateText]: [This.GetName]: Afghanistan.13.a executed"
		add_political_power = -20
		add_popularity = {
			ideology = ROOT
			popularity = -0.02
		}
		ai_chance = {
			factor = 1
		}
	}
}

#Claim Pakistani Pashtunistan
country_event = {
	id = Afghanistan.14
	title = Afghanistan.14.t
	desc = Afghanistan.14.d
	picture = GFX_politics_protest

	is_triggered_only = yes

	option = {
		name = Afghanistan.14.a
		log = "[GetDateText]: [This.GetName]: Afghanistan.14.a executed"
		add_war_support = 0.01

		ai_chance = {
			factor = 1
		}
	}
}

#Afghanistan wins border war
country_event = {
	id = AfghanistanBorderWars.1
	title = AfghanistanBorderWars.1.t
	desc = AfghanistanBorderWars.1.d

	is_triggered_only = yes

	immediate = {
		event_target:AFG_ATTACKER = {
			if = {
				limit = { has_country_flag = AFG_attacking_417 }
				transfer_state = 417
				clr_country_flag = AFG_attacking_417
			}
			if = {
				limit = { has_country_flag = AFG_attacking_418 }
				transfer_state = 418
				clr_country_flag = AFG_attacking_418
			}
			if = {
				limit = { has_country_flag = AFG_attacking_419 }
				transfer_state = 419
				clr_country_flag = AFG_attacking_419
			}
			if = {
				limit = { has_country_flag = AFG_attacking_594 }
				transfer_state = 594
				clr_country_flag = AFG_attacking_594
			}
			if = {
				limit = { has_country_flag = AFG_attacking_416 }
				transfer_state = 416
				clr_country_flag = AFG_attacking_416
			}
		}
	}

	option = {
		name = AfghanistanBorderWars.1.a
		trigger = { tag = event_target:AFG_ATTACKER }
		log = "[GetDateText]: [This.GetName]: AfghanistanBorderWars.1.a executed"
	}
	option = {
		name = AfghanistanBorderWars.1.b
		trigger = { tag = event_target:AFG_ATTACKER }
		log = "[GetDateText]: [This.GetName]: AfghanistanBorderWars.1.b executed"
		ai_chance = {
			factor = 20
		}
		decrease_popularity_5 = yes
	}
	option = {
		name = AfghanistanBorderWars.1.c
		trigger = { tag = event_target:AFG_ATTACKER }
		log = "[GetDateText]: [This.GetName]: AfghanistanBorderWars.1.c executed"
		ai_chance = {
			factor = 80
		}
		declare_war_on = {
			target = event_target:AFG_ATTACKER
			type = annex_everything
		}
		random_country = {
			limit = {
				original_tag = PAK
				NOT = { tag = event_target:AFG_ATTACKER }
			}
			declare_war_on = {
				target = event_target:AFG_ATTACKER
				type = annex_everything
			}
		}
	}
}

#Afghanistan loses border war
country_event = {
	id = AfghanistanBorderWars.2
	title = AfghanistanBorderWars.2.t
	desc = AfghanistanBorderWars.2.d

	is_triggered_only = yes


	option = {
		name = AfghanistanBorderWars.2.a
		trigger = { tag = event_target:AFG_ATTACKER }
		log = "[GetDateText]: [This.GetName]: AfghanistanBorderWars.2.a executed"
	}
	option = {
		name = AfghanistanBorderWars.2.b
		trigger = { tag = event_target:AFG_ATTACKER }
		log = "[GetDateText]: [This.GetName]: AfghanistanBorderWars.2.b executed"
		if = {
			limit = { has_variable = AFG_fail_meter }
			add_to_variable = {
				var = AFG_fail_meter
				value = 1
			}
		}
		else = {
			set_variable = {
				var = AFG_fail_meter
				value = 1
			}
		}
		decrease_popularity_5 = yes
	}
}

news_event = {
	id = AfghanistanNews.1
	title = AfghanistanNews.1.t
	desc = {
		text = AfghanistanNews.1.TAL.d
		trigger = { FROM = { original_tag = TAL } }
	}
	desc = {
		text = AfghanistanNews.1.AFG.d
		trigger = { FROM = { original_tag = AFG } }
	}
	picture = GFX_news_rise_of_taliban

	major = yes

	is_triggered_only = yes

	option = {
		name = AfghanistanNews.1.a
		log = "[GetDateText]: [This.GetName]: AfghanistanNews.1.a executed"
	}
}

news_event = {
	id = AfghanistanNews.2
	title = AfghanistanNews.2.t
	desc = AfghanistanNews.2.d
	picture = GFX_news_afghanistan_pakistan

	major = yes

	is_triggered_only = yes

	option = {
		name = AfghanistanNews.2.a
		log = "[GetDateText]: [This.GetName]: AfghanistanNews.2.a executed"
	}

}

news_event = {
	id = AfghanistanNews.3
	title = AfghanistanNews.3.t
	desc = AfghanistanNews.3.d
	picture = GFX_news_afghanistan_pakistan

	major = yes

	is_triggered_only = yes

	option = {
		name = AfghanistanNews.3.a
		log = "[GetDateText]: [This.GetName]: AfghanistanNews.3.a executed"
	}

}

news_event = {
	id = AfghanistanNews.4
	title = AfghanistanNews.4.t
	desc = AfghanistanNews.4.d
	picture = GFX_news_afghanistan_pakistan

	major = yes

	is_triggered_only = yes

	option = {
		name = AfghanistanNews.4.a
		log = "[GetDateText]: [This.GetName]: AfghanistanNews.4.a executed"
	}

}

news_event = {
	id = AfghanistanNews.5
	title = AfghanistanNews.5.t
	desc = AfghanistanNews.5.d
	picture = GFX_news_rise_of_taliban

	major = yes

	is_triggered_only = yes

	option = {
		name = AfghanistanNews.5.a
		log = "[GetDateText]: [This.GetName]: AfghanistanNews.5.a executed"
	}

}

news_event = {

	id = AfghanistanNews.6
	title = AfghanistanNews.6.t
	desc = AfghanistanNews.6.d
	picture = GFX_news_ahmad_shah_massoud

	major = yes

	is_triggered_only = yes

	option = {
		name = AfghanistanNews.6.a
		log = "[GetDateText]: [This.GetName]: AfghanistanNews.6.a executed"
	}

}

news_event = {
	id = AfghanistanNews.7
	title = AfghanistanNews.7.t
	desc = AfghanistanNews.7.d
	picture = GFX_news_afghanistan_pakistan

	major = yes

	is_triggered_only = yes

	option = {
		name = AfghanistanNews.7.a
		log = "[GetDateText]: [This.GetName]: AfghanistanNews.7.a executed"
	}
}

news_event = {
	id = AfghanistanNews.8
	title = AfghanistanNews.8.t
	desc = AfghanistanNews.8.d
	picture = GFX_news_afghanistan_hezb_i_islami

	major = yes

	is_triggered_only = yes

	option = {
		name = AfghanistanNews.8.a
		log = "[GetDateText]: [This.GetName]: AfghanistanNews.8.a executed"
	}
}

news_event = {
	id = AfghanistanNews.9
	title = AfghanistanNews.9.t
	desc = AfghanistanNews.9.d
	picture = GFX_news_afghanistan_afghan_troops

	major = yes

	is_triggered_only = yes

	option = {
		name = AfghanistanNews.9.a
		log = "[GetDateText]: [This.GetName]: AfghanistanNews.9.a executed"
	}
}

#Investment Offer
country_event = {
	id = AfghanistanInvestment.1
	title = AfghanistanInvestment.1.t
	desc = AfghanistanInvestment.1.desc
	picture = GFX_politics_talks

	is_triggered_only = yes

	option = {
		name = AfghanistanInvestment.1.a
		log = "[GetDateText]: [This.GetName]: AfghanistanInvestment.1.a executed"
		set_temp_variable = {treasury_change = -10 }
		modify_treasury_effect = yes
		AFG = {
			random_owned_controlled_state = {
				add_building_construction = {
					type = infrastructure
					level = 1
					instant_build = yes
				}
			}
			generic_grant_1_percent_influence_of_ROOT = yes
			country_event = {
				id = AfghanistanInvestment.2
				days = 5
			}
		}

		ai_chance = {
			factor = 1

			modifier = {
				factor = 2
				AFG = {
					has_government = ROOT
				}
			}

			modifier = {
				factor = 2
				AFG = {
					has_stability > 0.5
				}
			}

			modifier = {
				factor = 2
				ROOT = {
					has_opinion = {
						target = AFG
						value > 10
					}
				}
			}

			modifier = {
				factor = 2
				ROOT = {
					has_opinion = {
						target = AFG
						value > 25
					}
				}
			}

			modifier = {
				factor = 0
				AFG = {
					has_stability < 0.2
				}
			}
		}
	}

	option = {
		name = AfghanistanInvestment.1.b
		log = "[GetDateText]: [This.GetName]: AfghanistanInvestment.1.b executed"
		set_temp_variable = {treasury_change = -12.5 }
		modify_treasury_effect = yes
		AFG = {
			random_owned_controlled_state = {
				add_extra_state_shared_building_slots = 1
				add_building_construction = {
					type = industrial_complex
					level = 1
					instant_build = yes
				}
			}
			generic_grant_2_percent_influence_of_ROOT = yes
			country_event = {
				id = AfghanistanInvestment.3
				days = 5
			}
		}

		ai_chance = {
			factor = 1

			modifier = {
				factor = 2
				AFG = {
					has_government = ROOT
				}
			}

			modifier = {
				factor = 2
				AFG = {
					has_stability > 0.6
				}
			}

			modifier = {
				factor = 2
				ROOT = {
					has_opinion = {
						target = AFG
						value > 15
					}
				}
			}

			modifier = {
				factor = 2
				ROOT = {
					has_opinion = {
						target = AFG
						value > 30
					}
				}
			}

			modifier = {
				factor = 0
				AFG = {
					has_stability < 0.3
				}
			}
		}
	}

	option = {
		name = AfghanistanInvestment.1.c
		log = "[GetDateText]: [This.GetName]: AfghanistanInvestment.1.c executed"
		set_temp_variable = {treasury_change = -20 }
		modify_treasury_effect = yes
		AFG = {
			random_owned_controlled_state = {
				add_extra_state_shared_building_slots = 1
				add_building_construction = {
					type = offices
					level = 1
					instant_build = yes
				}
			}
			generic_grant_3_percent_influence_of_ROOT = yes
			country_event = {
				id = AfghanistanInvestment.4
				days = 5
			}
		}

		ai_chance = {
			factor = 1

			modifier = {
				factor = 2
				AFG = {
					has_government = ROOT
				}
			}

			modifier = {
				factor = 2
				AFG = {
					has_stability > 0.75
				}
			}

			modifier = {
				factor = 2
				ROOT = {
					has_opinion = {
						target = AFG
						value > 25
					}
				}
			}

			modifier = {
				factor = 2
				ROOT = {
					has_opinion = {
						target = AFG
						value > 50
					}
				}
			}

			modifier = {
				factor = 0
				AFG = {
					has_stability < 0.5
				}
			}
		}
	}

	option = {
		name = AfghanistanInvestment.1.d
		log = "[GetDateText]: [This.GetName]: AfghanistanInvestment.1.d executed"
		add_political_power = 20

		AFG = {
			country_event = {
				id = AfghanistanInvestment.5
				days = 5
			}
		}

		ai_chance = {
			factor = 1

			modifier = {
				factor = 2
				AFG = {
					has_stability < 0.1
				}
			}

			modifier = {
				factor = 2
				ROOT = {
					has_opinion = {
						target = AFG
						value < -15
					}
				}
			}

			modifier = {
				factor = 2
				ROOT = {
					has_opinion = {
						target = AFG
						value < -50
					}
				}
			}

			modifier = {
				factor = 10
				AFG = {
					has_war = yes
				}
			}
		}
	}
}

#Invest in Infrastructure
country_event = {
	id = AfghanistanInvestment.2
	title = AfghanistanInvestment.2.t
	desc = AfghanistanInvestment.2.d
	picture = GFX_broken_infrastructure

	is_triggered_only = yes

	option = {
		name = AfghanistanInvestment.2.a
		log = "[GetDateText]: [This.GetName]: AfghanistanInvestment.2.a executed"
		ai_chance = {
			factor = 1
		}
	}
}

#Invest in Factories
country_event = {
	id = AfghanistanInvestment.3
	title = AfghanistanInvestment.3.t
	desc = AfghanistanInvestment.3.d
	picture = GFX_generic_factory

	is_triggered_only = yes

	option = {
		name = AfghanistanInvestment.3.a
		log = "[GetDateText]: [This.GetName]: AfghanistanInvestment.3.a executed"
		ai_chance = {
			factor = 1
		}
	}
}

#Invest in Offices
country_event = {
	id = AfghanistanInvestment.4
	title = AfghanistanInvestment.4.t
	desc = AfghanistanInvestment.4.d
	picture = GFX_euro_investments

	is_triggered_only = yes

	option = {
		name = AfghanistanInvestment.4.a
		log = "[GetDateText]: [This.GetName]: AfghanistanInvestment.4.a executed"
		ai_chance = {
			factor = 1
		}
	}
}

#Investment Offer Rejected
country_event = {
	id = AfghanistanInvestment.5
	title = AfghanistanInvestment.5.t
	desc = AfghanistanInvestment.5.d
	picture = GFX_treaty_rejected

	is_triggered_only = yes

	option = {
		name = AfghanistanInvestment.5.a
		log = "[GetDateText]: [This.GetName]: AfghanistanInvestment.5.a executed"
		add_political_power = -10
		ai_chance = {
			factor = 1
		}
	}
}