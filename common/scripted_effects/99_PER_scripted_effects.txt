PER_scripted_effect_update_principalists_popularity_variable = {
	hidden_effect = {
		set_temp_variable = { principalists_pop = party_pop_array^9 }
		set_temp_variable = { reformists_pop = party_pop_array^8 }
		set_temp_variable = { sum_parties = principalists_pop }
		add_to_temp_variable = { sum_parties = reformists_pop }
		set_temp_variable = { temp_var_hundred = 100 }
		divide_temp_variable = { temp_var_hundred = sum_parties }
		multiply_temp_variable = { principalists_pop = temp_var_hundred }
		set_variable = {
			principalists_popularity_percent = principalists_pop
		}
	}
}
PER_scripted_effect_finish_election = {
	hidden_effect = {
		clr_country_flag = PER_election_enabled
		clr_country_flag = principalist_portrait_raisi
		clr_country_flag = principalist_portrait_tavakoli
		clr_country_flag = principalist_portrait_ghalibaf
		clr_country_flag = principalist_portrait_rezaee
		clr_country_flag = reformist_portrait_hemmati
		clr_country_flag = reformist_portrait_khatami
		clr_country_flag = reformist_portrait_mousavi
		clr_country_flag = reformist_portrait_rafsanjani
		clr_country_flag = reformist_portrait_rouhani
		set_politics = {
			ruling_party = communism # Reset ruling ideology to Emerging
			elections_allowed = yes
		}
		create_country_leader = { # Reset country leader
			name = "Sayyid Ali Hosseini Khamenei"
			picture = "sayyid_ali_hosseini_khamenei.dds"
			ideology = Vilayat_e_Faqih
			traits = {
				emerging_Vilayat_e_Faqih
				cleric
				geopolitical_thinker
				political_dancer
				stubborn
				anti_zionist
			}
		}
		remove_mission = PER_auto_update_gui_weekly
	}
}
