on_actions = {


    on_daily = {
		effect = {
			if = { #This is the biggest performance drain - after this it only runs on the player countries, which are very few
				limit = { #only for players or playtesters
					has_country_flag = player_only
				}

				

			#Ruling Party drift
				clear_variable = fascism_modifier
				clear_variable = communism_modifier
				clear_variable = democratic_modifier
				clear_variable = neutrality_modifier
				clear_variable = nationalist_modifier

				clear_variable = fascism_modifier_2
				clear_variable = communism_modifier_2
				clear_variable = democratic_modifier_2
				clear_variable = neutrality_modifier_2
				clear_variable = nationalist_modifier_2

				if = {
					limit = {
						NOT = { check_variable = { modifier@opposition_party_drift = 0 } }
					}

					if = { limit = { NOT = { has_dynamic_modifier = { #so that not every country updates it daily
						modifier = opposition_party_modifier } } }
						add_dynamic_modifier = {
							modifier = opposition_party_modifier
						}
					}

					set_temp_variable = { opposition_drift = modifier@opposition_party_drift }
					
					set_temp_variable = { mod = modifier@opposition_party_drift_factor }
					add_to_temp_variable = { mod = 1 }
					multiply_temp_variable = { opposition_drift = mod }

					set_temp_variable = { fascism = party_popularity@fascism }
					clamp_temp_variable = {
						var = fascism
						min = 0.1
						max = 0.5
					}
					divide_temp_variable = { fascism = 5 }
					set_variable = { fascism_modifier_2 = fascism }

					set_temp_variable = { communism = party_popularity@communism }
					clamp_temp_variable = {
						var = communism
						min = 0.1
						max = 0.5
					}
					divide_temp_variable = { communism = 5 }
					set_variable = { communism_modifier_2 = communism }

					set_temp_variable = { democratic = party_popularity@democratic }
					clamp_temp_variable = {
						var = democratic
						min = 0.1
						max = 0.5
					}
					divide_temp_variable = { democratic = 5 }
					set_variable = { democratic_modifier_2 = democratic }
						
					set_temp_variable = { neutrality = party_popularity@neutrality }
					clamp_temp_variable = {
						var = neutrality
						min = 0.1
						max = 0.5
					}
					divide_temp_variable = { neutrality = 5 }
					set_variable = { neutrality_modifier_2 = neutrality }

					set_temp_variable = { nationalist = party_popularity@nationalist }
					clamp_temp_variable = {
						var = nationalist
						min = 0.1
						max = 0.5
					}
					divide_temp_variable = { nationalist = 5 }
					set_variable = { nationalist_modifier_2 = nationalist }

					multiply_variable = { fascism_modifier_2 = opposition_drift }
					multiply_variable = { communism_modifier_2 = opposition_drift }
					multiply_variable = { democratic_modifier_2 = opposition_drift }
					multiply_variable = { neutrality_modifier_2 = opposition_drift }
					multiply_variable = { nationalist_modifier_2 = opposition_drift }

					if = { limit = { has_government = fascism } clear_variable = fascism_modifier_2 }
					else_if = { limit = { has_government = communism } clear_variable = communism_modifier_2 }
					else_if = { limit = { has_government = democratic } clear_variable = democratic_modifier_2 }
					else_if = { limit = { has_government = neutrality } clear_variable = neutrality_modifier_2 }
					else_if = { limit = { has_government = nationalist } clear_variable = nationalist_modifier_2 }
				}

				if = {
					limit = {
						NOT = { check_variable = { modifier@ruling_party_drift = 0 } }
					}

					if = { limit = { NOT = { has_dynamic_modifier = { #so that not every country updates it daily
						modifier = ruling_party_modifier } } }
						add_dynamic_modifier = {
							modifier = ruling_party_modifier
						}
					}
					
					set_temp_variable = { ruling_drift = modifier@ruling_party_drift }
					
					set_temp_variable = { mod = modifier@ruling_party_drift_factor }
					add_to_temp_variable = { mod = 1 }
					multiply_temp_variable = { ruling_drift = mod }

					if = {
						limit = {
							has_government = fascism
						}
						set_variable = { fascism_modifier = ruling_drift }
					}
					else_if = {
						limit = {
							has_government = communism
						}
						set_variable = { communism_modifier = ruling_drift }
					}
					else_if = {
						limit = {
							has_government = democratic
						}
						set_variable = { democratic_modifier = ruling_drift }
					}
					else_if = {
						limit = {
							has_government = neutrality
						}
						set_variable = { neutrality_modifier = ruling_drift }
					}
					else_if = {
						limit = {
							has_government = nationalist
						}
						set_variable = { nationalist_modifier = ruling_drift }
					}
					#force_update_dynamic_modifier = yes
				}

			}
		}
	}
}
