# By Zei33

# The Solomon Competition is a quest chain played out between Australia and China.
# The Solomon Islands will request assistance throughout the game and each country
# will have the opportunity to help and gain points. At around 2020, the country with
# the most points will gain some sort of control over the Solomon Islands.
# In the real world, China ends up signing a security pact with them, so something
# in that vain.
# The results of the competition will differ dramatically if Australia is moving
# towards China instead of the USA.
add_namespace = solomon_competition

country_event = { # Solomon Islands Civilian Industry Request - Initial choice
	id = solomon_competition.1
	title = solomon_competition.1.t
	desc = solomon_competition.1.d
	picture = GFX_report_event_generic_1

	is_triggered_only = yes
	fire_only_once = yes

	option = {
		name = solomon_competition.1.o1 # We'll help out
		log = "[GetDateText]: [This.GetName]: solomon_competition.1.o1 executed"

		if = {
			limit = { original_tag = AST }
			add_to_variable = { SOL.SOL_AST_support = 4 }
			log = "[GetDateText]: Australia has agreed to help the Solomon Islands (Score [?SOL.SOL_AST_support])"
		}
		else = {
			add_to_variable = { SOL.SOL_CHI_support = 4 }
			log = "[GetDateText]: China has agreed to help the Solomon Islands (Score [?SOL.SOL_CHI_support])"
		}

		# Build industry in Solomon Islands at cost
		set_temp_variable = { treasury_change = -12.5 }
		modify_treasury_effect = yes
		SOL = {
			random_owned_controlled_state = {
				add_extra_state_shared_building_slots = 1
				add_building_construction = {
					type = industrial_complex
					level = 1
					instant_build = yes
				}
			}
			country_event = { id = solomon_competition.3 days = 1 } # Confirmation of investment
			set_country_flag = SOL_industry_construction_built
		}

		# Give influence to investor
		set_temp_variable = { percent_change = 2 }
		set_temp_variable = { tag_index = ROOT.id }
		set_temp_variable = { influence_target = SOL.id }
		change_influence_percentage = yes

		ai_chance = {
			base = 1

			modifier = {
				check_variable = { treasury < 12.49 }
				factor = 0
			}
		}
	}

	option = {
		name = solomon_competition.1.o2 # We're not interested
		log = "[GetDateText]: [This.GetName]: solomon_competition.1.o2 executed"

		# Approach the other guys
		if = {
			limit = { original_tag = AST }
			CHI = {
				country_event = { id = solomon_competition.2 days = 1 }
			}
		}
		else = {
			AST = {
				country_event = { id = solomon_competition.2 days = 1 }
			}
		}

		# Reduce the influence of the rejector
		set_temp_variable = { percent_change = -3 }
		set_temp_variable = { tag_index = ROOT.id }
		set_temp_variable = { influence_target = SOL.id }
		change_influence_percentage = yes

		ai_chance = {
			base = 1
		}
	}
}

country_event = { # Solomon Islands Civilian Industry Request - Ask the other guys
	id = solomon_competition.2
	title = solomon_competition.2.t
	desc = solomon_competition.2.d
	picture = GFX_report_event_generic_1

	is_triggered_only = yes
	fire_only_once = yes

	option = {
		name = solomon_competition.2.o1 # We'll help out
		log = "[GetDateText]: [This.GetName]: solomon_competition.2.o1 executed"

		if = {
			limit = { original_tag = AST }
			add_to_variable = { SOL.SOL_AST_support = 4 }
			log = "[GetDateText]: Australia has agreed to help the Solomon Islands (Competition Score [?SOL.SOL_AST_support])"
		}
		else = {
			add_to_variable = { SOL.SOL_CHI_support = 4 }
			log = "[GetDateText]: China has agreed to help the Solomon Islands (CompetitionScore [?SOL.SOL_CHI_support])"
		}

		# Build industry in Solomon Islands at cost
		set_temp_variable = { treasury_change = -12.5 }
		modify_treasury_effect = yes
		SOL = {
			random_owned_controlled_state = {
				add_extra_state_shared_building_slots = 1
				add_building_construction = {
					type = industrial_complex
					level = 1
					instant_build = yes
				}
			}
			country_event = { id = solomon_competition.3 days = 1 }
			set_country_flag = SOL_industry_construction_built
		}

		set_temp_variable = { percent_change = 10 } # Extra grateful
		set_temp_variable = { tag_index = ROOT.id }
		set_temp_variable = { influence_target = SOL.id }
		change_influence_percentage = yes

		ai_chance = {
			base = 2 # More likely to accept after rejection by opponent.

			modifier = {
				check_variable = { treasury < 12.5 }
				factor = 0
			}
		}
	}

	option = {
		name = solomon_competition.2.o2 # We're not interested
		log = "[GetDateText]: [This.GetName]: solomon_competition.2.o2 executed"

		SOL = {
			country_event = { id = solomon_competition.4 days = 1 }
		}

		# Reduce the influence of the rejector
		set_temp_variable = { percent_change = -5 } # Extra disappointed
		set_temp_variable = { tag_index = ROOT.id }
		set_temp_variable = { influence_target = SOL.id }
		change_influence_percentage = yes

		ai_chance = {
			base = 1
		}
	}
}

country_event = { # Solomon Islands Civilian Industry Request - Someone agreed to help
	id = solomon_competition.3
	title = solomon_competition.3.t
	desc = solomon_competition.3.d
	picture = GFX_report_event_generic_1

	is_triggered_only = yes
	fire_only_once = yes

	option = {
		name = solomon_competition.3.o1 # Great news!
		log = "[GetDateText]: [This.GetName]: solomon_competition.3.o1 executed"

		country_event = { id = solomon_competition.5 days = 250 random_days = 100 } # Make next decision available

		add_opinion_modifier = {
			modifier = recently_invest
			target = ROOT
		}
	}
}

country_event = { # Solomon Islands Civilian Industry Request - Nobody wants to help
	id = solomon_competition.4
	title = solomon_competition.4.t
	desc = solomon_competition.4.d
	picture = GFX_report_event_generic_1

	is_triggered_only = yes
	fire_only_once = yes

	option = {
		name = solomon_competition.4.o1 # We've been abandoned...
		log = "[GetDateText]: [This.GetName]: solomon_competition.4.o1 executed"

		country_event = { id = solomon_competition.5 days = 250 random_days = 100 }
	}
}

country_event = { # The second set of decisions in the Solomon Competition becomes available.
	id = solomon_competition.5
	title = solomon_competition.5.t # Onwards to a better future!
	desc = solomon_competition.5.d
	picture = GFX_report_event_generic_1

	is_triggered_only = yes
	fire_only_once = yes

	option = {
		name = solomon_competition.5.o1 # Onwards to a better future!
		log = "[GetDateText]: [This.GetName]: solomon_competition.5 executed"

		set_country_flag = SOL_solomon_competition_second_stage
	}
}

country_event = { # Solomon Islands Infrastructure Request - Initial choice
	id = solomon_competition.6
	title = solomon_competition.6.t
	desc = solomon_competition.6.d
	picture = GFX_report_event_generic_1

	is_triggered_only = yes
	fire_only_once = yes

	option = {
		name = solomon_competition.6.o1 # We'll help out
		log = "[GetDateText]: [This.GetName]: solomon_competition.6.o1 executed"

		if = {
			limit = { original_tag = AST }
			add_to_variable = { SOL.SOL_AST_support = 2 }
			log = "[GetDateText]: Australia has agreed to help the Solomon Islands (Competition Score [?SOL.SOL_AST_support])"
		}
		else = {
			add_to_variable = { SOL.SOL_CHI_support = 2 }
			log = "[GetDateText]: China has agreed to help the Solomon Islands (Competition Score [?SOL.SOL_CHI_support])"
		}

		# Build infrastructure in Solomon Islands at cost
		set_temp_variable = { treasury_change = -5 }
		modify_treasury_effect = yes
		SOL = {
			random_owned_controlled_state = {
				add_extra_state_shared_building_slots = 1
				add_building_construction = {
					type = infrastructure
					level = 1
					instant_build = yes
				}
			}
			country_event = { id = solomon_competition.8 days = 1 } # Confirmation of investment
			set_country_flag = SOL_infrastructure_construction_built
		}

		# Give influence to investor
		set_temp_variable = { percent_change = 2 }
		set_temp_variable = { tag_index = ROOT.id }
		set_temp_variable = { influence_target = SOL.id }
		change_influence_percentage = yes

		ai_chance = {
			base = 1

			modifier = {
				check_variable = { treasury < 4.99 }
				factor = 0
			}
		}
	}

	option = {
		name = solomon_competition.6.o2 # We're not interested
		log = "[GetDateText]: [This.GetName]: solomon_competition.6.o2 executed"

		# Approach the other guys
		if = {
			limit = { original_tag = AST }
			CHI = {
				country_event = { id = solomon_competition.7 days = 1 }
			}
		}
		else = {
			AST = {
				country_event = { id = solomon_competition.7 days = 1 }
			}
		}

		# Reduce the influence of the rejector
		set_temp_variable = { percent_change = -3 }
		set_temp_variable = { tag_index = ROOT.id }
		set_temp_variable = { influence_target = SOL.id }
		change_influence_percentage = yes

		ai_chance = {
			base = 1
		}
	}
}

country_event = { # Solomon Islands Infrastructure Request - Ask the other guys
	id = solomon_competition.7
	title = solomon_competition.7.t
	desc = solomon_competition.7.d
	picture = GFX_report_event_generic_1

	is_triggered_only = yes
	fire_only_once = yes

	option = {
		name = solomon_competition.7.o1 # We'll help out
		log = "[GetDateText]: [This.GetName]: solomon_competition.7.o1 executed"

		if = {
			limit = { original_tag = AST }
			add_to_variable = { SOL.SOL_AST_support = 2 }
			log = "[GetDateText]: Australia has agreed to help the Solomon Islands (Competition Score [?SOL.SOL_AST_support])"
		}
		else = {
			add_to_variable = { SOL.SOL_CHI_support = 2 }
			log = "[GetDateText]: China has agreed to help the Solomon Islands (Competition Score [?SOL.SOL_CHI_support])"
		}

		# Build infrastructure in Solomon Islands at cost
		set_temp_variable = { treasury_change = -5 }
		modify_treasury_effect = yes
		SOL = {
			random_owned_controlled_state = {
				add_extra_state_shared_building_slots = 1
				add_building_construction = {
					type = infrastructure
					level = 1
					instant_build = yes
				}
			}
			country_event = { id = solomon_competition.8 days = 1 }
			set_country_flag = SOL_infrastructure_construction_built
		}

		set_temp_variable = { percent_change = 10 } # Extra grateful
		set_temp_variable = { tag_index = ROOT.id }
		set_temp_variable = { influence_target = SOL.id }
		change_influence_percentage = yes

		ai_chance = {
			base = 2 # More likely to accept after rejection by opponent.

			modifier = {
				check_variable = { treasury < 4.99 }
				factor = 0
			}
		}
	}

	option = {
		name = solomon_competition.7.o2 # We're not interested
		log = "[GetDateText]: [This.GetName]: solomon_competition.7.o2 executed"

		SOL = {
			country_event = { id = solomon_competition.9 days = 1 }
		}

		# Reduce the influence of the rejector
		set_temp_variable = { percent_change = -5 } # Extra disappointed
		set_temp_variable = { tag_index = ROOT.id }
		set_temp_variable = { influence_target = SOL.id }
		change_influence_percentage = yes

		ai_chance = {
			base = 1
		}
	}
}

country_event = { # Solomon Islands Infrastructure Request - Someone agreed to help
	id = solomon_competition.8
	title = solomon_competition.8.t
	desc = solomon_competition.8.d
	picture = GFX_report_event_generic_1

	is_triggered_only = yes
	fire_only_once = yes

	option = {
		name = solomon_competition.8.o1 # Great news!
		log = "[GetDateText]: [This.GetName]: solomon_competition.8.o1 executed"

		country_event = { id = solomon_competition.10 days = 250 random_days = 100 } # Make next decision available

		add_opinion_modifier = {
			modifier = recently_invest
			target = ROOT
		}
	}
}

country_event = { # Solomon Islands Civilian Industry Request - Nobody wants to help
	id = solomon_competition.9
	title = solomon_competition.9.t
	desc = solomon_competition.9.d
	picture = GFX_report_event_generic_1

	is_triggered_only = yes
	fire_only_once = yes

	option = {
		name = solomon_competition.9.o1 # We've been abandoned...
		log = "[GetDateText]: [This.GetName]: solomon_competition.9.o1 executed"

		country_event = { id = solomon_competition.10 days = 250 random_days = 100 }
	}
}

country_event = { # The third set of decisions in the Solomon Competition becomes available.
	id = solomon_competition.10
	title = solomon_competition.10.t # The Information Age
	desc = solomon_competition.10.d
	picture = GFX_report_event_generic_1

	is_triggered_only = yes
	fire_only_once = yes

	option = {
		name = solomon_competition.10.o1 # Let's get connected!
		log = "[GetDateText]: [This.GetName]: solomon_competition.10.o1 executed"

		set_country_flag = SOL_solomon_competition_third_stage
	}
}

country_event = { # Solomon unrest
	id = solomon_competition.25
	title = solomon_competition.25.t
	desc = solomon_competition.25.d
	picture = GFX_internal_conflict

	is_triggered_only = yes
	fire_only_once = yes

	immediate = {
		add_stability = -0.10
	}

	option = {
		name = solomon_competition.25.o1 # Maybe things will improve?
		log = "[GetDateText]: [This.GetName]: solomon_competition.25.o1 executed"

		country_event = { id = solomon_competition.26 days = 14 }
	}
}

country_event = { # Violence erupts
	id = solomon_competition.26
	title = solomon_competition.26.t
	desc = solomon_competition.26.d
	picture = GFX_2003_solomon_unrest

	is_triggered_only = yes
	fire_only_once = yes

	immediate = {
		add_stability = -0.20
	}

	option = {
		name = solomon_competition.26.o1 # We need international assistance
		log = "[GetDateText]: [This.GetName]: solomon_competition.26.o1 executed"

		AST = {
			country_event = { id = solomon_competition.27 days = 2 }
		}
	}
}

country_event = { # Operation RAMSI - Initial request
	id = solomon_competition.27
	title = solomon_competition.27.t
	desc = {
		text = solomon_competition.27.d2 # China gets request
		trigger = {
			tag = CHI
		}
	}
	desc = solomon_competition.27.d1 # Australia gets request
	picture = GFX_2003_solomon_unrest
	trigger = {
		tag = AST
	}

	is_triggered_only = yes
	fire_only_once = yes

	option = {
		name = solomon_competition.27.o1 # Send our forces
		log = "[GetDateText]: [This.GetName]: solomon_competition.27.o1 executed"

		add_manpower = -2000
		set_temp_variable = { treasury_change = -1 }
        modify_treasury_effect = yes

		if = {
			limit = { original_tag = AST }
			add_to_variable = { SOL.SOL_AST_support = 8 }
			SOL = {
				add_ideas = SOL_AST_idea_contained_ethnic_violence
			}
			log = "[GetDateText]: Australia has agreed to help the Solomon Islands with Operation RAMSI (Competition Score [?SOL.SOL_AST_support])"
		}
		else = {
			add_to_variable = { SOL.SOL_CHI_support = 8 }
			SOL = {
				add_ideas = SOL_CHI_idea_contained_ethnic_violence
			}
			log = "[GetDateText]: China has agreed to help the Solomon Islands with Operation RAMSI (Competition Score [?SOL.SOL_CHI_support])"
		}

		SOL = {
			set_variable = { RAMSI_supporter = PREV }
			country_event = { id = solomon_competition.28 days = 1 }
		}

		log = "RAMSI_supporter is [?SOL.RAMSI_supporter.GetName]"

		ai_chance = {
			base = 3
		}
	}

	option = {
		name = solomon_competition.27.o2 # Let's see how this plays out
		log = "[GetDateText]: [This.GetName]: solomon_competition.27.o2 executed"

		CHI = {
			country_event = { id = solomon_competition.29 days = 1 }
		}

		ai_chance = {
			base = 1
		}
	}
}

country_event = { # Operation RAMSI - Accepted request
	id = solomon_competition.28
	title = solomon_competition.28.t
	desc = solomon_competition.28.d
	picture = GFX_2003_solomon_unrest

	is_triggered_only = yes
	fire_only_once = yes

	option = {
		name = solomon_competition.28.o1 # Thank goodness...
		log = "[GetDateText]: [This.GetName]: solomon_competition.28.o1 executed"

		add_opinion_modifier = {
			modifier = SOL_ramsi_support
			target = SOL.RAMSI_supporter
		}
	}
}

country_event = { # Operation RAMSI - Rejected request
	id = solomon_competition.29
	title = solomon_competition.29.t
	desc = solomon_competition.29.d
	picture = GFX_2003_solomon_unrest

	is_triggered_only = yes
	fire_only_once = yes

	option = {
		name = solomon_competition.29.o1 # We're on our own...
		log = "[GetDateText]: [This.GetName]: solomon_competition.29.o1 executed"

		add_opinion_modifier = {
			modifier = SOL_abandoned_us
			target = AST
		}

		add_opinion_modifier = {
			modifier = SOL_abandoned_us
			target = CHI
		}

		add_ideas = SOL_idea_rampant_ethnic_violence
		add_ideas = SOL_idea_humanitarian_disaster
	}
}