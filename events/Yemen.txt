add_namespace = Yemen

### Yemeni civil war cleanup events ###

#Give the winner YEM cosmetic tag
country_event = {
	id = Yemen.0
	
	hidden = yes
	
	trigger = {
		OR = {
			AND = {
				tag = HOU
				NOT = {
					country_exists = YEM
					country_exists = AQY
				}
			}
			AND = {
				tag = YEM
				NOT = {
					country_exists = HOU
					country_exists = AQY
				}
			}
			AND = {
				tag = AQY
				NOT = {
					country_exists = HOU 
					country_exists = YEM
				}
			}
		}
		NOT = { has_global_flag = Yemen_Civil_War_Over }
	}
	
	immediate = {
		#Civil war is over
		set_global_flag = Yemen_Civil_War_Over
		#Clear core status
		194 = {
			remove_core_of = YEM
			remove_core_of = AQY
			remove_core_of = HOU
		}
		195 = {
			remove_core_of = YEM
			remove_core_of = AQY
			remove_core_of = HOU
		}
		196 = {
			remove_core_of = YEM
			remove_core_of = AQY
			remove_core_of = HOU
		}
		197 = {
			remove_core_of = YEM
			remove_core_of = AQY
			remove_core_of = HOU
		}
		198 = {
			remove_core_of = YEM
			remove_core_of = AQY
			remove_core_of = HOU
		}
		199 = {
			remove_core_of = YEM
			remove_core_of = AQY
			remove_core_of = HOU
		}
		200 = {
			remove_core_of = YEM
			remove_core_of = AQY
			remove_core_of = HOU
		}
		#Make the winner Yemen
		if = {
			limit = {
				OR = {
					tag = HOU
					#tag = AQY
				}
			}
			set_cosmetic_tag = YEM
		}
		add_state_core = 194
		add_state_core = 195
		add_state_core = 196
		add_state_core = 197
		add_state_core = 198
		add_state_core = 199
		add_state_core = 200
		set_capital = 195
	}
	
	mean_time_to_happen = {
		days = 2
	}
	
	option = {
		name = Yemen.0.a
	}
}

#Al-Qaeda in Yemen is beaten. Force a peace deal as not to drag the war on forever
country_event = {
	id = Yemen.1
	
	hidden = yes
	
	trigger = {
		country_exists = AQY
		AQY = { 
			has_capitulated = yes
			is_in_faction = yes 
		}
		NOT = { has_global_flag = Yemen_Civil_War_Over } 	#No special rules if Al-Qaeda has already won Yemeni civil war
	}
	
	immediate = {
		remove_from_faction = AQY
	}
	
	mean_time_to_happen = {
		days = 2
	}
	
	option = {
		name = Yemen.1.a
	}
}

#Recreate Yemen in case it has been annexed
country_event = {
	id = Yemen.2
	
	hidden = yes
	
	trigger = {
		NOT = {
			country_exists = YEM
			country_exists = AQY
			country_exists = HOU
		}
		NOT = { 195 = { is_core_of = YEM } }
	}
	
	immediate = {
		#Clear core status
		194 = {
			remove_core_of = YEM
			remove_core_of = AQY
			remove_core_of = HOU
		}
		195 = {
			remove_core_of = YEM
			remove_core_of = AQY
			remove_core_of = HOU
		}
		196 = {
			remove_core_of = YEM
			remove_core_of = AQY
			remove_core_of = HOU
		}
		197 = {
			remove_core_of = YEM
			remove_core_of = AQY
			remove_core_of = HOU
		}
		198 = {
			remove_core_of = YEM
			remove_core_of = AQY
			remove_core_of = HOU
		}
		199 = {
			remove_core_of = YEM
			remove_core_of = AQY
			remove_core_of = HOU
		}
		200 = {
			remove_core_of = YEM
			remove_core_of = AQY
			remove_core_of = HOU
		}
		YEM = {
			add_state_core = 194
			add_state_core = 195
			add_state_core = 196
			add_state_core = 197
			add_state_core = 198
			add_state_core = 199
			add_state_core = 200
			set_capital = 195
		}
	}
	
	mean_time_to_happen = {
		days = 2
	}
	
	option = {
		name = Yemen.2.a
	}
}

### Yemeni Post Civil War Events ###

# Houthi Victory - Revolutionary Committee
country_event = {
	id = Yemen.3
	title = Yemen.3.t
	desc = Yemen.3.d
	picture = HOU_SPC
	
	fire_only_once = yes

	trigger = {
        tag = HOU
		has_global_flag = Yemen_Civil_War_Over
        NOT = {
            country_exists = YEM
            country_exists = AQY
        }
    }

	mean_time_to_happen = {
		days = 2
	}

	option = {
		name = Yemen.3.a
		HOU = {
		hidden_effect = {
		set_politics = { 
		    ruling_party = Nationalist
		    elections_allowed = no 
	    }
		
		retire_country_leader = yes
		
		set_politics = { 
		    ruling_party = fascism
		    elections_allowed = no 
	    }
		clr_global_flag = Yemen_Civil_War_Over
	}
}
		YEM = {
		    set_party_name = { 
		    ideology = Nationalist 
		    long_name = YEM_Nationalist2_party_long
		    name = YEM_Nationalist2_party 
		    }
	            create_country_leader = {
	            name = "Ali Abdullah Saleh"
	            desc = ""
	            picture = "Ali-Saleh.dds"
	            expire = "2050.1.1"
	            ideology = Nat_Autocracy
	            traits = {
            		#
            	}
            }
		    set_politics = { 
		        ruling_party = Nationalist
		        elections_allowed = no 
	        }
        hidden_effect = { 
            set_political_party = {
            ideology = Nationalist
            popularity = 80
	        }
		    set_political_party = {
            ideology = fascism
            popularity = 2
	        }
		    set_political_party = {
            ideology = communism
            popularity = 14
	            }
            set_political_party = {
            ideology = democratic
            popularity = 0
	            }
            set_political_party = {
            ideology = neutrality
            popularity = 4
	            }				
		    }
		hidden_effect = {
			add_state_core = 197
			add_state_core = 195
			add_state_core = 198
			add_state_core = 196
			add_state_core = 199
			add_state_core = 194
			add_state_core = 200
			
			set_state_owner = 198
			set_state_owner = 197
			}
			
			set_state_controller = 198
			set_state_controller = 197
			
			declare_war_on = {
	        target = HOU
	        type = civil_war 
            }
			
		hidden_effect = {
			load_oob = "YEM_Saleh"
			set_equipment_fraction = 0.5
			}
		}    
	}

	option = {
		name = Yemen.3.b
		set_party_name = { 
		ideology = Nationalist 
		long_name = HOU_Nationalist2_party_long
		name = HOU_Nationalist2_party 
		}
		hidden_effect = {
            set_political_party = {
            ideology = Nationalist
            popularity = 50
	        }
		    set_political_party = {
            ideology = fascism
            popularity = 50
	        }
		    set_political_party = {
            ideology = communism
            popularity = 0	
	            }    
		    }
			    set_politics = { 
		        ruling_party = Nationalist
		        elections_allowed = no 
        }		
    }
}

# General Civil War Ending Event
news_event = {
    id = Yemen.4
    title = Yemen.4.t
    desc = Yemen.4.d
    picture = HOU_SPC
    
    fire_only_once = yes

    trigger = {
        # or means Any of the following must be true    
        or = {
            #If Houthis wins
            and = {
                tag = HOU
                NOT = {
                    country_exists = YEM
                    country_exists = AQY
                }
            }
           #If Yemen wins
            and = {
                tag = YEM
                NOT = {
                    country_exists = HOU
                    country_exists = AQY
                }
            }
           #If AQY Wins
            and = {
                tag = AQY
                NOT = {
                    country_exists = HOU
                    country_exists = YEM
                }
            }
			
        has_global_flag = Yemen_Civil_War_Over    
		
        }
    }
	
	mean_time_to_happen = {
		days = 2
	}
    
    #Option if Houthis wins
    option = {
        name = Yemen.4.a
        trigger = { TAG = HOU }
    }
    
    #Option if Yemen wins
    option = {
        name = Yemen.4.b
        trigger = { TAG = YEM }
    }
    #Option if Ansar al-Sharia wins
    option = {
        name = Yemen.4.c
        trigger = { TAG = AQY }
    }
	
	#Option for the rest of the world
    option = {
        name = Yemen.4.e
		trigger = {
			NOT = {
				TAG = YEM
				TAG = HOU
				TAG = AQY
			}
		}
    }
}
			