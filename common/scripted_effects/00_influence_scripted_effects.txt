#Written by Killerrabbit and SWF541

sort_influence = {
	resize_temp_array = { 
		array = influence_array_val_temp #values
		size = influence_array_val^num
	}
	resize_array = { 
		array = influence_array_calc #values
		size = influence_array_val^num
	}
	for_loop_effect = {
		end = influence_array_val^num
		value = v
		find_highest_in_array = {
			array = influence_array_val 
			value = max
			index = max_index
		}
		set_variable = { influence_array_val_temp^v = max } #sets biggest at the earliest available position
		set_variable = { influence_array^v = influence_array^max_index } #sets biggest TAG at the earliest available position
		set_variable = { influence_array_val^max_index = -1 } #removes it from selection
	}
	clear_array = influence_array_val
	for_each_loop = {
		array = influence_array_val_temp
		add_to_array = { influence_array_val = v  }
		set_variable = { influence_array_calc^i = v }
	}
	clear_temp_array = influence_array_val_temp
	set_variable = { domestic_influence_amount_calc = domestic_influence_amount }
}

calculate_influence_percentage = {

	for_each_loop = {
		array = influence_array_calc
		add_to_temp_variable = { influence_total = v }
	}
	add_to_temp_variable = { influence_total = domestic_influence_amount_calc }
	for_each_loop = {
		array = influence_array_calc
		round_variable = influence_array_calc^v
		divide_variable = { influence_array_calc^v = influence_total }
		if = {
			limit = { var:influence_array^v = { has_government = democratic } }
			add_to_temp_variable = { influence_democratic = influence_array_calc^v }	
		}
		else_if = {
			limit = { var:influence_array^v = { has_government = neutrality } }
			add_to_temp_variable = { influence_neutrality = influence_array_calc^v }	
		}
		else_if = {
			limit = { var:influence_array^v = { has_government = communism } }
			add_to_temp_variable = { influence_communism = influence_array_calc^v }	
		}
		else_if = {
			limit = { var:influence_array^v = { has_government = nationalist } }
			add_to_temp_variable = { influence_nationalist = influence_array_calc^v }	
		}
		else_if = {
			limit = { var:influence_array^v = { has_government = fascism } }
			add_to_temp_variable = { influence_fascism = influence_array_calc^v }	
		}
	}
	round_variable = domestic_influence_amount_calc
	divide_variable = { domestic_influence_amount_calc = influence_total }
	
	### see ideology_drifts.txt: ###
	clear_influence_count_ideas = yes

	if = { limit = { check_variable = { influence_democratic > 0.04 } } reset_democratic_influence_ideas = yes }
	if = { limit = { check_variable = { influence_neutrality > 0.04 } } reset_neutrality_influence_ideas = yes }
	if = { limit = { check_variable = { influence_communism > 0.04 } } reset_communism_influence_ideas = yes }
	if = { limit = { check_variable = { influence_nationalist > 0.04 } } reset_nationalist_influence_ideas = yes }
	if = { limit = { check_variable = { influence_fascism > 0.04 } } reset_fascism_influence_ideas = yes }
}