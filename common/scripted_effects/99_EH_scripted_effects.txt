EH_drone_mission_calculations_effect = {
    # Drones bonus
    set_variable = { EH_drone_success_chance = EH_selected_drones_var }
    multiply_variable = { EH_drone_success_chance = 0.06 }

    # Air Intel bonus
    set_variable = { EH_temp_air_intel = air_intel@ALN }
    multiply_variable = { EH_temp_air_intel = 0.55 }
    add_to_variable = { EH_drone_success_chance = EH_temp_air_intel }

    # Failure chance
    set_variable = { EH_drone_failure_chance = 100 }
    subtract_from_variable = { EH_drone_failure_chance = EH_drone_success_chance }
}

EH_drone_mission_effect = {
    random_list = {
        EH_drone_success_chance = {
            # Success
            add_intel = {
                target = ALN
                army_intel = 15
                airforce_intel = 15
            }
            country_event = EH_focus_event.3
            set_country_flag = EH_country_succeeded_in_drone_mission_flag # Important further while recruiting scientists
            clear_variable = EH_drone_success_chance
            clear_variable = EH_drone_failure_chance
            clear_variable = EH_temp_air_intel

            set_temp_variable_to_random = {
                var = EH_temp_drones_lost
                max = EH_selected_drones_var
                integer = yes
            }
            add_ai_strategy = {
			    type = equipment_variant_production_factor
			    id = Air_UAV_equipment
			    value = -100
			}
        }
        EH_drone_failure_chance = {
            # Failure
            set_temp_variable = { EH_temp_drones_lost = EH_selected_drones_var }
            country_event = EH_focus_event.4
        }
    }
    multiply_temp_variable = { EH_temp_drones_lost = -1 }
    add_equipment_to_stockpile = {
        type = Air_UAV_equipment
        amount = EH_temp_drones_lost
    }
}

EH_calculate_research_sites_effects = {
    set_variable = { EH_research_sites_research_speed_factor_var = 0.01 }
    set_variable = { EH_research_sites_scientist_breakthrough_bonus_factor_var = 0.02 }
    set_variable = { EH_research_sites_scientist_research_bonus_factor_var = 0.025 }
    set_variable = { EH_research_sites_scientist_xp_gain_factor_var = 0.03 }
    multiply_variable = { EH_research_sites_research_speed_factor_var = EH_research_sites_constructed_var }
    multiply_variable = { EH_research_sites_scientist_breakthrough_bonus_factor_var = EH_research_sites_constructed_var }
    multiply_variable = { EH_research_sites_scientist_research_bonus_factor_var = EH_research_sites_constructed_var }
    multiply_variable = { EH_research_sites_scientist_xp_gain_factor_var = EH_research_sites_constructed_var }
}

EH_research_site_strike_effect = {
    set_temp_variable = { EH_temp_strike_success_chance = 80 }
    subtract_from_temp_variable = { EH_temp_strike_success_chance = EH_research_sites_protection_var }

    set_temp_variable = { EH_temp_strike_failure_chance = 100 }
    subtract_from_temp_variable = { EH_temp_strike_failure_chance = EH_temp_strike_success_chance }

    random_list = {
        EH_temp_strike_success_chance = {
            # Success
            set_country_flag = {
                flag = EH_research_sites_strike_cooldown_flag
                days = 21
                value = 1
            }
            subtract_from_variable = { EH_research_sites_constructed_var = 1 }
            clamp_variable = {
                var = EH_research_sites_constructed_var
                min = 0
            }
            EH_calculate_research_sites_effects = yes
            if = {
                limit = {
                    has_country_flag = EH_research_sites_disable_notifications_flag
                }
                add_manpower = -50
		        ALN = {
			        add_manpower = -120
		        }
		        add_breakthrough_progress = {
 			        specialization = specialization_land
  			        value = -0.15
		        }
            }
            else = {
                country_event = EH_focus_event.5
            }
            EH_research_site_scientist_survive_effect = yes
        }
        EH_temp_strike_failure_chance = {
            # Failure
            set_country_flag = {
                flag = EH_research_sites_strike_cooldown_flag
                days = 35
                value = 1
            }
            if = {
                limit = {
                    has_country_flag = EH_research_sites_disable_notifications_flag
                }
                add_manpower = -15
		        ALN = {
			        add_manpower = -240
		        }
            }
            else = {
                country_event = EH_focus_event.6
            }
        }
    }
}

EH_research_site_scientist_survive_effect = {
    set_temp_variable = { EH_temp_scientist_killed_chance = 40 }
    set_temp_variable = { EH_temp_scientist_injured_chance = 60 }
    subtract_from_temp_variable = { EH_temp_scientist_killed_chance = EH_research_sites_scientist_protection_var }
    subtract_from_temp_variable = { EH_temp_scientist_injured_chance = EH_research_sites_scientist_protection_var }

    set_temp_variable = { EH_temp_scientist_survived_chance = 100 }
    subtract_from_temp_variable = { EH_temp_scientist_survived_chance = EH_temp_scientist_killed_chance }
    subtract_from_temp_variable = { EH_temp_scientist_survived_chance = EH_temp_scientist_injured_chance }

    random_list = {
        EH_temp_scientist_killed_chance = {
            # Killed
            country_event = EH_focus_event.7
        }
        EH_temp_scientist_injured_chance = {
            # Injured
            country_event = EH_focus_event.8
        }
        EH_temp_scientist_survived_chance = {
            # Survived
            # Nothing happens
        }
    }
}