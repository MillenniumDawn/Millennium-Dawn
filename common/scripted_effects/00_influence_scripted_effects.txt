#Written by Killerrabbit and SWF541

startup_influence = {
	influence_refresh = yes
	set_variable = { found_num_vars = 0 } #always have this
	if = { limit = { NOT = { check_variable = { found_num_vars = total_influencers } } }
		find_largest_influence = yes #returns the largest not found yet 1
	}
	if = { limit = { NOT = { check_variable = { found_num_vars = total_influencers } } }
		find_largest_influence = yes #returns the largest not found yet	2
	}	
	if = { limit = { NOT = { check_variable = { found_num_vars = total_influencers } } }
		find_largest_influence = yes #returns the largest not found yet	3
	}
	if = { limit = { NOT = { check_variable = { found_num_vars = total_influencers } } }
		find_largest_influence = yes #returns the largest not found yet	4
	}
	if = { limit = { NOT = { check_variable = { found_num_vars = total_influencers } } }
		find_largest_influence = yes #returns the largest not found yet	5
	}
	if = { limit = { NOT = { check_variable = { found_num_vars = total_influencers } } }
		find_largest_influence = yes #returns the largest not found yet	6
	}
	if = { limit = { NOT = { check_variable = { found_num_vars = total_influencers } } }
		find_largest_influence = yes #returns the largest not found yet	7
	}
	
	##delete unnecessary variables (they are annoying!) 
	else_if = { limit = { check_variable = { influencer1_amount_calc = 0 } } 
		clear_variable = influencer1
		clear_variable = influencer1_amount
		clear_variable = influencer1_amount_calc
		clear_variable = influencer2
		clear_variable = influencer2_amount
		clear_variable = influencer2_amount_calc
		clear_variable = influencer3
		clear_variable = influencer3_amount
		clear_variable = influencer3_amount_calc
		clear_variable = influencer4
		clear_variable = influencer4_amount
		clear_variable = influencer4_amount_calc
		clear_variable = influencer5
		clear_variable = influencer5_amount
		clear_variable = influencer5_amount_calc
		clear_variable = influencer6
		clear_variable = influencer6_amount
		clear_variable = influencer6_amount_calc
		clear_variable = influencer7
		clear_variable = influencer7_amount
		clear_variable = influencer7_amount_calc
	}
	else_if = { limit = { check_variable = { influencer2_amount_calc = 0 } }
		clear_variable = influencer2
		clear_variable = influencer2_amount
		clear_variable = influencer2_amount_calc
		clear_variable = influencer3
		clear_variable = influencer3_amount
		clear_variable = influencer3_amount_calc
		clear_variable = influencer4
		clear_variable = influencer4_amount
		clear_variable = influencer4_amount_calc
		clear_variable = influencer5
		clear_variable = influencer5_amount
		clear_variable = influencer5_amount_calc
		clear_variable = influencer6
		clear_variable = influencer6_amount
		clear_variable = influencer6_amount_calc
		clear_variable = influencer7
		clear_variable = influencer7_amount
		clear_variable = influencer7_amount_calc
	}
	else_if = { limit = { check_variable = { influencer3_amount_calc = 0 } }
		clear_variable = influencer3
		clear_variable = influencer3_amount
		clear_variable = influencer3_amount_calc
		clear_variable = influencer4
		clear_variable = influencer4_amount
		clear_variable = influencer4_amount_calc
		clear_variable = influencer5
		clear_variable = influencer5_amount
		clear_variable = influencer5_amount_calc
		clear_variable = influencer6
		clear_variable = influencer6_amount
		clear_variable = influencer6_amount_calc
		clear_variable = influencer7
		clear_variable = influencer7_amount
		clear_variable = influencer7_amount_calc
	}
	else_if = { limit = { check_variable = { influencer4_amount_calc = 0 } }
		clear_variable = influencer4
		clear_variable = influencer4_amount
		clear_variable = influencer4_amount_calc
		clear_variable = influencer5
		clear_variable = influencer5_amount
		clear_variable = influencer5_amount_calc
		clear_variable = influencer6
		clear_variable = influencer6_amount
		clear_variable = influencer6_amount_calc
		clear_variable = influencer7
		clear_variable = influencer7_amount
		clear_variable = influencer7_amount_calc
	}
	else_if = { limit = { check_variable = { influencer5_amount_calc = 0 } }
		clear_variable = influencer5
		clear_variable = influencer5_amount
		clear_variable = influencer5_amount_calc
		clear_variable = influencer6
		clear_variable = influencer6_amount
		clear_variable = influencer6_amount_calc
		clear_variable = influencer7
		clear_variable = influencer7_amount
		clear_variable = influencer7_amount_calc
	}
	else_if = { limit = { check_variable = { influencer6_amount_calc = 0 } }
		clear_variable = influencer6
		clear_variable = influencer6_amount
		clear_variable = influencer6_amount_calc
		clear_variable = influencer7
		clear_variable = influencer7_amount
		clear_variable = influencer7_amount_calc
	}
	else_if = { limit = { check_variable = { influencer7_amount_calc = 0 } }
		clear_variable = influencer7
		clear_variable = influencer7_amount
		clear_variable = influencer7_amount_calc
	}
	#recalculate_influence_drift = yes #doesn't work on startup
}

#Script to run after any change to influence
recalculate_influence = {
	influence_refresh = yes
	set_variable = { found_num_vars = 0 } #always have this
	if = { limit = { NOT = { check_variable = { found_num_vars = total_influencers } } }
		find_largest_influence = yes #returns the largest not found yet 1
	}
	if = { limit = { NOT = { check_variable = { found_num_vars = total_influencers } } }
		find_largest_influence = yes #returns the largest not found yet	2
	}	
	if = { limit = { NOT = { check_variable = { found_num_vars = total_influencers } } }
		find_largest_influence = yes #returns the largest not found yet	3
	}
	if = { limit = { NOT = { check_variable = { found_num_vars = total_influencers } } }
		find_largest_influence = yes #returns the largest not found yet	4
	}
	if = { limit = { NOT = { check_variable = { found_num_vars = total_influencers } } }
		find_largest_influence = yes #returns the largest not found yet	5
	}
	if = { limit = { NOT = { check_variable = { found_num_vars = total_influencers } } }
		find_largest_influence = yes #returns the largest not found yet	6
	}
	if = { limit = { NOT = { check_variable = { found_num_vars = total_influencers } } }
		find_largest_influence = yes #returns the largest not found yet	7
	}
	
	##delete unnecessary variables (they are annoying!) 
	else_if = { limit = { check_variable = { influencer1_amount_calc = 0 } } 
		clear_variable = influencer1
		clear_variable = influencer1_amount
		clear_variable = influencer1_amount_calc
		clear_variable = influencer2
		clear_variable = influencer2_amount
		clear_variable = influencer2_amount_calc
		clear_variable = influencer3
		clear_variable = influencer3_amount
		clear_variable = influencer3_amount_calc
		clear_variable = influencer4
		clear_variable = influencer4_amount
		clear_variable = influencer4_amount_calc
		clear_variable = influencer5
		clear_variable = influencer5_amount
		clear_variable = influencer5_amount_calc
		clear_variable = influencer6
		clear_variable = influencer6_amount
		clear_variable = influencer6_amount_calc
		clear_variable = influencer7
		clear_variable = influencer7_amount
		clear_variable = influencer7_amount_calc
	}
	else_if = { limit = { check_variable = { influencer2_amount_calc = 0 } }
		clear_variable = influencer2
		clear_variable = influencer2_amount
		clear_variable = influencer2_amount_calc
		clear_variable = influencer3
		clear_variable = influencer3_amount
		clear_variable = influencer3_amount_calc
		clear_variable = influencer4
		clear_variable = influencer4_amount
		clear_variable = influencer4_amount_calc
		clear_variable = influencer5
		clear_variable = influencer5_amount
		clear_variable = influencer5_amount_calc
		clear_variable = influencer6
		clear_variable = influencer6_amount
		clear_variable = influencer6_amount_calc
		clear_variable = influencer7
		clear_variable = influencer7_amount
		clear_variable = influencer7_amount_calc
	}
	else_if = { limit = { check_variable = { influencer3_amount_calc = 0 } }
		clear_variable = influencer3
		clear_variable = influencer3_amount
		clear_variable = influencer3_amount_calc
		clear_variable = influencer4
		clear_variable = influencer4_amount
		clear_variable = influencer4_amount_calc
		clear_variable = influencer5
		clear_variable = influencer5_amount
		clear_variable = influencer5_amount_calc
		clear_variable = influencer6
		clear_variable = influencer6_amount
		clear_variable = influencer6_amount_calc
		clear_variable = influencer7
		clear_variable = influencer7_amount
		clear_variable = influencer7_amount_calc
	}
	else_if = { limit = { check_variable = { influencer4_amount_calc = 0 } }
		clear_variable = influencer4
		clear_variable = influencer4_amount
		clear_variable = influencer4_amount_calc
		clear_variable = influencer5
		clear_variable = influencer5_amount
		clear_variable = influencer5_amount_calc
		clear_variable = influencer6
		clear_variable = influencer6_amount
		clear_variable = influencer6_amount_calc
		clear_variable = influencer7
		clear_variable = influencer7_amount
		clear_variable = influencer7_amount_calc
	}
	else_if = { limit = { check_variable = { influencer5_amount_calc = 0 } }
		clear_variable = influencer5
		clear_variable = influencer5_amount
		clear_variable = influencer5_amount_calc
		clear_variable = influencer6
		clear_variable = influencer6_amount
		clear_variable = influencer6_amount_calc
		clear_variable = influencer7
		clear_variable = influencer7_amount
		clear_variable = influencer7_amount_calc
	}
	else_if = { limit = { check_variable = { influencer6_amount_calc = 0 } }
		clear_variable = influencer6
		clear_variable = influencer6_amount
		clear_variable = influencer6_amount_calc
		clear_variable = influencer7
		clear_variable = influencer7_amount
		clear_variable = influencer7_amount_calc
	}
	else_if = { limit = { check_variable = { influencer7_amount_calc = 0 } }
		clear_variable = influencer7
		clear_variable = influencer7_amount
		clear_variable = influencer7_amount_calc
	}
	recalculate_influence_drift = yes
}


### Sets ideology drift from influence ###
recalculate_influence_drift = {
	set_temp_variable = { influence_democratic = 0 }
	set_temp_variable = { influence_neutrality = 0 }
	set_temp_variable = { influence_communism = 0 }
	set_temp_variable = { influence_nationalist = 0 }
	set_temp_variable = { influence_fascism = 0 }

	if = {
		limit = { check_variable = { influencer1_amount > 0.5 } }
		if = {
			limit = { var:influencer1 = { has_government = democratic } }
			add_to_temp_variable = { influence_democratic = influencer1_amount_calc }	
		}
		else_if = {
			limit = { var:influencer1 = { has_government = neutrality } }
			add_to_temp_variable = { influence_neutrality = influencer1_amount_calc }	
		}
		else_if = {
			limit = { var:influencer1 = { has_government = communism } }
			add_to_temp_variable = { influence_communism = influencer1_amount_calc }	
		}
		else_if = {
			limit = { var:influencer1 = { has_government = nationalist } }
			add_to_temp_variable = { influence_nationalist = influencer1_amount_calc }	
		}
		else_if = {
			limit = { var:influencer1 = { has_government = fascism } }
			add_to_temp_variable = { influence_fascism = influencer1_amount_calc }	
		}
	}
	if = {
		limit = { check_variable = { influencer2_amount > 0.5 } }
		if = {
			limit = { var:influencer2 = { has_government = democratic } }
			add_to_temp_variable = { influence_democratic = influencer2_amount_calc }	
		}
		else_if = {
			limit = { var:influencer2 = { has_government = neutrality } }
			add_to_temp_variable = { influence_neutrality = influencer2_amount_calc }	
		}
		else_if = {
			limit = { var:influencer2 = { has_government = communism } }
			add_to_temp_variable = { influence_communism = influencer2_amount_calc }	
		}
		else_if = {
			limit = { var:influencer2 = { has_government = nationalist } }
			add_to_temp_variable = { influence_nationalist = influencer2_amount_calc }	
		}
		else_if = {
			limit = { var:influencer2 = { has_government = fascism } }
			add_to_temp_variable = { influence_fascism = influencer2_amount_calc }	
		}
	}
	if = {
		limit = { check_variable = { influencer3_amount > 0.5 } }
		if = {
			limit = { var:influencer3 = { has_government = democratic } }
			add_to_temp_variable = { influence_democratic = influencer3_amount_calc }	
		}
		else_if = {
			limit = { var:influencer3 = { has_government = neutrality } }
			add_to_temp_variable = { influence_neutrality = influencer3_amount_calc }	
		}
		else_if = {
			limit = { var:influencer3 = { has_government = communism } }
			add_to_temp_variable = { influence_communism = influencer3_amount_calc }	
		}
		else_if = {
			limit = { var:influencer3 = { has_government = nationalist } }
			add_to_temp_variable = { influence_nationalist = influencer3_amount_calc }	
		}
		else_if = {
			limit = { var:influencer3 = { has_government = fascism } }
			add_to_temp_variable = { influence_fascism = influencer3_amount_calc }	
		}
	}
	if = {
		limit = { check_variable = { influencer4_amount > 0.5 } }
		if = {
			limit = { var:influencer4 = { has_government = democratic } }
			add_to_temp_variable = { influence_democratic = influencer4_amount_calc }	
		}
		else_if = {
			limit = { var:influencer4 = { has_government = neutrality } }
			add_to_temp_variable = { influence_neutrality = influencer4_amount_calc }	
		}
		else_if = {
			limit = { var:influencer4 = { has_government = communism } }
			add_to_temp_variable = { influence_communism = influencer4_amount_calc }	
		}
		else_if = {
			limit = { var:influencer4 = { has_government = nationalist } }
			add_to_temp_variable = { influence_nationalist = influencer4_amount_calc }	
		}
		else_if = {
			limit = { var:influencer4 = { has_government = fascism } }
			add_to_temp_variable = { influence_fascism = influencer4_amount_calc }	
		}
	}
	if = {
		limit = { check_variable = { influencer5_amount > 0.5 } }
		if = {
			limit = { var:influencer5 = { has_government = democratic } }
			add_to_temp_variable = { influence_democratic = influencer5_amount_calc }	
		}
		else_if = {
			limit = { var:influencer5 = { has_government = neutrality } }
			add_to_temp_variable = { influence_neutrality = influencer5_amount_calc }	
		}
		else_if = {
			limit = { var:influencer5 = { has_government = communism } }
			add_to_temp_variable = { influence_communism = influencer5_amount_calc }	
		}
		else_if = {
			limit = { var:influencer5 = { has_government = nationalist } }
			add_to_temp_variable = { influence_nationalist = influencer5_amount_calc }	
		}
		else_if = {
			limit = { var:influencer5 = { has_government = fascism } }
			add_to_temp_variable = { influence_fascism = influencer5_amount_calc }	
		}
	}
	if = {
		limit = { check_variable = { influencer6_amount > 0.5 } }
		if = {
			limit = { var:influencer6 = { has_government = democratic } }
			add_to_temp_variable = { influence_democratic = influencer6_amount_calc }	
		}
		else_if = {
			limit = { var:influencer6 = { has_government = neutrality } }
			add_to_temp_variable = { influence_neutrality = influencer6_amount_calc }	
		}
		else_if = {
			limit = { var:influencer6 = { has_government = communism } }
			add_to_temp_variable = { influence_communism = influencer6_amount_calc }	
		}
		else_if = {
			limit = { var:influencer6 = { has_government = nationalist } }
			add_to_temp_variable = { influence_nationalist = influencer6_amount_calc }	
		}
		else_if = {
			limit = { var:influencer6 = { has_government = fascism } }
			add_to_temp_variable = { influence_fascism = influencer6_amount_calc }	
		}
	}
	if = {
		limit = { check_variable = { influencer7_amount > 0.5 } }
		if = {
			limit = { var:influencer7 = { has_government = democratic } }
			add_to_temp_variable = { influence_democratic = influencer7_amount_calc }	
		}
		else_if = {
			limit = { var:influencer7 = { has_government = neutrality } }
			add_to_temp_variable = { influence_neutrality = influencer7_amount_calc }	
		}
		else_if = {
			limit = { var:influencer7 = { has_government = communism } }
			add_to_temp_variable = { influence_communism = influencer7_amount_calc }	
		}
		else_if = {
			limit = { var:influencer7 = { has_government = nationalist } }
			add_to_temp_variable = { influence_nationalist = influencer7_amount_calc }	
		}
		else_if = {
			limit = { var:influencer7 = { has_government = fascism } }
			add_to_temp_variable = { influence_fascism = influencer7_amount_calc }	
		}
	}
	
	### see ideology_drifts.txt: ###
	
	clear_influence_count_ideas = yes

	if = { limit = { check_variable = { influence_democratic > 0.04 } } reset_democratic_influence_ideas = yes }
	if = { limit = { check_variable = { influence_neutrality > 0.04 } } reset_neutrality_influence_ideas = yes }
	if = { limit = { check_variable = { influence_communism > 0.04 } } reset_communism_influence_ideas = yes }
	if = { limit = { check_variable = { influence_nationalist > 0.04 } } reset_nationalist_influence_ideas = yes }
	if = { limit = { check_variable = { influence_fascism > 0.04 } } reset_fascism_influence_ideas = yes }
}

### Calculates percentages ###
influence_refresh = {

	#Set Variables for Calc Variant
	if = { limit = { has_variable = influencer1 }
		set_variable = { influencer1_amount_calc = influencer1_amount }
	}
	if = { limit = { has_variable = influencer2 }
	set_variable = { influencer2_amount_calc = influencer2_amount }
	}
	if = { limit = { has_variable = influencer3 }
	set_variable = { influencer3_amount_calc = influencer3_amount }
	}
	if = { limit = { has_variable = influencer4 }
	set_variable = { influencer4_amount_calc = influencer4_amount }
	}
	if = { limit = { has_variable = influencer5 }
	set_variable = { influencer5_amount_calc = influencer5_amount }
	}
	if = { limit = { has_variable = influencer6 }
	set_variable = { influencer6_amount_calc = influencer6_amount }
	}
	if = { limit = { has_variable = influencer7 }
	set_variable = { influencer7_amount_calc = influencer7_amount }
	}
	set_variable = { domestic_influence_amount_calc = domestic_influence_amount }
	set_variable = { influence_total = 0 } 
	
	
	#Influence Total Addition Begins
	add_to_variable = { influence_total = influencer1_amount_calc }
	add_to_variable = { influence_total = influencer2_amount_calc }
	add_to_variable = { influence_total = influencer3_amount_calc }
	add_to_variable = { influence_total = influencer4_amount_calc }
	add_to_variable = { influence_total = influencer5_amount_calc }
	add_to_variable = { influence_total = influencer6_amount_calc }
	add_to_variable = { influence_total = influencer7_amount_calc }
	add_to_variable = { influence_total = domestic_influence_amount_calc }
	#Total Established
	
	#Begin Division
	set_variable = { total_influencers = 0 }
	if = {
		limit = { check_variable = { influencer1_amount_calc > 0.5 } }
		divide_variable = { influencer1_amount_calc = influence_total }
		add_to_variable = { total_influencers = 1 }
	}
	if = {
		limit = { check_variable = { influencer2_amount_calc > 0.5 } }
		divide_variable = { influencer2_amount_calc = influence_total }
		add_to_variable = { total_influencers = 1 }
	}
	if = {
		limit = { check_variable = { influencer3_amount_calc > 0.5 } }
		divide_variable = { influencer3_amount_calc = influence_total }
		add_to_variable = { total_influencers = 1 }
	}
	if = {
		limit = { check_variable = { influencer4_amount_calc > 0.5 } }
		divide_variable = { influencer4_amount_calc = influence_total }
		add_to_variable = { total_influencers = 1 }
	}
	if = {
		limit = { check_variable = { influencer5_amount_calc > 0.5 } }
		divide_variable = { influencer5_amount_calc = influence_total }
		add_to_variable = { total_influencers = 1 }
	}
	if = {
		limit = { check_variable = { influencer6_amount_calc > 0.5 } }
		divide_variable = { influencer6_amount_calc = influence_total }
		add_to_variable = { total_influencers = 1 }
	}
	if = {
		limit = { check_variable = { influencer7_amount_calc > 0.5 } }
		divide_variable = { influencer7_amount_calc = influence_total }
		add_to_variable = { total_influencers = 1 }
	}
	divide_variable = { domestic_influence_amount_calc = influence_total }
}

find_largest_influence = {
	set_variable = { prevmax = 0 }
	if = {
		limit = { NOT = { check_variable = { found_num_vars > 0 } } check_variable = { influencer1_amount_calc > prevmax } }
		set_variable = { prevmax = influencer1_amount_calc }
		set_variable = { var_ID = 1 }
	}	
	if = {
		limit = { NOT = { check_variable = { found_num_vars > 1 } } check_variable = { influencer2_amount_calc > prevmax } }
		set_variable = { prevmax = influencer2_amount_calc } 
		set_variable = { var_ID = 2 }
	}
	if = {
		limit = { NOT = { check_variable = { found_num_vars > 2 } } check_variable = { influencer3_amount_calc > prevmax } }
		set_variable = { prevmax = influencer3_amount_calc } 
		set_variable = { var_ID = 3 }
	}
	if = {
		limit = { NOT = { check_variable = { found_num_vars > 3 } } check_variable = { influencer4_amount_calc > prevmax } }
		set_variable = { prevmax = influencer4_amount_calc } 
		set_variable = { var_ID = 4 }
	}
	if = {
		limit = { NOT = { check_variable = { found_num_vars > 4 } } check_variable = { influencer5_amount_calc > prevmax } }
		set_variable = { prevmax = influencer5_amount_calc } 
		set_variable = { var_ID = 5 }
	}
	if = {
		limit = { NOT = { check_variable = { found_num_vars > 5 } } check_variable = { influencer6_amount_calc > prevmax } }
		set_variable = { prevmax = influencer6_amount_calc } 
		set_variable = { var_ID = 6 }
	}
	if = {
		limit = { NOT = { check_variable = { found_num_vars > 6 } } check_variable = { influencer7_amount_calc > prevmax } }
		set_variable = { prevmax = influencer7_amount_calc } 
		set_variable = { var_ID = 7 }
	}
	
	add_to_variable = { found_num_vars = 1 } #will always find since function only runs if there is something to find! :P
	
	#Largest Found, now setting it to become the largest variable not assigned yet
	#if 1 then skip everything
	if = { 
		limit = { 
			check_variable = { var_ID = 1 }
		}
		else = {
			#first round
			if = { 
				limit = { 
					check_variable = { found_num_vars = 1 }
				}
				if = { 
					limit = { check_variable = { var_ID = 2 } }
					#backup
					set_temp_variable = { temp_amount_calc = influencer1_amount_calc }
					set_temp_variable = { temp_amount = influencer1_amount }
					set_temp_variable = { temp_influencer = influencer1 }
					#overwrite
					set_variable = { influencer1_amount_calc = influencer2_amount_calc } 
					set_variable = { influencer1_amount = influencer2_amount }
					set_variable = { influencer1 = influencer2 }
					#restore backup
					set_variable = { influencer2_amount_calc = temp_amount_calc } 
					set_variable = { influencer2_amount = temp_amount }
					set_variable = { influencer2 = temp_influencer }
				}
				else_if = { limit = { check_variable = { var_ID = 3 } } 
					#backup
					set_temp_variable = { temp_amount_calc = influencer1_amount_calc }
					set_temp_variable = { temp_amount = influencer1_amount }
					set_temp_variable = { temp_influencer = influencer1 }
					#overwrite
					set_variable = { influencer1_amount_calc = influencer3_amount_calc } 
					set_variable = { influencer1_amount = influencer3_amount }
					set_variable = { influencer1 = influencer3 }
					#restore backup
					set_variable = { influencer3_amount_calc = temp_amount_calc } 
					set_variable = { influencer3_amount = temp_amount }
					set_variable = { influencer3 = temp_influencer }
				}
				else_if = { limit = { check_variable = { var_ID = 4 } } 
					#backup
					set_temp_variable = { temp_amount_calc = influencer1_amount_calc }
					set_temp_variable = { temp_amount = influencer1_amount }
					set_temp_variable = { temp_influencer = influencer1 }
					#overwrite
					set_variable = { influencer1_amount_calc = influencer4_amount_calc } 
					set_variable = { influencer1_amount = influencer4_amount }
					set_variable = { influencer1 = influencer4 }
					#restore backup
					set_variable = { influencer4_amount_calc = temp_amount_calc } 
					set_variable = { influencer4_amount = temp_amount }
					set_variable = { influencer4 = temp_influencer }
				}
				else_if = { limit = { check_variable = { var_ID = 5 } } 
					#backup
					set_temp_variable = { temp_amount_calc = influencer1_amount_calc }
					set_temp_variable = { temp_amount = influencer1_amount }
					set_temp_variable = { temp_influencer = influencer1 }
					#overwrite
					set_variable = { influencer1_amount_calc = influencer5_amount_calc } 
					set_variable = { influencer1_amount = influencer5_amount }
					set_variable = { influencer1 = influencer5 }
					#restore backup
					set_variable = { influencer5_amount_calc = temp_amount_calc } 
					set_variable = { influencer5_amount = temp_amount }
					set_variable = { influencer5 = temp_influencer }
				}
				else_if = { limit = { check_variable = { var_ID = 6 } } 
					#backup
					set_temp_variable = { temp_amount_calc = influencer1_amount_calc }
					set_temp_variable = { temp_amount = influencer1_amount }
					set_temp_variable = { temp_influencer = influencer1 }
					#overwrite
					set_variable = { influencer1_amount_calc = influencer6_amount_calc } 
					set_variable = { influencer1_amount = influencer6_amount }
					set_variable = { influencer1 = influencer6 }
					#restore backup
					set_variable = { influencer6_amount_calc = temp_amount_calc } 
					set_variable = { influencer6_amount = temp_amount }
					set_variable = { influencer6 = temp_influencer }
				}
				else_if = { limit = { check_variable = { var_ID = 7 } } 
					#backup
					set_temp_variable = { temp_amount_calc = influencer1_amount_calc }
					set_temp_variable = { temp_amount = influencer1_amount }
					set_temp_variable = { temp_influencer = influencer1 }
					#overwrite
					set_variable = { influencer1_amount_calc = influencer7_amount_calc } 
					set_variable = { influencer1_amount = influencer7_amount }
					set_variable = { influencer1 = influencer7 }
					#restore backup
					set_variable = { influencer7_amount_calc = temp_amount_calc } 
					set_variable = { influencer7_amount = temp_amount }
					set_variable = { influencer7 = temp_influencer }
				}
				else = {
					# Skip if 2 is correct
					if = {
						limit = { 
							check_variable = { var_ID = 2 } 
						}
						else = {
							#Second round
							if = { 
								limit = { 
									check_variable = { found_num_vars = 2  }
								}
								if = { 
									limit = { check_variable = { var_ID = 3 } }
									#backup
									set_temp_variable = { temp_amount_calc = influencer2_amount_calc }
									set_temp_variable = { temp_amount = influencer2_amount }
									set_temp_variable = { temp_influencer = influencer2 }
									#overwrite
									set_variable = { influencer2_amount_calc = influencer3_amount_calc } 
									set_variable = { influencer2_amount = influencer3_amount }
									set_variable = { influencer2 = influencer3 }
									#restore backup
									set_variable = { influencer3_amount_calc = temp_amount_calc } 
									set_variable = { influencer3_amount = temp_amount }
									set_variable = { influencer3 = temp_influencer }
								}
								else_if = { limit = { check_variable = { var_ID = 4 } } 
									#backup
									set_temp_variable = { temp_amount_calc = influencer2_amount_calc }
									set_temp_variable = { temp_amount = influencer2_amount }
									set_temp_variable = { temp_influencer = influencer2 }
									#overwrite
									set_variable = { influencer2_amount_calc = influencer4_amount_calc } 
									set_variable = { influencer2_amount = influencer4_amount }
									set_variable = { influencer2 = influencer4 }
									#restore backup
									set_variable = { influencer4_amount_calc = temp_amount_calc } 
									set_variable = { influencer4_amount = temp_amount }
									set_variable = { influencer4 = temp_influencer }
								}
								else_if = { limit = { check_variable = { var_ID = 5 } } 
									#backup
									set_temp_variable = { temp_amount_calc = influencer2_amount_calc }
									set_temp_variable = { temp_amount = influencer2_amount }
									set_temp_variable = { temp_influencer = influencer2 }
									#overwrite
									set_variable = { influencer2_amount_calc = influencer5_amount_calc } 
									set_variable = { influencer2_amount = influencer5_amount }
									set_variable = { influencer2 = influencer5 }
									#restore backup
									set_variable = { influencer5_amount_calc = temp_amount_calc } 
									set_variable = { influencer5_amount = temp_amount }
									set_variable = { influencer5 = temp_influencer }
								}
								else_if = { limit = { check_variable = { var_ID = 6 } } 
									#backup
									set_temp_variable = { temp_amount_calc = influencer2_amount_calc }
									set_temp_variable = { temp_amount = influencer2_amount }
									set_temp_variable = { temp_influencer = influencer2 }
									#overwrite
									set_variable = { influencer2_amount_calc = influencer6_amount_calc } 
									set_variable = { influencer2_amount = influencer6_amount }
									set_variable = { influencer2 = influencer6 }
									#restore backup
									set_variable = { influencer6_amount_calc = temp_amount_calc } 
									set_variable = { influencer6_amount = temp_amount }
									set_variable = { influencer6 = temp_influencer }
								}
								else_if = { limit = { check_variable = { var_ID = 7 } } 
									#backup
									set_temp_variable = { temp_amount_calc = influencer2_amount_calc }
									set_temp_variable = { temp_amount = influencer2_amount }
									set_temp_variable = { temp_influencer = influencer2 }
									#overwrite
									set_variable = { influencer2_amount_calc = influencer7_amount_calc } 
									set_variable = { influencer2_amount = influencer7_amount }
									set_variable = { influencer2 = influencer7 }
									#restore backup
									set_variable = { influencer7_amount_calc = temp_amount_calc } 
									set_variable = { influencer7_amount = temp_amount }
									set_variable = { influencer7 = temp_influencer }
								}
								else = {
									# Skip if 3 is correct
									if = {
										limit = { 
											check_variable = { var_ID = 3 } 
										}
										else = {
											#Third round
											if = { 
												limit = { 
													check_variable = { found_num_vars = 3  }
												}
												if = { 
													limit = { check_variable = { var_ID = 4 } }
													#backup
													set_temp_variable = { temp_amount_calc = influencer3_amount_calc }
													set_temp_variable = { temp_amount = influencer3_amount }
													set_temp_variable = { temp_influencer = influencer3 }
													#overwrite
													set_variable = { influencer3_amount_calc = influencer4_amount_calc } 
													set_variable = { influencer3_amount = influencer4_amount }
													set_variable = { influencer3 = influencer4 }
													#restore backup
													set_variable = { influencer4_amount_calc = temp_amount_calc } 
													set_variable = { influencer4_amount = temp_amount }
													set_variable = { influencer4 = temp_influencer }
												}
												else_if = { 
													limit = { check_variable = { var_ID = 5 } }
													#backup
													set_temp_variable = { temp_amount_calc = influencer3_amount_calc }
													set_temp_variable = { temp_amount = influencer3_amount }
													set_temp_variable = { temp_influencer = influencer3 }
													#overwrite
													set_variable = { influencer3_amount_calc = influencer5_amount_calc } 
													set_variable = { influencer3_amount = influencer5_amount }
													set_variable = { influencer3 = influencer5 }
													#restore backup
													set_variable = { influencer5_amount_calc = temp_amount_calc } 
													set_variable = { influencer5_amount = temp_amount }
													set_variable = { influencer5 = temp_influencer }
												}
												else_if = { 
													limit = { check_variable = { var_ID = 6 } }
													#backup
													set_temp_variable = { temp_amount_calc = influencer3_amount_calc }
													set_temp_variable = { temp_amount = influencer3_amount }
													set_temp_variable = { temp_influencer = influencer3 }
													#overwrite
													set_variable = { influencer3_amount_calc = influencer6_amount_calc } 
													set_variable = { influencer3_amount = influencer6_amount }
													set_variable = { influencer3 = influencer6 }
													#restore backup
													set_variable = { influencer6_amount_calc = temp_amount_calc } 
													set_variable = { influencer6_amount = temp_amount }
													set_variable = { influencer6 = temp_influencer }
												}
												else_if = { 
													limit = { check_variable = { var_ID = 7 } }
													#backup
													set_temp_variable = { temp_amount_calc = influencer3_amount_calc }
													set_temp_variable = { temp_amount = influencer3_amount }
													set_temp_variable = { temp_influencer = influencer3 }
													#overwrite
													set_variable = { influencer3_amount_calc = influencer7_amount_calc } 
													set_variable = { influencer3_amount = influencer7_amount }
													set_variable = { influencer3 = influencer7 }
													#restore backup
													set_variable = { influencer7_amount_calc = temp_amount_calc } 
													set_variable = { influencer7_amount = temp_amount }
													set_variable = { influencer7 = temp_influencer }
												}
												else = {
													# Skip if 4 is correct
													if = {
														limit = { 
															check_variable = { var_ID = 4 } 
														}
														else = {
															#Fourth round
															if = { 
																limit = { 
																	check_variable = { found_num_vars = 4  }
																}
																if = { 
																	limit = { check_variable = { var_ID = 5 } }
																	#backup
																	set_temp_variable = { temp_amount_calc = influencer4_amount_calc }
																	set_temp_variable = { temp_amount = influencer4_amount }
																	set_temp_variable = { temp_influencer = influencer4 }
																	#overwrite
																	set_variable = { influencer4_amount_calc = influencer5_amount_calc } 
																	set_variable = { influencer4_amount = influencer5_amount }
																	set_variable = { influencer4 = influencer5 }
																	#restore backup
																	set_variable = { influencer5_amount_calc = temp_amount_calc } 
																	set_variable = { influencer5_amount = temp_amount }
																	set_variable = { influencer5 = temp_influencer }
																}
																else_if = { 
																	limit = { check_variable = { var_ID = 6 } }
																	#backup
																	set_temp_variable = { temp_amount_calc = influencer4_amount_calc }
																	set_temp_variable = { temp_amount = influencer4_amount }
																	set_temp_variable = { temp_influencer = influencer4 }
																	#overwrite
																	set_variable = { influencer4_amount_calc = influencer6_amount_calc } 
																	set_variable = { influencer4_amount = influencer6_amount }
																	set_variable = { influencer4 = influencer6 }
																	#restore backup
																	set_variable = { influencer6_amount_calc = temp_amount_calc } 
																	set_variable = { influencer6_amount = temp_amount }
																	set_variable = { influencer6 = temp_influencer }
																}
																else_if = { 
																	limit = { check_variable = { var_ID = 7 } }
																	#backup
																	set_temp_variable = { temp_amount_calc = influencer4_amount_calc }
																	set_temp_variable = { temp_amount = influencer4_amount }
																	set_temp_variable = { temp_influencer = influencer4 }
																	#overwrite
																	set_variable = { influencer4_amount_calc = influencer7_amount_calc } 
																	set_variable = { influencer4_amount = influencer7_amount }
																	set_variable = { influencer4 = influencer7 }
																	#restore backup
																	set_variable = { influencer7_amount_calc = temp_amount_calc } 
																	set_variable = { influencer7_amount = temp_amount }
																	set_variable = { influencer7 = temp_influencer }
																}
																else = {
																	# Skip if 5 is correct
																	if = {
																		limit = { 
																			check_variable = { var_ID = 5 } 
																		}
																		else = {
																			#Fifth round
																			if = { 
																				limit = { 
																					check_variable = { found_num_vars = 5  }
																				}
																				if = { 
																					limit = { check_variable = { var_ID = 6 } }
																					#backup
																					set_temp_variable = { temp_amount_calc = influencer5_amount_calc }
																					set_temp_variable = { temp_amount = influencer5_amount }
																					set_temp_variable = { temp_influencer = influencer5 }
																					#overwrite
																					set_variable = { influencer5_amount_calc = influencer6_amount_calc } 
																					set_variable = { influencer5_amount = influencer6_amount }
																					set_variable = { influencer5 = influencer6 }
																					#restore backup
																					set_variable = { influencer6_amount_calc = temp_amount_calc } 
																					set_variable = { influencer6_amount = temp_amount }
																					set_variable = { influencer6 = temp_influencer }
																				}
																				else_if = { 
																					limit = { check_variable = { var_ID = 7 } }
																					#backup
																					set_temp_variable = { temp_amount_calc = influencer5_amount_calc }
																					set_temp_variable = { temp_amount = influencer5_amount }
																					set_temp_variable = { temp_influencer = influencer5 }
																					#overwrite
																					set_variable = { influencer5_amount_calc = influencer7_amount_calc } 
																					set_variable = { influencer5_amount = influencer7_amount }
																					set_variable = { influencer5 = influencer7 }
																					#restore backup
																					set_variable = { influencer7_amount_calc = temp_amount_calc } 
																					set_variable = { influencer7_amount = temp_amount }
																					set_variable = { influencer7 = temp_influencer }
																				}
																				else = {
																					# Skip if 6 is correct
																					if = {
																						limit = { 
																							check_variable = { var_ID = 6 } 
																						}
																						else = {
																							#Sixth round
																							if = { 
																								limit = { 
																									check_variable = { found_num_vars = 6  }
																								}
																								if = { 
																									limit = { check_variable = { var_ID = 7 } }
																									#backup
																									set_temp_variable = { temp_amount_calc = influencer6_amount_calc }
																									set_temp_variable = { temp_amount = influencer6_amount }
																									set_temp_variable = { temp_influencer = influencer6 }
																									#overwrite
																									set_variable = { influencer6_amount_calc = influencer7_amount_calc } 
																									set_variable = { influencer6_amount = influencer7_amount }
																									set_variable = { influencer6 = influencer7 }
																									#restore backup
																									set_variable = { influencer7_amount_calc = temp_amount_calc } 
																									set_variable = { influencer7_amount = temp_amount }
																									set_variable = { influencer7 = temp_influencer }
																								}
																								#by logic deduction the only remaining option is that var_ID = 7 = influencer7 and is the smallest.
																								#this means it's already correct.
																							}
																						}
																					}
																				}
																			}
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}	
	}
	clear_variable = var_ID
	clear_variable = prevmax
}


### Not used but can be modified to work ###
establish_influencer_tag = {
	if = { limit = { NOT = { has_variable = influencer1 } }
		set_variable = { influencer1 = ROOT.id }
	}
	if = {
		limit = {
			NOT = {
				has_variable = influencer2
			}	
		}
		set_variable = { influencer2 = ROOT.id }
		break = yes
	}	
	if = {
		limit = {
			NOT = {
				has_variable = influencer3
			}	
		}
		set_variable = { influencer3 = ROOT.id }
		break = yes
	}	
	if = {
		limit = {
			NOT = {
				has_variable = influencer4
			}	
		}
		set_variable = { influencer4 = ROOT.id }
		break = yes
	}	
	if = {
		limit = {
			NOT = {
				has_variable = influencer5
			}	
		}
		set_variable = { influencer5 = ROOT.id }
		break = yes
	}	
	if = {
		limit = {
			NOT = {
				has_variable = influencer6
			}	
		}
		set_variable = { influencer6 = ROOT.id }
		break = yes
	}	
	if = {
		limit = {
			NOT = {
				has_variable = influencer7
			}	
		}
		set_variable = { influencer7 = ROOT.id }
		break = yes
	}	
}