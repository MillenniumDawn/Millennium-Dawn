EH_electric_traps_category = {
	EH_set_up_electric_trap = {
		icon = GFX_decision_fixes_button # This probably needs own icon
		days_remove = 7

		state_target = yes

		on_map_mode = map_only
        highlight_states = {
	    	highlight_states_trigger = {
	    		has_state_flag = EH_electric_trap_enabled_flag
	    	}
	    	highlight_color_before_active = 3
	    	highlight_color_while_active = 2
	    }
		target_trigger = {
            FROM = {
                is_controlled_by = ROOT
                has_state_flag = EH_electric_trap_enabled_flag
            }
        }

		available = {
			tungsten > 0
		}

		visible = {
			FROM = {
				NOT = { has_state_flag = EH_electric_trap_set_up_flag }
			}
		}

		remove_effect = {
			FROM = {
				set_state_flag = EH_electric_trap_set_up_flag
			}
			add_to_variable = { EH_electric_trap_country_resource_cost_tungsten_var = 1 }
			custom_effect_tooltip = EH_electric_trap_country_resource_cost_tungsten_TT
		}
	}
    EH_remove_electric_trap = {
		icon = GFX_decision_message_decline_button # This probably needs own icon
		days_remove = 7

		state_target = yes

		on_map_mode = map_only

		highlight_states = {
	    	highlight_states_trigger = {
	    		has_state_flag = EH_electric_trap_enabled_flag
	    	}
	    	highlight_color_before_active = 3
	    	highlight_color_while_active = 2
	    }

		target_trigger = {
            FROM = {
                is_controlled_by = ROOT
                has_state_flag = EH_electric_trap_set_up_flag
            }
        }

		visible = {
			FROM = {
				has_state_flag = EH_electric_trap_set_up_flag
			}
		}

        available = {
            FROM = {
                NOT = {
                    has_state_flag = EH_electric_trap_active_flag
                }
            }
        }

        complete_effect = {
            FROM = {
                set_state_flag = EH_electric_trap_removing_flag
            }
        }

		remove_effect = {
			FROM = {
				clr_state_flag = EH_electric_trap_set_up_flag
                clr_state_flag = EH_electric_trap_removing_flag
			}
			add_to_variable = { EH_electric_trap_country_resource_cost_tungsten_var = -1 }
			custom_effect_tooltip = EH_electric_trap_remove_country_resource_cost_tungsten_TT
		}
	}
    EH_activate_electric_trap = {
        icon = GFX_decision_fire # This probably needs own icon
        days_remove = 10

        state_target = yes

        on_map_mode = map_only

        highlight_states = {
	    	highlight_states_trigger = {
	    		has_state_flag = EH_electric_trap_enabled_flag
	    	}
	    	highlight_color_before_active = 3
	    	highlight_color_while_active = 2
	    }

        target_trigger = {
            FROM = {
                is_controlled_by = ROOT
                has_state_flag = EH_electric_trap_set_up_flag
            }
        }

		visible = {
			FROM = {
				has_state_flag = EH_electric_trap_set_up_flag
			}
		}

        available = {
            FROM = {
                NOT = {
                    has_state_flag = EH_electric_trap_cooldown
                    has_state_flag = EH_electric_trap_removing_flag
                }
            }
        }

        complete_effect = {
            if = {
                limit = {
                    NOT = {
                        has_dynamic_modifier = {
                            modifier = EH_electric_trap_country_effects_idea
                        }
                    }
                }
                hidden_effect = {
                    add_dynamic_modifier = {
                        modifier = EH_electric_trap_country_effects_idea
                    }
                }
            }
            add_to_variable = { EH_electric_trap_energy_use_var = 0.1 }
            custom_effect_tooltip = EH_electric_trap_energy_use_TT
            FROM = {
                set_state_flag = EH_electric_trap_active_flag
				add_state_modifier = {
    				modifier = {
        				enemy_attrition = 0.2
						enemy_army_speed_factor = -0.15
    				}
				}
            }
        }

        remove_effect = {
            # Effects for country
            add_to_variable = { EH_electric_trap_energy_use_var = -0.1 }
            FROM = {
                # Effects for state
                set_state_flag = {
                    flag = EH_electric_trap_cooldown
                    days = 15
                    value = 1
                }
                clr_state_flag = EH_electric_trap_active_flag
				add_state_modifier = {
    				modifier = {
        				enemy_attrition = -0.2
						enemy_army_speed_factor = 0.15
    				}
				}
            }
        }
    }
}

EH_research_sites_category = {
    EH_setup_research_site = {
        icon = GFX_decision_generic_research # This probably needs own icon
        days_remove = 30

        available = {
            EH_any_controlled_state_1500_to_any_portal = yes
            custom_trigger_tooltip = {
                tooltip = EH_research_sites_limit_TT
                check_variable = { EH_research_sites_constructed_var < 10 }
            }
        }

        remove_effect = {
            add_to_variable = { EH_research_sites_constructed_var = 1}
            if = {
                limit = {
                    NOT = {
                        has_dynamic_modifier = {
                            modifier = EH_research_sites_effects_idea
                        }
                    }
                }
                add_dynamic_modifier = {
                    modifier = EH_research_sites_effects_idea
                }
            }
            custom_effect_tooltip = EH_add_research_site_TT
        }
    }
}